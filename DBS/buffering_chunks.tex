% Emacs, this is -*-latex-*-

% Buffering chunks

\label{sec:buffering_chunks}

In order to hide the jitter generated by the physical network and the
protocol itself, peers need to store the received chunks in a buffer
during a period of time, before sending them to a player. A chunk with
number $x$ is inserted in the position $(x~\mathit{mod}~2B)$ of the
buffer, where $B$ is the maximum number of chunks that the buffer
stores before start playing the first chunk. In a peer's life, $B$ is
a constant specified by the user, but it is not compulsory that all
peers of a team use the same buffer size.

The buffer is implemented as a circular array of $2B$ chunks, that is
filled with up to $B$ chunks during the \gls{buffering-time} $t_b$.
Such time is the main component of the \gls{start-up-time} $t_s$
experienced by users. Chunks with a higher number (newer chunks) are
inserted near of the head of the buffer. The (received) chunks pointed
by the tail of the buffer $i_p$ (the played chunk index) are sent to
the player. This action is carried out each time a new chunk is
received\footnote{DBS does not know anything about the content and
  therefore, about the timing of the chunks.}. During the playing
process, empty cells in the buffer (caused by the no reception on time
of the corresponding chunks) are filled with zeros, and sent to the
player.

% Hablar de la relación entre B y el tamaño del team. Tal vez, cuando
% se presente la expresión de la latencia en función del grado de
% conectividad. En el caso extremo en que todos los peers se
% conectaran con todos, B >= N^*, el número máximo de peer en el team.

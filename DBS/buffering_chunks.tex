% Emacs, this is -*-latex-*-

% Buffering chunks

\label{sec:buffering_chunks}

In order to hide the jitter generated by the physical network and the
protocol itself, peers need to store the received chunks in a buffer
during a period of time, before sending them to a player. A chunk with
number $x$ is inserted in the position $(x~\mathit{mod}~2B)$ of the
buffer, where $B$ is the maximum number of chunks that the buffer
stores. In a peer's life, $B$ is a constant especified by the user,
but it is not compulsory that all peers of a team use the same buffer
size.

The buffer is implemented as a circular queue of $2B$ chunks, which is
filled up to only $B$ chunks during the \emph{buffering time} $t_B$,
which is the main part of the \emph{start-up time} that the users
experiment. Chunks with a higher number (newer chunks) are inserted
near of (depending on the order in which the chunks arrive to the
peer) the head of the buffer. The (received) chunk pointed by the tail
of the buffer $P$ (the playing pointer) is sent to the player. This
action is carried out each time a new chunk is received\footnote{DBS
  does not know nothing about the content and therefore, about the
  timing of the chunks.}. Empty cells in the buffer (caused by the
chunks that have not been received on time) are skipped until to find
the next cell with content.

% Hablar de la relación entre B y el tamaño del team. Tal vez, cuando
% se presente la expresión de la latencia en función del grado de
% conectividad. En el caso extremo en que todos los peers se
% conectaran con todos, B >= N^*, el número máximo de peer en el team.

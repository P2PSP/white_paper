<!DOCTYPE html> 
<html> 
<head> <title>P2PSP (Peer-to-Peer Straightforward Protocol)</title> 
<meta charset="UTF-8" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<link rel="stylesheet" type="text/css" href="index.css" /> 
<script type="text/javascript" 
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" 
></script> 
<style type="text/css"> 
.MathJax_MathML {text-indent: 0;} 
</style> 
</head><body 
>
   <div class="maketitle">
                                                                  

                                                                  
                                                                  

                                                                  

<h2 class="titleHead">P2PSP (Peer-to-Peer Straightforward Protocol)</h2>
 <div class="author" ><span 
class="ecrm-1200">The P2PSP team</span></div><br />
<div class="date" ><span 
class="ecrm-1200">July 19, 2019</span></div>
   </div>
   <div 
class="abstract" 
>
<div class="center" 
>
<!--l. 26--><p class="noindent" >
</p><!--l. 26--><p class="noindent" ><span 
class="ecbx-0900">Abstract</span></p></div>
     <!--l. 5--><p class="indent" >    <span 
class="ecrm-0900">P2PSP (</span><a 
href="https://p2psp.github.io" class="url" ><span 
class="ectt-0900">https://p2psp.github.io</span></a><span 
class="ecrm-0900">) is an application-layer multicast</span>
     <span 
class="ecrm-0900">protocol  that  provides  real-time  broadcasting  of  media  streams.  Peers</span>
     <span 
class="ecrm-0900">receive the stream generated by one or more media sources and share it,</span>
     <span 
class="ecrm-0900">splitted in chunks. The peers are organized in so many unbounded-degree</span>
     <span 
class="ecrm-0900">trees  as  peers  there  exist  in  the  overlay.  The  trees  are  dynamic,  and</span>
     <span 
class="ecrm-0900">their topology try to minimize the transmission delay. The startup time</span>
     <span 
class="ecrm-0900">experimented by the users depends mainly on the maximum expected</span>
     <span 
class="ecrm-0900">size of the overlay. The QoS provided can be dynamically controlled, by</span>
     <span 
class="ecrm-0900">adding and removing media sources. Polite churn does not genererate</span>
     <span 
class="ecrm-0900">a loss of chunks. Unpolite (unexpected) churn produce a loss, but the</span>
     <span 
class="ecrm-0900">number of lost chunks is bounded, and they are spread along the time and</span>
     <span 
class="ecrm-0900">all peers. Selﬁsh peers are automatically isolated and rejected. All peers</span>
     <span 
class="ecrm-0900">contribute with a I/O ratio of 1, but it is also possible to accomodate peers</span>
     <span 
class="ecrm-0900">with connectivity restrictions (ﬁrewalls/NATs). If native IP multicast is</span>
     <span 
class="ecrm-0900">avaliable, peers can use it. All these functionalities have been organized</span>
     <span 
class="ecrm-0900">into a number of set of rules that can be enabled and disabled depending</span>
     <span 
class="ecrm-0900">on the requirements.</span>
</p>
</div>
   <h3 class="likesectionHead"><a 
 id="x1-1000"></a>Notation</h3>
                                                                  

                                                                  
<!--l. 31--><p class="noindent" ><span 
class="ecti-1000">Cursive is used the ﬁrst time a P2PSP-related term/concept is introduced, and for</span>
<span 
class="ecti-1000">key concepts or ideas.</span>
</p><!--l. 33--><p class="noindent" >
</p>
   <h3 class="likesectionHead"><a 
 id="x1-2000"></a>Introduction</h3>
<!--l. 34--><p class="noindent" >P2PSP has a modular design organized in <span 
class="ecti-1000">sets of rules</span>, where each module is
especialized in implementing diﬀerent functionalities.
</p><!--l. 37--><p class="noindent" >
</p>
   <h3 class="likesectionHead"><a 
 id="x1-3000"></a>Contents</h3>
   <div class="tableofcontents">
   <span class="sectionToc" >1 <a 
href="#x1-40001" id="QQ2-1-4">LBS (Load Balancing Set)</a></span>
<br />   <span class="sectionToc" >2 <a 
href="#x1-50002" id="QQ2-1-6">DBS (Data Broadcasting Set)</a></span>
<br />    <span class="subsectionToc" >2.1 <a 
href="#x1-60002.1" id="QQ2-1-8">Team deﬁnition and types of peers</a></span>
<br />    <span class="subsectionToc" >2.2 <a 
href="#x1-70002.2" id="QQ2-1-9">Feeding the team</a></span>
<br />    <span class="subsectionToc" >2.3 <a 
href="#x1-80002.3" id="QQ2-1-10">Joining a team</a></span>
<br />    <span class="subsectionToc" >2.4 <a 
href="#x1-90002.4" id="QQ2-1-11">Buﬀering chunks</a></span>
<br />    <span class="subsectionToc" >2.5 <a 
href="#x1-100002.5" id="QQ2-1-12">Buﬀering time estimation</a></span>
<br />    <span class="subsectionToc" >2.6 <a 
href="#x1-110002.6" id="QQ2-1-13">Chunk ﬂooding</a></span>
<br />    <span class="subsectionToc" >2.7 <a 
href="#x1-120002.7" id="QQ2-1-20">Routes discovery and topology optimization</a></span>
<br />    <span class="subsectionToc" >2.8 <a 
href="#x1-130002.8" id="QQ2-1-21">Leaving a team</a></span>
<br />    <span class="subsectionToc" >2.9 <a 
href="#x1-140002.9" id="QQ2-1-22">Free-riding control at the splitter</a></span>
<br />   <span class="sectionToc" >3 <a 
href="#x1-150003" id="QQ2-1-23">ACS (Adaptive Capacity Set)</a></span>
<br />   <span class="sectionToc" >4 <a 
href="#x1-160004" id="QQ2-1-24">FCS (Free-riding Control Set)</a></span>
<br />   <span class="sectionToc" >5 <a 
href="#x1-170005" id="QQ2-1-25">IMS (Ip Multicast Set)</a></span>
<br />   <span class="sectionToc" >6 <a 
href="#x1-180006" id="QQ2-1-26">TAS (Topology Adaptation Set)</a></span>
<br />   <span class="sectionToc" >7 <a 
href="#x1-190007" id="QQ2-1-27">MRS (Massively-lost chunk Recovery Set)</a></span>
<br />   <span class="sectionToc" >8 <a 
href="#x1-200008" id="QQ2-1-28">NTS (NAT Traversal Set)</a></span>
<br />    <span class="subsectionToc" >8.1 <a 
href="#x1-210008.1" id="QQ2-1-29">Traﬃc ﬁltering</a></span>
<br />    <span class="subsectionToc" >8.2 <a 
href="#x1-220008.2" id="QQ2-1-32">Cone VS symmetric</a></span>
<br />    <span class="subsectionToc" >8.3 <a 
href="#x1-230008.3" id="QQ2-1-33">Port allocation</a></span>
<br />    <span class="subsectionToc" >8.4 <a 
href="#x1-240008.4" id="QQ2-1-34">NAT type analysis</a></span>
<br />    <span class="subsectionToc" >8.5 <a 
href="#x1-250008.5" id="QQ2-1-35">(Theoretical) NAT traversal performance of DBS</a></span>
<br />    <span class="subsectionToc" >8.6 <a 
href="#x1-260008.6" id="QQ2-1-40">A port prediction algorithm (Max’s proposal)</a></span>
<br />   <span class="sectionToc" >9 <a 
href="#x1-270009" id="QQ2-1-41">MCS (Multi-Channel Set)</a></span>
<br />   <span class="sectionToc" >10 <a 
href="#x1-2800010" id="QQ2-1-42">CIS (Content Integrity Set)</a></span>
<br />   <span class="sectionToc" ><a 
href="#Q1-1-43">Acronyms</a></span>
<br />   <span class="sectionToc" ><a 
href="#Q1-1-45">Glossary</a></span>
   </div>
                                                                  

                                                                  
<!--l. 39--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-40001"></a>LBS (Load Balancing Set)</h3>
<!--l. 7--><p class="noindent" ><span 
class="ecbx-1000">Note:  </span>Finished but not implemented.
</p><!--l. 11--><p class="noindent" >LBS is an standalone set of rules, and it is compatible with any other set.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-40011"></a>
                                                                  

                                                                  
<!--l. 15--><p class="noindent" ><div style="text-align:center;"> <img width=800 src="graphics/icecast-P2PSP.svg" /> </div> 
<br />  </p><div class="caption" 
><span class="id">Figure 1:   </span><span  
class="content">A   possible   data-ﬂow   in   an   hybrid   CDN/P2PSP   network.
<!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
represents a splitter and <!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
the <!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>-th
peer.</span></div><!--tex4ht:label?: x1-40011 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
<!--l. 23--><p class="indent" >   P2PSP supposes that there is a collection of <a 
href="#glo:stream">streams</a> (usually, video) that are broadcasted in
parallel.<span class="footnote-mark"><a 
href="index2.html#fn1x0"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-4002f1"></a>  The <a 
href="#glo:stream">streams</a> are
available at one or more<span class="footnote-mark"><a 
href="index3.html#fn2x0"><sup class="textsuperscript">2</sup></a></span><a 
 id="x1-4003f2"></a> 
streaming <a 
href="#glo:server">servers</a>, and each stream has a diﬀerent <a 
href="#glo:URL">Universal Resource Locator</a>,
usually expressed as a Web address with the structure:
                                                                  

                                                                  
</p>
   <div class="verbatim" id="verbatim-1">
  http://server/mount_point
</div>
<!--l. 34--><p class="nopar" > Notice that a server can be serving several channels.
</p><!--l. 38--><p class="indent" >   P2PSP does not perform data-ﬂow control over the stream. The transmission
bit-rate between P2PSP entities is controlled by the servers (Icecast servers, for
example), which provides the stream to the P2PSP <span 
class="ecti-1000">teams</span>. Fig. <a 
href="#x1-40011">1<!--tex4ht:ref: fig:icecast-P2PSP --></a> shows an example
of a streaming overlay where several servers relay a set of channels generated by a set
of source-clients, directly or through other servers. As can be seen, a listener
(which usually plays the stream) can be replaced by a <span 
class="ecti-1000">splitter</span>, a P2PSP
entity that sends the received stream (a single channel) to a set of P2PSP
<span 
class="ecti-1000">peers</span>.
</p><!--l. 63--><p class="indent" >   In a pure CDN system, users request the channels directly to the servers.
Unfortunately, this simple procedure has a drawback: normally, users do not know
the load nor the distance to the servers. This problem can be solved by using a <span 
class="ecti-1000">load</span>
<span 
class="ecti-1000">balancer</span>. The listeners, which know the URL of the required channel, connects ﬁrst
to a load balancer which redirects them (with an HTTP 302 code) to a suitable
server.
</p><!--l. 72--><p class="indent" >   This idea can be extended to minimize the response time of hybrid CDN/P2PSP
structures. When a user (who knows an URL of the channel) runs a local peer, it
provides to his peer the URL of the channel (the URL pointing to a server and a
mount point). Then, the peer (as any other listener does) contacts a load
balancer which in this case sends a list of splitters which are broadcasting the
channel.<span class="footnote-mark"><a 
href="index4.html#fn3x0"><sup class="textsuperscript">3</sup></a></span><a 
 id="x1-4004f3"></a> 
Then, the peer tries to connect with all the splitters in parallel, and the ﬁrst
establised connection determines the selected splitter (the rest of connections are
closed). If only those splitters with space in their teams answer to the peer, this
procedure should select the “nearest” splitter for the peer in terms of response
time.
</p><!--l. 89--><p class="indent" >   For the case of the incorporation of new splitters to the network, the
procedure is similar. A new splitter (which is instantiated knowing an URL of
a channel) contacts the load balancer which returns a list of servers and
peers, which are serving the channel. Then, the splitter tries to connect
with all of them in parallel, and the ﬁrst successfull connection is ﬁnally
selected.<span class="footnote-mark"><a 
href="index5.html#fn4x0"><sup class="textsuperscript">4</sup></a></span><a 
 id="x1-4005f4"></a> 
                                                                  

                                                                  
</p><!--l. 99--><p class="indent" >   Using the idea of the extended load balancer, when a <span 
class="ecti-1000">player </span>(listener) connects
to it, if there is a local peer running in the same host or the same private
network that the player, the balancer will redirect the player to the local
peer.
</p><!--l. 104--><p class="indent" >   Finally, it is compulsory that all the splitters associated to the same channel to
generate exactly the same chunks (content and header). See Section <a 
href="#x1-270009">9<!--tex4ht:ref: sec:MCS --></a> for more
information.
</p>
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-50002"></a>DBS (Data Broadcasting Set)</h3>
<!--l. 5--><p class="noindent" ><span 
class="ecbx-1000">Note:  </span>Finished and implemented.
</p><!--l. 9--><p class="noindent" ><a 
href="#glo:DBS">DBS</a> is the most basic set of rules. The rest of sets extends or modify its
functionality.
</p>
   <div class="table">
                                                                  

                                                                  
<!--l. 13--><p class="indent" >   <a 
 id="x1-50011"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div class="tabular"> <table id="TBL-2" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1" /><col 
id="TBL-2-2" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-1-1"  
class="td11">                                                          Parameter  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-1-2"  
class="td11"> Meaning                                                                                                                                                                         </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-2-1"  
class="td11"> <!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-2-2"  
class="td11"> Maximum number of peers in a team                                                                                                                                   </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-3-1"  
class="td11"> <!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>C</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-3-2"  
class="td11"> Chunk size                                                                                                                                                                      </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-4-1"  
class="td11"> <!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-4-2"  
class="td11"> Buﬀer size, in chunks, in the peers</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-5-1"  
class="td11"> <!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>B</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-5-2"  
class="td11"> Length of the list of the last <!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>B</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
></math> peers served by the splitter  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-6-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-6-1"  
class="td11"> <!--l. 21--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>D</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-6-2"  
class="td11"> Diameter of the ﬂooding tree                                                                                                                                              </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-7-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-7-1"  
class="td11"> <!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>L</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-7-2"  
class="td11"> Maximum allowed number of lost chunks                                                                                                                              </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-8-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-8-1"  
class="td11"> <!--l. 23--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-8-2"  
class="td11"> Number of monitors</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-9-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-9-1"  
class="td11"> <!--l. 24--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-9-2"  
class="td11"> Average bit-rate of the media                                                                                                                                              </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-10-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-10-1"  
class="td11">                                                            Variable  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-10-2"  
class="td11">                                                                                                                   </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-11-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-11-1"  
class="td11"> <!--l. 27--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-11-2"  
class="td11"> Number of peers in the team                                                                                                                                              </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-12-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-12-1"  
class="td11"> <!--l. 28--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>c</mi></mrow></msub 
></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-12-2"  
class="td11"> Chunk time                                                                                                                                                                     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-13-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-13-1"  
class="td11"> <!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>r</mi></mrow></msub 
></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-13-2"  
class="td11"> Round time                                                                                                                                                                     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-14-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-14-1"  
class="td11"> <!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>b</mi></mrow></msub 
></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-14-2"  
class="td11"> Buﬀering time                                                                                                                                                                 </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-15-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-15-1"  
class="td11"> <!--l. 31--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>p</mi></mrow></msub 
></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-15-2"  
class="td11"> Physical network latency                                                                                                                                                   </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-16-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-16-1"  
class="td11"> <!--l. 32--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>s</mi></mrow></msub 
></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-16-2"  
class="td11"> Start-up time                                                                                                                                                                  </td></tr></table>
</div>
<br /> <div class="caption" 
><span class="id">Table 1: </span><span  
class="content">Nomenclature used in DBS.</span></div><!--tex4ht:label?: x1-50011 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
   </div>
<!--l. 38--><p class="indent" >   DBS provides <a 
href="#glo:ALM">ALM</a> of a <a 
href="#glo:media">media</a> <a 
href="#glo:stream">stream</a> in an <a 
href="#glo:unicast">unicat</a> environment. The media is
sent by a streaming <a 
href="#glo:server">server</a> (which is an external P2PSP entity), and received by a
<a 
href="#glo:splitter">splitter</a>(see Sec. <a 
href="#x1-40001">1<!--tex4ht:ref: sec:LBS --></a>) . The splitter divides the stream into a sequence of <a 
href="#glo:chunk">chunk</a>s of
data, and relay them to a <a 
href="#glo:team">team</a> of peers, following a round-robing schema. Each peer
of a team gathers the chunks from the splitter and the rest of peers of the team, and
sends them to at least one <a 
href="#glo:player">player</a>Peer should run even if no player(s) are connected to
it. .
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.1   </span> <a 
 id="x1-60002.1"></a>Team deﬁnition and types of peers</h4>
<!--l. 7--><p class="noindent" >For the splitter, a team is a set of one or more peers (referenced by their end-points)
that share the same stream. By deﬁnition, in a team of size one (the corresponding
splitter is considered out of the team that it feeds), the only peer is known as a
<a 
href="#glo:monitor">monitor</a> peer, and in a team with more than one peer, at least one of them must be a
monitor. Monitors are instantiated by the overlay administrator to check diﬀerent
aspects of the broadcasting, such as, the quality of the rendered video at the peers or
the end-user latency.
</p><!--l. 16--><p class="indent" >   The number of peers (normal peers and monitors) in a team has a maximum
<!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math> (see
Tab. <a 
href="#x1-50011">1<!--tex4ht:ref: tab:DBS_nomenclature --></a>). This parameter has an impact on the latency of the protocol (see Sec. <a 
href="#x1-90002.4">2.4<!--tex4ht:ref: sec:buffering_chunks --></a>),
and usually is deﬁned by the administrator of the overlay.
</p><!--l. 11--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.2   </span> <a 
 id="x1-70002.2"></a>Feeding the team</h4>
<!--l. 7--><p class="noindent" >The splitter divides the stream into chunks of constant length
<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>C</mi></math>, and sends exclusively each
chunk to a diﬀerent <a 
href="#glo:origin">origin</a><span class="footnote-mark"><a 
href="index6.html#fn5x0"><sup class="textsuperscript">5</sup></a></span><a 
 id="x1-7001f5"></a> 
peer, using a round-robin schema. Chunks are enumerated to distinguish them, and
this information is transmitted as a part of a chunk header.
</p><!--l. 31--><p class="indent" >   We deﬁne a <a 
href="#glo:round">round</a> as the process of transmitting
<!--l. 31--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math> diﬀerent chunks from
the splitter to a team of <!--l. 32--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi> <mo 
class="MathClass-rel">≤</mo> <msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math>
peers (therefore, all the peers of the team are origin of a diﬀerent chunk, in each round). For
a team of size <!--l. 34--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math>,
the <a 
href="#glo:round-time">round time</a> can be estimated as </p><table class="equation"><tr><td> <a 
 id="x1-7002r1"></a>
                                                                  

                                                                  
<!--l. 36--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                             <msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>r</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <mi 
>N</mi><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>C</mi></mrow></msub 
><mo 
class="MathClass-punc">.</mo>
</math></td><td class="eq-no">(1)</td></tr></table>
<!--l. 39--><p class="indent" >   Notice that <!--l. 39--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>r</mi></mrow></msub 
></math>
is generally variable, and depends on the current number of peers in the team
(<!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math>),
and the <a 
href="#glo:chunk-time">chunk time</a> </p><table class="equation"><tr><td> <a 
 id="x1-7003r2"></a>
<!--l. 42--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                              <msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>c</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <mfrac><mrow 
><mi 
>C</mi></mrow> 
<mrow 
><mi 
>R</mi></mrow></mfrac><mo 
class="MathClass-punc">,</mo>
</math></td><td class="eq-no">(2)</td></tr></table>
<!--l. 46--><p class="indent" >   which depends on the chunk size <!--l. 46--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>C</mi></math>
and the average bit-rate of the media stream
<!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi></math>.
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.3   </span> <a 
 id="x1-80002.3"></a>Joining a team</h4>
<!--l. 7--><p class="noindent" >After connecting with a splitter, incoming peers request (using
a reliable communication) to the splitter the current list of peers
in the team. To minimize the <a 
href="#glo:joining-time">joining time</a>, the peer sends a short
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math> message to
each other peer of the team, in parallel with the reception of the list. When a peer of the team
receives a <!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>,
it adds the sender of the message to the team
list<span class="footnote-mark"><a 
href="index7.html#fn6x0"><sup class="textsuperscript">6</sup></a></span><a 
 id="x1-8001f6"></a>  and to a table
of peers called <!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">forward</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math> (see
<a 
href="https://github.com/P2PSP/simulator/blob/f0c73be1817e7d3b816cc61cd2c8e59b17f9a0e6/src/core/peer_dbs.py#L491" ><!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >forward[]</mtext></mstyle></math> in <span 
class="ectt-1000">peer.py</span></a>). If a
                                                                  

                                                                  
peer <!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> has an entry
<!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">forward</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">=</mo> <msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math>, then each chunk
received by <!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> and
originated at <!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math> will be
forwarded to <!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math>. When
an incoming peer <!--l. 21--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
has received the list of peers, its forwarding table has been initialized to
<!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">forward</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><mstyle 
class="text"><mtext  >team</mtext></mstyle> <mo 
class="MathClass-bin">∖</mo> <msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">}</mo></mrow></math>.
Notice that, as long as the forwarding table contains this information, all chunks
received from the splitter will be forwarded to the rest of the team, directly (in one
single hop). So, in absence of communication constraints, the team will be organized
as a full-connected overlay (see Fig. <a 
href="#x1-11001r1">2a<!--tex4ht:ref: fig:full_mesh --></a>).
</p><!--l. 36--><p class="indent" >   The splitter, in an inﬁnite loop: (1) listens to the incoming peers, (2) sends to
them the list of peers of the team, and (3) includes the incoming peer to the list.
Notice that only those peers that are in the list of peers of the splitter are considered
to be in the team served by such splitter.
</p><!--l. 53--><p class="indent" >   <span 
class="ecbx-1000">Note:  </span>See <a 
href="https://github.com/P2PSP/simulator/blob/f0c73be1817e7d3b816cc61cd2c8e59b17f9a0e6/src/core/splitter_dbs.py#L296" ><!--l. 54--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >destination_of_chunk</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
in <span 
class="ectt-1000">peer_dbs.py</span></a>.
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.4   </span> <a 
 id="x1-90002.4"></a>Buﬀering chunks</h4>
<!--l. 7--><p class="noindent" >In order to hide the jitter generated by the physical network and the
protocol itself, peers need to store the received chunks in a buﬀer during
a period of time, before sending them to a player. A chunk with number
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math> is inserted in the
position <!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>x</mi><mspace width="1em" class="nbsp" /><mi mathvariant="italic">mod</mi><mspace width="1em" class="nbsp" /><mn>2</mn><mi 
>B</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></math> of the
buﬀer, where <!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>
is the maximum number of chunks that the buﬀer stores. In a peer’s life,
<!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math> is a
constant especiﬁed by the user, but it is not compulsory that all peers of a team use
the same buﬀer size.
</p><!--l. 16--><p class="indent" >   The buﬀer is implemented as a circular queue of
<!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>2</mn><mi 
>B</mi></math> chunks, what is ﬁlled
with up to <!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math> chunks during
the <a 
href="#glo:buffering-time">buﬀering time</a> <!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>b</mi></mrow></msub 
></math>,
which is the main part of the <a 
href="#glo:start-up-time">start-up time</a> that the users experiment.
Chunks with a higher number (newer chunks) are inserted near of
(depending on the order in which the chunks arrive to the peer) the head
of the buﬀer. The (received) chunks pointed by the tail of the buﬀer
<!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>p</mi></mrow><mrow 
><mi 
>p</mi></mrow></msub 
></math> (the
playing pointer) are sent to the player. This action is carried out each time a new chunk is
                                                                  

                                                                  
received<span class="footnote-mark"><a 
href="index8.html#fn7x0"><sup class="textsuperscript">7</sup></a></span><a 
 id="x1-9001f7"></a> .
During the playing process, empty cells in the buﬀer (caused by the chunks that
have not been received on time) are skipped until to ﬁnd the next cell with
content.
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.5   </span> <a 
 id="x1-100002.5"></a>Buﬀering time estimation</h4>
<!--l. 6--><p class="noindent" >The buﬀering-time, estimated by </p><table class="equation"><tr><td> <a 
 id="x1-10001r3"></a>
<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                             <msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>b</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <mi 
>B</mi><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>c</mi></mrow></msub 
><mo 
class="MathClass-punc">,</mo>
</math></td><td class="eq-no">(3)</td></tr></table>
<!--l. 11--><p class="indent" >   determines how long the peers must wait for start playing the chunks. For real-time
communications, <!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>b</mi></mrow></msub 
></math>
should be as small as possible, and to achieve this we can reduce
<!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>c</mi></mrow></msub 
></math> and
<!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>.
Unfortunately, these reductions generate another drawbacks. On the one hand, the
overhead of the header of the transport protocol is inversely proportional to
<!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>c</mi></mrow></msub 
></math>, and
therefore, <!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>c</mi></mrow></msub 
></math>
should be large enough to keep under control this overhead. On the other hand, if
<!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math> is too small (for
example, if <!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math>)
the peer will not have enought space to buﬀer all the chunks of a round, and due to
the probability of receiving all the chunks in order is very small, some chunks will
overwrite others before they can be played. This problem can also happen even if
<!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
><mo 
class="MathClass-rel">≤</mo> <mi 
>B</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mn>2</mn><msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math>, because
the maximum jitter for a given peer (generated by DBS) that a chunk can experiment is
the sum of the maximum jitter produced by the splitter for this peer, that can be
<!--l. 25--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math>,
and the maximum jitter produced by the team, that also can be
<!--l. 26--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math>.
                                                                  

                                                                  
Notice that this jitter is the same for the two extreme topologies of the
overlay: (1) a full-connected mesh (Fig. <a 
href="#x1-11001r1">2a<!--tex4ht:ref: fig:full_mesh --></a>) or (2) a ring (Fig. <a 
href="#x1-11002r2">2b<!--tex4ht:ref: fig:star --></a>), and
both topologies are possible in real scenarios. Therefore, users should select </p><table class="equation"><tr><td>
<a 
 id="x1-10002r4"></a>
<!--l. 31--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                             <mi 
>B</mi> <mo 
class="MathClass-rel">≥</mo> <mn>2</mn><msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
><mo 
class="MathClass-punc">.</mo>
</math></td><td class="eq-no">(4)</td></tr></table>
<!--l. 36--><p class="indent" >   Given a <!--l. 36--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math> value,
DBS peers may buﬀer a diﬀerent number of chunks that depends on the order in which chunks
are received. If <!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
is the (number of the) ﬁrst received chunk (the ﬁrst chunk to be played), the
buﬀering time ﬁnishes when a chunk with number equal or greater than
<!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>1</mn><mo 
class="MathClass-bin">+</mo><mi 
>B</mi></mrow></msub 
></math> is
received.<span class="footnote-mark"><a 
href="index9.html#fn8x0"><sup class="textsuperscript">8</sup></a></span><a 
 id="x1-10003f8"></a> 
Lets analyze some interesting cases.
</p><!--l. 47--><p class="indent" >   Lets suppose that the ﬁrst received chunk is
<!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and that the rest of chunks of the buﬀer of size
<!--l. 48--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math> are received,
being the chunk <!--l. 49--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>1</mn><mo 
class="MathClass-bin">+</mo><mi 
>B</mi></mrow></msub 
></math>
the last one (this is the ideal scenario). In this case, the stream can be played without
artifacts. Because the playing of the chunks starts after the buﬀering process, the
<a 
href="#glo:start-up-time">start-up time</a> experimented by users in the ideal case can be estimated by </p><table class="equation"><tr><td>
<a 
 id="x1-10004r5"></a>
                                                                  

                                                                  
<!--l. 53--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                            <msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>s</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>b</mi></mrow></msub 
> <mo 
class="MathClass-bin">+</mo> <msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>p</mi></mrow></msub 
><mo 
class="MathClass-punc">,</mo>
</math></td><td class="eq-no">(5)</td></tr></table>
<!--l. 57--><p class="indent" >   being <!--l. 57--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>p</mi></mrow></msub 
></math>
the latency generated by the physical layer.
</p><!--l. 59--><p class="indent" >   Imagine now one of the worst possible scenarios, in which after receiving
<!--l. 60--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math> the chunk
<!--l. 60--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>1</mn><mo 
class="MathClass-bin">+</mo><mi 
>B</mi></mrow></msub 
></math> is received. In this
case, the chunks <!--l. 61--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>1</mn><mo 
class="MathClass-bin">+</mo><mi 
>B</mi><mo 
class="MathClass-bin">−</mo><mn>1</mn></mrow></msub 
></math>
have been lost or delayed too much, but again (and considering that
<!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>c</mi></mrow></msub 
></math> is a
constant), the buﬀering-time is corresponds also with Eq. <a 
href="#x1-10001r3">3<!--tex4ht:ref: eq:t_b --></a>, because the chunk
<!--l. 63--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>1</mn><mo 
class="MathClass-bin">+</mo><mi 
>B</mi></mrow></msub 
></math> was generated
<!--l. 64--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math> chunk-times
after <!--l. 64--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>.
Therefore, in this case the start-up-time can be also estimated by Eq. <a 
href="#x1-10004r5">5<!--tex4ht:ref: eq:start-up-time --></a>.
</p><!--l. 67--><p class="indent" >   After considering these two extreme situations, we can deduce that
the start-up-time does not depend on the loss chunk ratio during the
buﬀering-time (always that this ratio is smaller than one), but only on
<!--l. 70--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>,
<!--l. 70--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>c</mi></mrow></msub 
></math> and
<!--l. 70--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>p</mi></mrow></msub 
></math>.
Notice that, as a rule of thumb, it holds that the larger the buﬀer size,
the lower the probability of lossing chunks as a consecuence of a high
<!--l. 72--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Δ</mi><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>p</mi></mrow></msub 
></math>
(physical jitter).
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.6   </span> <a 
 id="x1-110002.6"></a>Chunk ﬂooding</h4>
<!--l. 15--><p class="noindent" >DBS implements a push-based protocol. When a peer receives a chunk, it can be
retransmitted to a large number of neighbors (depending on the number of diﬀerent
destination peers in its forwarding table for the origin of the chunk). Therefore, even
if the chunk rate is controlled by the streaming servers, some kind of ﬂow control
must be performed by the peers in order to reduce network congestion while the
chunks are ﬂooded.
                                                                  

                                                                  
</p><!--l. 27--><p class="indent" >   <a 
 id="x1-110032"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<a 
 id="x1-11001r1"></a>
 <!--l. 29--><p class="noindent" ><div style="text-align:center;"> <img width=400 src="graphics/full-mesh.svg" /> </div> 
<span 
class="ecrm-0800">(a) A full-connected overlay.</span>
<a 
 id="x1-11002r2"></a> </p><!--l. 32--><p class="noindent" ><div style="text-align:center;"> <img width=400 src="graphics/star.svg" /> </div> 
<span 
class="ecrm-0800">(b) A star-shaped overlay.</span>
<br /> </p><div class="caption" 
><span class="id">Figure 2: </span><span  
class="content">In a full-connected DBS team (see Subﬁg. (a)), all peers receive and
send the same number of chunks. In a star-shaped DBS team (Subﬁg. (b)),
<!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
should send all the chunks of the stream to the rest of the team, except those
that the splitter has sent directly to them.</span></div><!--tex4ht:label?: x1-110032 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
<!--l. 40--><p class="indent" >   The congestion (in particular, the one caused by how DBS nodes use the physical
links) may be avoided by means of a basic idea: <span 
class="ecti-1000">only if I have received a chunk, I</span>
<span 
class="ecti-1000">send (not necessary to the sender) a chunk (not necessary the received chunk)</span>. It is
easy to see that, in a fully connected overlay (see Fig. <a 
href="#x1-11001r1">2a<!--tex4ht:ref: fig:full_mesh --></a>), this allows to control the
data ﬂow. However, in more realistic scenarios, where the physical media imposes
interconnexion constraints (such as those generated by ﬁrewalls and symmetric
NATS), peers can not be directly “connected” with the rest the team, and
therefore, if the splitter follows a pure round-robin strategy, some peers will send
more chunks than they receive (as happens for example in Fig. <a 
href="#x1-11002r2">2b<!--tex4ht:ref: fig:star --></a>). In these
scenarios, the simple idea of sending a chunk for each received one does not
work.
</p><!--l. 54--><p class="indent" >   Fortunately, the previous idea can be adapted to handle a variable connectivity
degree (also called <a 
href="#glo:neighborhood-degree">neighborhood degree</a>) if each peer uses a table of lists,
<!--l. 56--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">pending</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>,
indexed by the neighbor’s end-points, where each list references the positions in the
buﬀer of those chunks that must be transmited to the corresponding neighbor, the
next time such neighbor is selected in the ﬂooding process. For example, if
<!--l. 60--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">pending</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>x</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><mn>1</mn><mn>1</mn><mo 
class="MathClass-punc">,</mo><mn>2</mn><mn>2</mn></mrow><mo 
class="MathClass-close">}</mo></mrow></math>, chunks found
at positions <!--l. 61--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn><mn>1</mn></math> and
<!--l. 61--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>2</mn><mn>2</mn></math> of the buﬀer have
to be sent to peer <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>x</mi></mrow></msub 
></math>.
</p><!--l. 64--><p class="indent" >   Notice that using this procedure, more than one chunk can be sent to a neighbor
in a transmission burst, which could congest the physical devices. However, except in
very unbalanced overlays (as for example the shown in the Fig. <a 
href="#x1-11002r2">2b<!--tex4ht:ref: fig:star --></a>), the bursts are
very short on average (only one chunk in most of cases). As an advantage, when a
burst is produced, all the chunks of the burst travel between the two same hosts,
which usually increases the performance of the layer-3 routing. Moreover, in this
case, chunks could be grouped in one single packet, reducing the protocol
overhead.
</p><!--l. 74--><p class="indent" >   An example of the temporal evolution of a team using the ﬂooding algorithm has
been described in the Figures <a 
href="#x1-110043">3<!--tex4ht:ref: fig:team_0 --></a>, <a 
href="#x1-110054">4<!--tex4ht:ref: fig:team_1 --></a> and <a 
href="#x1-110065">5<!--tex4ht:ref: fig:team_2 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-110043"></a>
                                                                  

                                                                  
<!--l. 79--><p class="noindent" ><div style="text-align:center;"> <img width=250 src="graphics/team_0.svg" /> </div> 
<br />  </p><div class="caption" 
><span class="id">Figure 3:    </span><span  
class="content">A    team    has    been    created    with    a    single    monitor
<!--l. 86--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
(<!--l. 86--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
messages   are   not   shown).   Chunks   with   numbers   0   and   1   (the   time
<!--l. 86--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>t</mi></math>
is   measured   in   chunks-time)   have   been   transmitted   from   the   splitter
<!--l. 86--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
to <!--l. 86--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>.
<!--l. 86--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>f</mi></math>
and <!--l. 86--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>p</mi></math>
represents the <!--l. 86--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >forward</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
and the <!--l. 86--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >pending</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
structures, respectively. The chunks stored in the buﬀer are shown below the
entity.</span></div><!--tex4ht:label?: x1-110043 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-110054"></a>
                                                                  

                                                                  
<!--l. 91--><p class="noindent" ><div style="text-align:center;"> <img width=250 src="graphics/team_1.svg" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 4: </span><span  
class="content">At <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>,
peer <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
joins the team (the <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>’s
are not shown). In <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>,
<!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>f</mi> <mo 
class="MathClass-rel">=</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
> <mo 
class="MathClass-punc">:</mo> <mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></mrow><mo 
class="MathClass-close">}</mo></mrow></math>
because when <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
receives the <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
from <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>,
<!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is      the      origin      peer      for      all      chunks      received      from
<!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
and <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
is its neighbor. <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
includes an entry <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
> <mo 
class="MathClass-punc">:</mo> <mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
in its forwarding table because <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is      in      the      set      of      peers      received      from      the      splitter.
After      that,      when      the      chunk      number      2      arrives      to
<!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
from <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>,
an entry <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
> <mo 
class="MathClass-punc">:</mo> <mn>2</mn></math>
is created in <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>P</mi><mrow ><mo 
class="MathClass-open">{</mo><mrow></mrow><mo 
class="MathClass-close">}</mo></mrow></math>
for  that  chunk,  and  this  entry  is  deleted  when  the  chunk  2  is  sent  to
<!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>.</span></div><!--tex4ht:label?: x1-110054 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-110065"></a>
                                                                  

                                                                  
<!--l. 106--><p class="noindent" ><div style="text-align:center;"> <img width=300 src="graphics/team_2.svg" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 5: </span><span  
class="content"><!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
joins the team. <!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
and <!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
includes <!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
in     their     forwarding     tables.     The     chunk     3     is     received     by
<!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
which decides to send it to <!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>.
Chunk       3       remains       as       pending       to       be       sent       to
<!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
when the next chunk is received by <!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>.</span></div><!--tex4ht:label?: x1-110065 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-110076"></a>
                                                                  

                                                                  
<!--l. 117--><p class="noindent" ><div style="text-align:center;"> <img width=330 src="graphics/team_3.svg" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 6: </span><span  
class="content">Chunk 4 is received by <!--l. 119--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
which relays it to <!--l. 119--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>,
what relays chunk 3 to <!--l. 119--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>.</span></div><!--tex4ht:label?: x1-110076 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-110087"></a>
                                                                  

                                                                  
<!--l. 124--><p class="noindent" ><div style="text-align:center;"> <img width=330 src="graphics/team_4.svg" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 7: </span><span  
class="content">Chunk 5 is received by <!--l. 126--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
which relays it to <!--l. 126--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>.</span></div><!--tex4ht:label?: x1-110087 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
<!--l. 130--><p class="indent" >   <span 
class="ecbx-1000">Note:</span>
                                                                  

                                                                  
</p><!--l. 132--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div style="text-align:center;"> <img width=350 src="graphics/team_5.svg" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 136--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div style="text-align:center;"> <img width=380 src="graphics/team_6.svg" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 140--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div style="text-align:center;"> <img width=320 src="graphics/team_7.svg" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 144--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div style="text-align:center;"> <img width=200 src="graphics/team_8.svg" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 148--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div style="text-align:center;"> <img width=280 src="graphics/team_9.svg" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 152--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div style="text-align:center;"> <img width=380 src="graphics/team_10.svg" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 156--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div style="text-align:center;"> <img width=210 src="graphics/team_11.svg" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 160--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div style="text-align:center;"> <img width=210 src="graphics/team_12.svg" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 164--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div style="text-align:center;"> <img width=210 src="graphics/team_13.svg" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
   <h4 class="subsectionHead"><span class="titlemark">2.7   </span> <a 
 id="x1-120002.7"></a>Routes discovery and topology optimization</h4>
<!--l. 7--><p class="noindent" >Chunks can be lost under bandwidth and buﬀering time constraints (a chunk
is lost when it is time to send it to the player, i.e. when it is pointed by
<!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>p</mi></mrow><mrow 
><mi 
>p</mi></mrow></msub 
></math>, and the
chunk has not been received). Because of that when a peer realizes that a chunk pointed by
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>p</mi></mrow><mrow 
><mi 
>p</mi></mrow></msub 
></math> has been
lost, nothing can be done to recover it, peers pre-fetch “potentially lost” chunks at the buﬀer
position <!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>p</mi></mrow><mrow 
><mi 
>p</mi></mrow></msub 
> <mo 
class="MathClass-bin">+</mo> <msub><mrow 
><mi 
>p</mi></mrow><mrow 
><mi 
>h</mi></mrow></msub 
></math>, where
<!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>p</mi></mrow><mrow 
><mi 
>h</mi></mrow></msub 
> <mo 
class="MathClass-rel">≥</mo> <mn>0</mn></math> is the pre-feching
horizon. Notice that if <!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>p</mi></mrow><mrow 
><mi 
>h</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <mn>0</mn></math>,
the pre-fetching is disabled and only those chunks that really
are lost will be requested. On the contrary, the higher the
<!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>p</mi></mrow><mrow 
><mi 
>h</mi></mrow></msub 
></math>, the
more agressive the pre-fetching.
</p><!--l. 18--><p class="indent" >   For each (potentially) lost chunk with number
<!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >lost_chunk_number</mtext></mstyle></math>, peers
send a <!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">request</mi><mspace width="1em" class="nbsp" /><mstyle 
class="text"><mtext  >lost_chunk_number</mtext></mstyle></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
message to a random peer of the team. When a peer
<!--l. 21--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> receives such
message from a <!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math>,
<!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> adds
<!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math> to
<!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">forward</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>,
where <!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math>
is the origin peer of the chunk stored in the position
<!--l. 24--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mstyle 
class="text"><mtext  >lost_chunk_number</mtext></mstyle><mspace width="1em" class="nbsp" /><mi mathvariant="italic">mod</mi><mspace width="1em" class="nbsp" /><mn>2</mn><mi 
>B</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></math> of its
buﬀer, this chunks has been received. Otherwise, the request is ignored. Notice that,
although request messages are very short, they are an overhead.
</p><!--l. 28--><p class="indent" >   When request messages are used, redundant routes can be created and
therefore, some chunks could be received more than once. Obviously,
this is also an overhead that must be minimized. To achieve this, the
receiver of the prunning message counts the number of times that a origin
peer has been pruned, and when this counters is higher than a threshold
<!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math> (the
maximum number of generated duplicates), the corresponding entry in the
<!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >forward</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math> table
is deleted.
</p><!--l. 32--><p class="indent" >   Now, we can deﬁne more accurately the <a 
href="#glo:neighborhood-degree">neighborhood degree</a> (see Sec. <a 
href="#x1-110002.6">2.6<!--tex4ht:ref: sec:chunk_flooding --></a>) as the number of
diﬀerent destination peers for each possible origin that a peer forwards. For example, if a peer
<!--l. 35--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> forwards chunks
from the origin <!--l. 35--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
to 10 neighbors, the neighborhood degree of
                                                                  

                                                                  
<!--l. 36--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> for the origin
<!--l. 36--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> is 10, and if the peer
<!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> also forwards chunks from
an origin <!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math> to 5 neighbors,
the neighborhood degree of <!--l. 38--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
for the origin <!--l. 38--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math>
is 5.
</p><!--l. 40--><p class="indent" >   Considering the rules described before, the neighborhood degrees of peers can
decrease or increase to optimize the topology of the overlay, by minimizing
<!--l. 42--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Δ</mi><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mi 
>b</mi></mrow></msub 
></math>.
An increment in the degree for the origin of a requested chunk
<!--l. 43--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >lost_chunk_number</mtext></mstyle></math> in
<!--l. 43--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> is produced
when <!--l. 43--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> recives
a <!--l. 44--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">request</mi><mspace width="1em" class="nbsp" /><mstyle 
class="text"><mtext  >lost_chunk_number</mtext></mstyle></mrow><mo 
class="MathClass-close">]</mo></mrow></math> from a peer
that is not a neighbor, yet. On the contrary, a decrement in the degree for the origin of a
pruned chunk <!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >duplicate_chunk_index</mtext></mstyle></math>
in <!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> is produced
when <!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
receives a <!--l. 48--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">prune</mi><mspace width="1em" class="nbsp" /><mstyle 
class="text"><mtext  >duplicate_chunk_index</mtext></mstyle></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
from a neighbor peer, for that origin. In fact, the continued
use of the requesting and prunning messages produce in a peer
<!--l. 50--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> that the
list <!--l. 51--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >forward</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
gets shorter (smaller <a 
href="#glo:neighborhood-degree">neighborhood degree</a>) and new entries in the table
<!--l. 52--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >forward</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math> are
created.
</p><!--l. 32--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.8   </span> <a 
 id="x1-130002.8"></a>Leaving a team</h4>
<!--l. 5--><p class="noindent" >An outgoing peer must to: (1) say <!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">goodbye</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
to the splitter and the neighbor peers (in this order), (2) relay
any pending (received but yet not sent) chunks, and (3) wait for a
<!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">goodbye</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math> from the splitter. In
case of timeout<span class="footnote-mark"><a 
href="index10.html#fn9x0"><sup class="textsuperscript">9</sup></a></span><a 
 id="x1-13001f9"></a> ,
the leaving procedure is reset a number of times.
</p><!--l. 12--><p class="indent" >   When a peer <!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
receives a <!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">goodbye</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
from <!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math>,
<!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> removes
<!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math> from all the lists (all
                                                                  

                                                                  
the posible origins) of <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">forward</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
table. The splitter removes the outgoing peer from the list of peers as soon as the
<!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">goodbye</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math> is
received, to avoid sending chunks to it.
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.9   </span> <a 
 id="x1-140002.9"></a>Free-riding control at the splitter</h4>
<!--l. 7--><p class="noindent" >The splitter remembers which chunk, of a list of the last
<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>B</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
></math>
transmitted chunks, was sent to each peer of the team. Notice that, in order to
remember the chunk that was sent to each peer in each round, it must be hold that
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>B</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
><mo 
class="MathClass-rel">≥</mo> <mi 
>N</mi></math>. See
<a 
href="https://github.com/P2PSP/simulator/blob/f0c73be1817e7d3b816cc61cd2c8e59b17f9a0e6/src/core/splitter_dbs.py#L296" ><!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >destination_of_chunk</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math> in
<span 
class="ectt-1000">splitter_dbs.py</span></a>.
</p><!--l. 14--><p class="indent" >   Monitor peers (which are trusted peers) complain to their splitter with a
<!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">lost</mi><mspace width="1em" class="nbsp" /><mstyle 
class="text"><mtext  >lost_chunk_number</mtext></mstyle></mrow><mo 
class="MathClass-close">]</mo></mrow></math> for
each lost chunk. The splitter only considers these type of messages if they come from
a monitor.
</p><!--l. 24--><p class="indent" >   <span 
class="ecbx-1000">Note:  </span>This last functionality has not been implemented, at least, as it has been
explained here. The forget() thread is controlled by a timer, not by a counter of
rounds.
</p><!--l. 45--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-150003"></a>ACS (Adaptive Capacity Set)</h3>
<!--l. 5--><p class="noindent" ><span 
class="ecbx-1000">Note:  </span>Unﬁnished. This set is incompatible with FCS (see Sec. <a 
href="#x1-160004">4<!--tex4ht:ref: sec:FCS --></a>).
</p><!--l. 10--><p class="noindent" >ACS modiﬁes the functionality of DBS.
</p><!--l. 12--><p class="indent" >   Basically, ACS relaxes the peer’s uploading requirements imposed by DBS. ACS
is based on the idea of using the information that the splitter knows about the
number of chunks that each peer has lost (see Sec. <a 
href="#x1-140002.9">2.9<!--tex4ht:ref: sec:free_riding_control --></a>), to send to the more reliable
peers a higher number of chunks. In other words, ACS adapts the round-time of each
peer to its capacity, in such a way that the higher the capacity, the lower the <a 
href="#glo:round-time">round
time</a>.
</p><!--l. 20--><p class="indent" >   ACS should be used if we want that some peers to put the uploading capacity
than others cannot provide. A possible situation could be when we want to mix the
CS and P2P models, sending more chunks from the contents provider’s hosts
to the users’s peers, with the objective, for example, of incrementing the
QoS. Because monitors should lost a minimum number of chunks (supposely
the hosts of the contents provider should have enough capacity), the ratio
of chunks emitted by the contents provider’s hosts can be controlled if a
                                                                  

                                                                  
high enough number of monitor peers (the more monitors, the higher the
ratio).
</p><!--l. 31--><p class="indent" >   Notice that ACS only aﬀects the behavior of the splitter.
</p><!--l. 48--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-160004"></a>FCS (Free-riding Control Set)</h3>
<!--l. 6--><p class="noindent" ><span 
class="ecbx-1000">Note:  </span>Finished but not implemented. This set is incompatible with ACS (see
Sec <a 
href="#x1-150003">3<!--tex4ht:ref: sec:ACS --></a>).
</p><!--l. 10--><p class="noindent" >FCS extends the functionality of DBS.
</p><!--l. 12--><p class="indent" >   DBS does not imposes any control over the grade of solidarity of the peers. This
means that selﬁsh peers (or simply peers with reduced connectivity) can stay in the
team thanks to the generosity of the rest of peers, even if they never achive to deliver
a chunk to any peer of the team. This set or rules preclude this possible
behavior, by impossing a minimum degree of solidarity between neighbor
peers.
</p><!--l. 19--><p class="indent" >   To know the level of solidarity between neighbor peers, each peer uses a table of chunk debts,
<!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">debt</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>. Every time
a peer <!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> sends
a chunk to <!--l. 21--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math>,
<!--l. 21--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> increments
<!--l. 21--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">debt</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>, and
decrements <!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">debt</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
when <!--l. 22--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> receives
a chunk from <!--l. 23--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math>.
</p><!--l. 25--><p class="indent" >   Using DBS, peers forward chunks to their neighbors using a simple round-robing
scheduer) FCS modiﬁes this behavior:
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-16002x1">The <!--l. 27--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">pending</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     table is run in the order provided by <!--l. 28--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">debt</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>,
     selecting ﬁrst those entries with a smaller debts.
     </li>
     <li 
  class="enumerate" id="x1-16004x2">The run of <!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">pending</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     is reset in each round (when a chunk is received from the splitter). This
     means that each round starts sending the pending chunks to those peers
     with a smaller debt.
     </li>
     <li 
  class="enumerate" id="x1-16006x3">If <!--l. 34--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
     realises that <!--l. 34--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">debt</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">&#x003E;</mo> <msup><mrow 
><mi 
>L</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math>,
     <!--l. 34--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
     removes <!--l. 35--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math>
                                                                  

                                                                  
     from <!--l. 35--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">forward</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><mo 
class="MathClass-op">∀</mo><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
> <mo 
class="MathClass-rel">∈</mo><mrow ><mo 
class="MathClass-open">{</mo><mrow><mstyle 
class="text"><mtext  >team</mtext></mstyle> <mo 
class="MathClass-bin">∪</mo> <msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">}</mo></mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     and from <!--l. 36--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">pending</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>.
     Notice that this action decreases the <a 
href="#glo:neighborhood-degree">neighborhood degree</a> of <!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
     and, soon or later, of <!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math>
     because of it will consider <!--l. 38--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
     as unsupportive.
     </li>
     <li 
  class="enumerate" id="x1-16008x4">In  DBS,  request  messages  are  sent  selecting  the  destination  peers  at
     random. In FCS, request messages are sent to those peers with a higher
     debt. Thus, if the insolidarity is produced by a overlay topology imbalance
     (an extreme example is in Fig. <a 
href="#x1-11002r2">2b<!--tex4ht:ref: fig:star --></a>), badly connected peers peers could
     have the chance of mitigating this problem by forwarding more chunks to
     their neighbors.</li></ol>
<!--l. 47--><p class="indent" >   Using FCS, supportive peers will be served ﬁrst, incrementing the QoE of the
users of the corresponding peers. On the other hand, those peers with a higher chunk
debt will tend to be unserved if no enough bandwidth is available. Notice that FCS is
incompatible with ACS.
</p><!--l. 94--><p class="indent" >   <span 
class="ecbx-1000">Note:  </span>The prioritized round-robin neighbor selection has
not yet been implemented as it has been explained here. The
<!--l. 96--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >debt</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
structure exists, but is used for a diﬀerent purporse.
</p><!--l. 51--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5   </span> <a 
 id="x1-170005"></a>IMS (Ip Multicast Set)</h3>
<!--l. 5--><p class="noindent" ><span 
class="ecbx-1000">Note:  </span>Finished and implemented.
</p><!--l. 9--><p class="noindent" >IMS modiﬁes the functionality of DBS.
</p><!--l. 11--><p class="indent" >   IPM is available by default in LANs (Local Are Networks) and VLANs (Virtual
LANs) <span class="cite">[<a 
href="#Xshabtay2011ip">4</a>]</span>, but not in the Internet <span class="cite">[<a 
href="#XComer1">3</a>]</span>. IMS runs on the top of DBS and provides
eﬃcient native IPM, where available.
</p><!--l. 16--><p class="indent" >   All peers in the same LAN or VLAN have the same network address. When a joining peer
<!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> receives the list
of peers from its splitter, ﬁrst checks if there are neighbors in the same subnet. For all those peers,
<!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> uses the IP address
<!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">224.0.0.1</mi></math> (all systems on this
subnet), (default) port <!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">1234</mi></math>,
to multicast (only) the chunks received from the splitter. Therefore, all peers in
the same local network communicate using this multicast group address
and port. The rest of external peers will be referenced using their public
end-points.
                                                                  

                                                                  
</p><!--l. 54--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">6   </span> <a 
 id="x1-180006"></a>TAS (Topology Adaptation Set)</h3>
<!--l. 5--><p class="noindent" ><span 
class="ecbx-1000">Note:  </span>Unﬁnished.
</p><!--l. 9--><p class="noindent" >In TAS, the splitter request to each peer of the team the list of neighbors
(peers that send chunks directly, in one hop). This communication is reliable
(TCP) and transmits the lists as a collection of end-points. The number of
requests per round is limited by the available bandwidth in the overlay, and by
the request-ratio deﬁned at the splitter. Obviously, the higher the ratio, a
more accurate description of the real connectivity in the overlay will be
obtained.
</p><!--l. 27--><p class="indent" >   After knowing the connectivity degree of each peer, the slitter can adapt the
round-robin scheduling of the origin peers by sending a number of chunks
proportional to the inverse of the degree of the origin peer.
</p><!--l. 57--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">7   </span> <a 
 id="x1-190007"></a>MRS (Massively-lost chunk Recovery Set)</h3>
<!--l. 5--><p class="noindent" ><span 
class="ecbx-1000">Note:  </span>Finished but not implemented.
</p><!--l. 9--><p class="noindent" >MRS extends DBS (or an extension of it) to retransmit massively-lost chunks. MRS
should be implemented if error-prone communications are expected, specially if these
channels are used by the splitter. MRS is based on the use of monitors (see Sec: <a 
href="#x1-140002.9">2.9<!--tex4ht:ref: sec:free_riding_control --></a>).
The idea is: the splitter will resend lost chunks to one or more the monitors when all
monitors report their loss. To increase the probability of receiving on time the resent
chunk (by normal peers), monitors halves the number of chunks in their buﬀers in
relation to common peers. Notice that MRS only modiﬁes the behavior of the
splitters and the monitors (normal peers does no need to implement LRS or its
extensions).
</p><!--l. 60--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">8   </span> <a 
 id="x1-200008"></a>NTS (NAT Traversal Set)</h3>
<!--l. 5--><p class="noindent" ><span 
class="ecbx-1000">Note:  </span>Finished but not implemented.
</p><!--l. 9--><p class="noindent" >Most of the peers run inside of “private” networks, i.e. behind NAT devices.
NTS<span class="footnote-mark"><a 
href="index11.html#fn10x0"><sup class="textsuperscript">10</sup></a></span><a 
 id="x1-20001f10"></a> 
                                                                  

                                                                  
is an DBS extension which provides peer connectivity for some
NAT conﬁgurations where DBS can not provide direct peer
communication.<span class="footnote-mark"><a 
href="index12.html#fn11x0"><sup class="textsuperscript">11</sup></a></span><a 
 id="x1-20002f11"></a> 
</p><!--l. 23--><p class="indent" >   Peers behind the same NAT will use the same external (also called “public”,
because in most cases we have not nested NAT conﬁgurations) IP address of the
NAT. Basically, there exist two diﬀerent types of NATs: (1) <span 
class="ecti-1000">cone</span>, and (2) <span 
class="ecti-1000">symmetric</span>.
At the same time, NATs can implement diﬀerent ﬁltering strategies for the packets
that comes from the external side: (a) <span 
class="ecti-1000">no ﬁltering</span>, (b) <span 
class="ecti-1000">source IP ﬁltering</span>, and
(c) <span 
class="ecti-1000">source end-point ﬁltering</span>. Finally, NATs can use several port allocation
algorithms, among which, the most frequent are: (i) <span 
class="ecti-1000">port preservation </span>and (ii)
<span 
class="ecti-1000">random port</span>. Notice that in this discussion, only UDP transmissions will be
considered.
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.1   </span> <a 
 id="x1-210008.1"></a>Traﬃc ﬁltering</h4>
<!--l. 36--><p class="noindent" >Lets suppose a team in which, for the sake of simplicity, there is only one external (public) peer
<!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>e</mi></mrow></msub 
></math>, and that a new internal
(private) peer <!--l. 38--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> has sent
the sequence of [<!--l. 38--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>]’s (see
Sec <a 
href="#x1-80002.3">2.3<!--tex4ht:ref: sec:joining --></a>). Lets denote <!--l. 39--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>’s
NAT as <!--l. 39--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>. When no
ﬁltering is used at all, <!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
forwards to <!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
any external packet that arrives to it (obviously, if it was sent to the entry in
<!--l. 41--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>’s
translation table that was created during the transmission of the sequence of
[<!--l. 43--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>]’s),
independently on the source end-points of the packets. In the case of source (IP) address
ﬁltering, <!--l. 45--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
will forward the packets only if they come from
<!--l. 46--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>e</mi></mrow></msub 
></math>’s host. When source
end-point ﬁltering is used, <!--l. 46--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
also checks the source port, i.e., that the packets were originated at
<!--l. 48--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>e</mi></mrow></msub 
></math>’s
end-point.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-210018"></a>
                                                                  

                                                                  
<!--l. 51--><p class="noindent" ><div style="text-align:center;"> <img width=500 src="graphics/cone_NAT.svg" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 8: </span><span  
class="content">Cone NAT port allocation.</span></div><!--tex4ht:label?: x1-210018 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-210029"></a>
                                                                  

                                                                  
<!--l. 57--><p class="noindent" ><div style="text-align:center;"> <img width=500 src="graphics/symmetric_NAT.svg" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 9: </span><span  
class="content">Symmetric NAT port allocation.</span></div><!--tex4ht:label?: x1-210029 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">8.2   </span> <a 
 id="x1-220008.2"></a>Cone VS symmetric</h4>
<!--l. 63--><p class="noindent" >Cone NATs use the same external end-point for every packet that comes from the same
internal end-point, independently on the destination of the packets (see Fig. <a 
href="#x1-210029">9<!--tex4ht:ref: fig:cone_NAT --></a>). For the
external peer <!--l. 66--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>e</mi></mrow></msub 
></math>,
the situation is identical to the case in which the NATed peer
<!--l. 67--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> would
be running in a public host.
</p><!--l. 69--><p class="indent" >   Symmetric NATs use diﬀerent external end-points for diﬀerent packets that comes from
the same internal end-point, when these packets have diﬀerent destination end-points
(see Fig. <span 
class="ecbx-1000">??</span>). Thus, two diﬀerent external peers will see two diﬀerent public end-points
of <!--l. 73--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>e</mi></mrow></msub 
></math>.
</p><!--l. 75--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.3   </span> <a 
 id="x1-230008.3"></a>Port allocation</h4>
<!--l. 76--><p class="noindent" >In  the  case  of  port  preservation,  if
<!--l. 76--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>X</mi></math>:<!--l. 76--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math>
is the private end-point (IP address:port) of a UDP packet, the NAT will use the public port
<!--l. 78--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math>, if available
(notice that <!--l. 78--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math>
cound have been assigned to a previous communcation). If
<!--l. 79--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math> were
unavailable, the NAT usually will assign the closer free port (this is called
“sequentially port allocation”), usually by increasing the port value, although this
behavior has not been standarized at all.
</p><!--l. 84--><p class="indent" >   When random port allocation is implemented, the public port will be assigned at
random. Notice that, even in SN-PPA conﬁgurations, in most of the real situations
(where peers must compete with the rest of processes that use the network for the
same NAT resources,) some kind of randomization should be always expected during
a the port assignment.
</p><!--l. 91--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.4   </span> <a 
 id="x1-240008.4"></a>NAT type analysis</h4>
<!--l. 92--><p class="noindent" >An incoming peer <!--l. 92--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
can determine its NAT behavior using the following steps:
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-24002x1">Let <!--l. 95--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mi 
>M</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">}</mo></mrow></math> the public ports
     used by peer <!--l. 96--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>, whose
                                                                  

                                                                  
     NAT is <!--l. 96--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>, to send
     the [<!--l. 96--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>] UDP packets
     towards the splitter <!--l. 97--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     and the <!--l. 97--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     monitor peers of the team, in this order. This data is known by
     <!--l. 98--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
     after receiving the acknowledgment of each
     [<!--l. 99--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>].
     Compute <table class="equation"><tr><td> <a 
 id="x1-24003r6"></a>
     <!--l. 100--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                                         <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo><msub><mrow 
> <mi mathvariant="sans-serif">A</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
> <mo 
class="MathClass-bin">−</mo><msub><mrow 
><mi mathvariant="sans-serif">A</mi></mrow><mrow 
><mi 
>k</mi><mo 
class="MathClass-bin">−</mo><mn>1</mn></mrow></msub 
>
</math></td><td class="eq-no">(6)</td></tr></table>
     <!--l. 104--><p class="noindent" >for <!--l. 104--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>k</mi> <mo 
class="MathClass-rel">=</mo> <mn>1</mn><mo 
class="MathClass-punc">,</mo><mn>2</mn><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><mi 
>M</mi></math>, the <span 
class="ecti-1000">port distances</span>
     gathered by <!--l. 104--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>.
     </p></li>
     <li 
  class="enumerate" id="x1-24005x2">Determine a <span 
class="ecti-1000">port step </span><table class="equation"><tr><td> <a 
 id="x1-24006r7"></a>
     <!--l. 106--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>Δ</mi> <mo 
class="MathClass-rel">=</mo> <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  align="axis" style=""  
equalrows="false" columnlines="none" equalcolumns="false" class="array"> <mtr><mtd 
class="array"  columnalign="left">  <mn>0</mn><mo 
class="MathClass-punc">,</mo>                   </mtd><mtd 
class="array"  columnalign="right"> <mstyle 
class="text"><mtext  >if </mtext></mstyle><mo 
class="MathClass-op">∀</mo><mi 
>i</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <mn>0</mn> </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left">  <mi mathvariant="normal">GCD</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>m</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-punc">,</mo> </mtd><mtd 
class="array"  columnalign="right">    <mstyle 
class="text"><mtext  >otherwise</mtext></mstyle>  </mtd></mtr><!--lr--></mtable>                                                         </mrow></mfenced>
</math></td><td class="eq-no">(7)</td></tr></table>
     <!--l. 113--><p class="noindent" >where GCD is the Greatest Common Divisor operator.
     </p></li>
     <li 
  class="enumerate" id="x1-24008x3">If <!--l. 114--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Δ</mi> <mo 
class="MathClass-rel">=</mo> <mn>0</mn></math>
     (<!--l. 114--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     is using the same external port for communicating
     <!--l. 115--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> with the rest of peers
     of the team) then <!--l. 115--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
                                                                  

                                                                  
     is behind a cone NAT. Notice that public (not NATed) peers will be considered
     as being using this type of NAT, also.
     </li>
     <li 
  class="enumerate" id="x1-24010x4">If <!--l. 118--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Δ</mi> <mo 
class="MathClass-rel">&#x003E;</mo> <mn>0</mn></math>
     (<!--l. 118--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     is using a diﬀerent external port for each external peer) then
     <!--l. 119--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
     is behind a symmetric NAT. In this case:
         <ol  class="enumerate2" >
         <li 
  class="enumerate" id="x1-24012x1">If <table class="equation"><tr><td> <a 
 id="x1-24013r8"></a>
         <!--l. 122--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                                       <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <mo 
class="MathClass-rel">⋯</mo> <mo 
class="MathClass-rel">=</mo> <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>m</mi></mrow></msub 
>
</math></td><td class="eq-no">(8)</td></tr></table>
         <!--l. 125--><p class="noindent" >then <!--l. 125--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
         is using sequentially port allocation.
         </p></li>
         <li 
  class="enumerate" id="x1-24015x2">If <table class="equation"><tr><td> <a 
 id="x1-24016r9"></a>
         <!--l. 127--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                            <mi 
>Δ</mi> <mo 
class="MathClass-rel">=</mo><munder class="msub"><mrow 
><mo class="qopname"> lim</mo></mrow><mrow 
><mi 
>m</mi><mo 
class="MathClass-rel">→</mo><mi 
>∞</mi></mrow></munder 
><mi mathvariant="normal">GCD</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>m</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mn>1</mn><mo 
class="MathClass-punc">.</mo>
</math></td><td class="eq-no">(9)</td></tr></table>
         <!--l. 130--><p class="noindent" >then <!--l. 130--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
         is using random port allocation.</p></li></ol>
     </li></ol>
                                                                  

                                                                  
<!--l. 134--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.5   </span> <a 
 id="x1-250008.5"></a>(Theoretical) NAT traversal performance of DBS</h4>
   <div class="table">
                                                                  

                                                                  
<!--l. 137--><p class="indent" >   <a 
 id="x1-250012"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div class="tabular"> <table id="TBL-4" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-4-1g"><col 
id="TBL-4-1" /></colgroup><colgroup id="TBL-4-2g"><col 
id="TBL-4-2" /></colgroup><colgroup id="TBL-4-3g"><col 
id="TBL-4-3" /></colgroup><colgroup id="TBL-4-4g"><col 
id="TBL-4-4" /></colgroup><colgroup id="TBL-4-5g"><col 
id="TBL-4-5" /></colgroup><colgroup id="TBL-4-6g"><col 
id="TBL-4-6" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-4-1-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-1-1"  
class="td11"> Peer1/2  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-2"  
class="td11">  CN  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-3"  
class="td11"> CN-AF  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-4"  
class="td11"> CN-EF  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-5"  
class="td11"> SN-PPA  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-6"  
class="td11"> SN-RPA  </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-2-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-2-1"  
class="td11"> CN         </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-3"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-4"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-5"  
class="td11">    DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-6"  
class="td11">    DBS  </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-3-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-3-1"  
class="td11"> CN-AF </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-2"  
class="td11"> DBS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-3"  
class="td11"> DBS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-4"  
class="td11"> DBS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-5"  
class="td11"> NTS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-6"  
class="td11"> -</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-4-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-4-1"  
class="td11"> CN-EF    </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-3"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-4"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-5"  
class="td11">    NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-6"  
class="td11">        -  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-5-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-5-1"  
class="td11"> SN-PPA  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-3"  
class="td11">   NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-4"  
class="td11">   NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-5"  
class="td11">    NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-6"  
class="td11">        -  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-6-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-6-1"  
class="td11"> SN-RPA  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-3"  
class="td11">       -  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-4"  
class="td11">      -  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-5"  
class="td11">       -  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-6"  
class="td11">        -  </td></tr></table></div>
<br /> <div class="caption" 
><span class="id">Table 2: </span><span  
class="content">NAT traversal success for diﬀerent NAT typical combinations. CN-NF
(also known by “full cone NAT”) stands for Cone NAT (without packet ﬁltering).
CN-AF (also known as “restricted cone NAT”) stands for Cone NAT with source
Address Filtering. CN-EF (also known by “port restricted cone NAT”) stands for
Cone NAT source End-point Filtering. SN-PPA stands for Symmetric NAT Port
Preservation Allocation, and no packet ﬁltering has been considered. SN-RPA
stands for Symmetric NAT Random Port Allocation, and no packet ﬁltering has
been used.</span></div><!--tex4ht:label?: x1-250012 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-2500210"></a>
                                                                  

                                                                  
<!--l. 160--><p class="noindent" ><div style="text-align:center;"> <img width=600 src="graphics/UDP_Hole_Punching_RCN.svg" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 10: </span><span  
class="content">An example that shows how it is possible to establish a connection
with                  DBS                  when                  two                  peers
<!--l. 163--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and
<!--l. 163--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
that are behind cone NATs.</span></div><!--tex4ht:label?: x1-2500210 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-2500311"></a>
                                                                  

                                                                  
<!--l. 168--><p class="noindent" ><div style="text-align:center;"> <img width=600 src="graphics/UDP_Hole_Punching_SN_failure.svg" /> </div> 
<br />           </p><div class="caption" 
><span class="id">Figure 11:                 </span><span  
class="content">An                 example                 that
shows why its is impossible to establish a connection with DBS when two peers
<!--l. 171--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and
<!--l. 171--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
that are behind symmetric NATs.</span></div><!--tex4ht:label?: x1-2500311 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
                                                                  

                                                                  
<!--l. 176--><p class="indent" >   <a 
 id="x1-2500412"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div style="text-align:center;"> <img width=800 src="graphics/SNTuCPP.svg" /> </div> 
<br /> <div class="caption" 
><span class="id">Figure 12:  </span><span  
class="content">Timeline  of  an  (ideal)  NTS  interaction  between  two  peers
<!--l. 178--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and
<!--l. 178--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
which are behind symmetric NATs.</span></div><!--tex4ht:label?: x1-2500412 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
<!--l. 182--><p class="indent" >   Table <a 
href="#x1-250012">2<!--tex4ht:ref: tab:theoretical --></a> shows the theoretical traversal success of DBS (or an extension of it) for
diﬀerent NAT type combinations. Peer1 represents to a peer already joined to the
team, and Peer2 to an incoming peer. The entries labeled with “DBS” are those
that will be handled by DBS, out-of-the-box. An explanation of why the
DBS handshake works for such conﬁgurations is shown in Fig. <a 
href="#x1-2500210">10<!--tex4ht:ref: fig:UDP_Hole_Punching_RCN --></a>. Notice
that source end-point ﬁltering has been used in this example, although a
similar results should be obtained for simple source address ﬁltering. On the
other hand, the combinations labeled with “-” or “NTS” will not work with
DBS (see Fig.<a 
href="#x1-2500311">11<!--tex4ht:ref: fig:UDP_Hole_Punching_SN_failure --></a>). In fact, only the “NTS” entries should work, in general,
with NTS, depending on the port prediction algorithm and the number of
tries.
</p><!--l. 197--><p class="indent" >   Fig. <a 
href="#x1-2500412">12<!--tex4ht:ref: fig:SNTuCPP --></a> shows an example of an NTS (NAT traversal) success. When the new NATed
peers, <!--l. 198--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and <!--l. 198--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>,
arrive at the team, the following events happen:
</p>
     <ul class="itemize1">
     <li class="itemize"><!--l. 206--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     requests to join the team (the joining request is not shown in the ﬁgure for
     brevity) and <!--l. 207--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     sends to <!--l. 207--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     an empty list of peers. At this moment, <!--l. 208--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     has joined the team.
     </li>
     <li class="itemize"><!--l. 209--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     requests <!--l. 209--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     to join through an external port <!--l. 210--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
     (again, this message is not shown). <!--l. 210--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     sends to <!--l. 210--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     the list of peers. This list contains only the endpoint of <!--l. 211--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>.
     </li>
     <li class="itemize">NAT <!--l. 212--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     relays towards <!--l. 212--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     the previuos message.
     </li>
     <li class="itemize"><!--l. 213--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     answers <!--l. 213--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mi 
>M</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     to <!--l. 213--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>.
     </li>
     <li class="itemize"><!--l. 214--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     relays the previous message, which is received by <!--l. 215--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>.
                                                                  

                                                                  
     Due to <!--l. 215--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     is a symmetric NAT, a new source port <!--l. 215--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     is used for this message.
     </li>
     <li class="itemize"><!--l. 217--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     sends <!--l. 217--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><mi 
>M</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     towards <!--l. 217--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>.
     </li>
     <li class="itemize">The previous message is relayed by <!--l. 218--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>.
     Simultaneously, <!--l. 219--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     informs to <!--l. 219--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     that <!--l. 219--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     has communicated with it, using the external endpoint <!--l. 220--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 221--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     acknowledges the reception of the previous message.
     </li>
     <li class="itemize"><!--l. 223--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     requests to join the team (not shown) and <!--l. 223--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     sends to it the current list of peers, which contains the endpoint of <!--l. 225--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     and the tuple <!--l. 225--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>A</mi></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mi 
>#</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>
     (the external endpoint used by <!--l. 226--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     to communicate with <!--l. 226--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>,
     the maximum port step in NAT <!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>,
     <!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>A</mi></mrow></msub 
></math>
     measured by <!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     for <!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     thoroughtout its incorporation to the team, and the index of <!--l. 229--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>,
     <!--l. 229--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>#</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>,
     in the list of peers). Using this information, <!--l. 230--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     will perform the port prediction for the external port that <!--l. 231--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
mathvariant="bold-script">𝒜</mi></math>
     will assign to <!--l. 231--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     when it be communicating with <!--l. 232--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>.
     This prediction is the list of ports <!--l. 233--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>Z</mi></mrow><mrow 
><mi 
>#</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
> <mo 
class="MathClass-rel">=</mo></math> <span 
class="ectt-0800">get_guessed_ports</span><span 
class="ectt-1000">(</span><!--l. 234--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>#</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math><span 
class="ectt-0800">,</span><!--l. 234--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math><span 
class="ectt-0800">,</span><!--l. 234--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>A</mi></mrow></msub 
></math><span 
class="ectt-1000">)</span>
     is populated by <!--l. 235--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     using the Algorithm <span 
class="ecbx-1000">??</span>.
     </li>
     <li class="itemize"><!--l. 236--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>
     retransmits the previous message.
     </li>
     <li class="itemize"><!--l. 237--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     sends a <!--l. 237--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mi 
>M</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     towards <!--l. 237--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>.
                                                                  

                                                                  
     </li>
     <li class="itemize"><!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>
     retransmits the previous message, which arrives to <!--l. 239--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>,
     and <!--l. 239--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     sends a <!--l. 240--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     towards <!--l. 241--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>,
     which has been computed in the Step 08.
     </li>
     <li class="itemize">The previous message arrives to <!--l. 242--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>
     (which is correct), but <!--l. 243--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     discards this packet because still there is not a working entry in its translation
     table for the key <!--l. 246--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>B</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 247--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     acknowledges the <!--l. 247--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mi 
>M</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>,
     which arrived in the Step 11.
     </li>
     <li class="itemize">The <!--l. 249--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><mi 
>M</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     message is received by <!--l. 249--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     and <!--l. 250--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     informs to <!--l. 250--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     that <!--l. 250--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     is also using the port <!--l. 250--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     (this information is used to compute the maximum port step <!--l. 251--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>B</mi></mrow></msub 
></math>
     in NAT <!--l. 252--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>,
     measured for <!--l. 252--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     thoroughout its incorporation.
     </li>
     <li class="itemize"><!--l. 253--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     acknowledges the previous reception.
     </li>
     <li class="itemize"><!--l. 254--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     sends to <!--l. 254--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     the message <!--l. 254--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>B</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>B</mi></mrow></msub 
><mo 
class="MathClass-punc">,</mo><msup><mrow 
><mi 
>S</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     (external end-point used by <!--l. 255--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     to talk with <!--l. 255--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>,
     port step measured for <!--l. 256--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     and a new temporaly listenning port <!--l. 257--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>S</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
></math>
     at node <!--l. 257--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>).
     The tuple <!--l. 258--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>B</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>B</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>
     allows <!--l. 258--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     to predict which external port (<!--l. 259--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>)
     will use <!--l. 260--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">NAT</mi><mi 
>B</mi></math>
                                                                  

                                                                  
     when <!--l. 260--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     sends a packet to <!--l. 260--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>.
     The extra socket bound by <!--l. 261--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     to <!--l. 261--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>S</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
></math>
     will be used to update the external port that <!--l. 262--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     is currently using to communicate with the rest of peers of the team.
     </li>
     <li class="itemize"><!--l. 264--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     receives the previous message.
     </li>
     <li class="itemize"><!--l. 265--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     says <!--l. 265--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     to EEP <!--l. 266--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi mathvariant="normal">NAT</mi><mi 
>B</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 267--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     says <!--l. 267--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mi 
>S</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     to EEP <!--l. 267--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>S</mi><mo 
class="MathClass-punc">,</mo><msup><mrow 
><mi 
>S</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 268--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">NAT</mi><mi 
>B</mi></math>
     relays the message <!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     towards <!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     and <!--l. 269--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mi 
>S</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     is received by <!--l. 270--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     (which updates the external port for <!--l. 271--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>).
     Notice that at this moment, <!--l. 271--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     knows that <!--l. 271--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     is able to send data to it.
     </li>
     <li class="itemize">Both, <!--l. 273--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     and <!--l. 273--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     acknowledges the <!--l. 273--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     messages.
     </li>
     <li class="itemize"><!--l. 275--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><mi 
>S</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     is received by <!--l. 275--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>,
     <!--l. 276--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     is received by <!--l. 276--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">NAT</mi><mi 
>A</mi></math>
     and the timer assigned to the message <!--l. 277--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     sent in Step 11 timeouts and this message is re-sent.
     </li>
     <li class="itemize"><!--l. 279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
                                                                  

                                                                  
     receives <!--l. 279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     and <!--l. 279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">NAT</mi><mi 
>A</mi></math>
     receives <!--l. 280--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 281--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     is delivered to <!--l. 281--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>.
     At this moment, <!--l. 282--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     knows that <!--l. 282--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     is able to send data to it.
     </li>
     <li class="itemize"><!--l. 283--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     acknowledges the previous <!--l. 283--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 284--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     arrives to <!--l. 284--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">NAT</mi><mi 
>B</mi></math>.
     </li>
     <li class="itemize"><!--l. 285--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     arrives to <!--l. 285--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>.
     </li>
     <li class="itemize"><!--l. 286--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     and <!--l. 286--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     annouce to the <!--l. 286--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     the source port used by the other peer.
     </li>
     <li class="itemize">This information is received by the <!--l. 288--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>,
     which updates the external port information for <!--l. 289--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     and <!--l. 289--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>.</li></ul>
<!--l. 292--><p class="indent" >   Summarizing, NTS can provide connectivity for those peers that are behind
port-preservation symmetric NATs with sequential port allocation.
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.6   </span> <a 
 id="x1-260008.6"></a>A port prediction algorithm (Max’s proposal)</h4>
<!--l. 297--><p class="noindent" >When both peers, Peer1 and Peer2, are behind symmetric NATs, both must predict
the port that the NAT of the interlocutor peer will use to send the packets towards
it. And obviously, this must be performed by each already incorporated peer that is
behind a symmetric NAT.
</p><!--l. 302--><p class="indent" >   The list of predicted ports <!--l. 302--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Z</mi></math>
that a a peer <!--l. 302--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>x</mi></mrow></msub 
></math>
performs is determined by: </p><table class="equation"><tr><td> <a 
 id="x1-26001r10"></a>
                                                                  

                                                                  
<!--l. 304--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
 <mtable  align="axis" style=""  
equalrows="false" columnlines="none none" equalcolumns="false" class="array"> <mtr><mtd 
class="array"  columnalign="right">  <mi 
>Z</mi> </mtd><mtd 
class="array"  columnalign="center">   <mo 
class="MathClass-rel">=</mo>   </mtd><mtd 
class="array"  columnalign="left"> <msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
> <mo 
class="MathClass-bin">+</mo> <mi 
>x</mi> <mo 
class="MathClass-bin">+</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>s</mi> <mo 
class="MathClass-rel">∈</mo><mrow ><mo 
class="MathClass-open">{</mo><mrow><mn>0</mn><mo 
class="MathClass-punc">,</mo><mn>1</mn><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><mi 
>N</mi><mo 
class="MathClass-bin">∕</mo><mn>2</mn> <mo 
class="MathClass-bin">−</mo> <mn>1</mn></mrow><mo 
class="MathClass-close">}</mo></mrow></mrow><mo 
class="MathClass-close">}</mo></mrow><mo 
class="MathClass-punc">;</mo>      </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="right">  <mi 
>Z</mi> </mtd><mtd 
class="array"  columnalign="center"> <mo 
class="MathClass-bin">+</mo> <mo 
class="MathClass-rel">=</mo> </mtd><mtd 
class="array"  columnalign="left"> <msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
> <mo 
class="MathClass-bin">+</mo> <mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>x</mi> <mo 
class="MathClass-bin">+</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>s</mi> <mo 
class="MathClass-rel">∈</mo><mrow ><mo 
class="MathClass-open">{</mo><mrow><mn>0</mn><mo 
class="MathClass-punc">,</mo><mn>1</mn><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><mi 
>N</mi> <mo 
class="MathClass-bin">−</mo> <mn>1</mn></mrow><mo 
class="MathClass-close">}</mo></mrow></mrow><mo 
class="MathClass-close">}</mo></mrow></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-bin">⋅</mo> <mi 
>Δ</mi><mo 
class="MathClass-punc">.</mo> </mtd></mtr><!--rcl--></mtable>
</math></td><td class="eq-no">(10)</td></tr></table>
<!--l. 310--><p class="indent" >   where “<!--l. 310--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin">+</mo> <mo 
class="MathClass-rel">=</mo></math>” denotes the
concatenation of lists and <!--l. 310--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math> is
the number of guessed ports, <!--l. 311--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is the ﬁrst external port (the port used to communicate with
<!--l. 312--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>) assigned to the
incoming peer and <!--l. 313--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Δ</mi></math>
is the (maximum) port step measured for the incoming peer’s NAT.
</p><!--l. 63--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">9   </span> <a 
 id="x1-270009"></a>MCS (Multi-Channel Set)</h3>
<!--l. 5--><p class="noindent" ><span 
class="ecbx-1000">Note:  </span>Unﬁnished.
</p><!--l. 9--><p class="noindent" >When using MDC <span class="cite">[<a 
href="#Xbaccichet2007content">1</a>]</span>, SVC <span class="cite">[<a 
href="#Xchu2009auction">2</a>]</span>, or for emulating the CS model, it can be interesting
for peers to belong to more than one team. To implement MCS, peers must replicate
the P2PSP modules (DBS at least) for each team (channel), except the
buﬀer.
</p><!--l. 15--><p class="indent" >   The use of MDC is trivial: the higher the number received descriptions (channels),
even partially, the higher the quality of the playback. However, when transmitting
SVC media, peers should prioritize the reception of the most important
layers.
</p><!--l. 20--><p class="indent" >   When a peer belongs to more than one team, and the teams broadcast exactly the
same stream (the same chunks and headers), it could move between teams seamless
(without losts of signal).
</p><!--l. 24--><p class="indent" >   A pure CS service could be provided if the corresponding splitter announces one
empty team and sends each chunk so many times as teams (with one peer/team)
there are.
</p><!--l. 66--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">10   </span> <a 
 id="x1-2800010"></a>CIS (Content Integrity Set)</h3>
<!--l. 5--><p class="noindent" ><span 
class="ecbx-1000">Note:  </span>Unﬁnished.
                                                                  

                                                                  
</p><!--l. 9--><p class="noindent" >A variety of techniques to ﬁght pollution in P2P live streaming systems are
available in the literature, including hash-based signature and data encryption
techniques.
</p><!--l. 1--><p class="indent" >   <a 
 id="likesection.1"></a><a 
 id="Q1-1-43"></a>
</p>
   <h3 class="likesectionHead"><a 
 id="x1-2900010"></a>Acronyms</h3>
<!--l. 2--><p class="noindent" >
     </p><dl class="description"><dt class="description">
<a 
 id="glo:ALM"></a><span 
class="ecbx-1000">ALM</span> </dt><dd 
class="description">Application Layer Multicast. 13
     </dd><dt class="description">
<a 
 id="glo:DBS"></a><span 
class="ecbx-1000">DBS</span> </dt><dd 
class="description">Data Broadcasting Set of rules. 13
     </dd><dt class="description">
<a 
 id="glo:URL"></a><span 
class="ecbx-1000">URL</span> </dt><dd 
class="description">Universal Resource Locator. 8</dd></dl>
<!--l. 1--><p class="noindent" ><a 
 id="likesection.2"></a><a 
 id="Q1-1-45"></a>
</p>
   <h3 class="likesectionHead"><a 
 id="x1-3000010"></a>Glossary</h3>
<!--l. 2--><p class="noindent" >
     </p><dl class="description"><dt class="description">
<a 
 id="glo:buffering-time"></a><span 
class="ecbx-1000">Buﬀering time</span> </dt><dd 
class="description">The time required receive at least two chunks separated by
     the buﬀer size. 18
     </dd><dt class="description">
<a 
 id="glo:chunk"></a><span 
class="ecbx-1000">Chunk</span> </dt><dd 
class="description"><a 
href="https://en.wikipedia.org/wiki/Chunk_(information)" >A piece of stream</a>. 13
     </dd><dt class="description">
<a 
 id="glo:chunk-time"></a><span 
class="ecbx-1000">Chunk time</span> </dt><dd 
class="description">The time required to play a chunk. 16
     </dd><dt class="description">
<a 
 id="glo:joining-time"></a><span 
class="ecbx-1000">Joining time</span> </dt><dd 
class="description">The time required by a peer to receive the list of peers of the
     team from the splitter. 16
     </dd><dt class="description">
<a 
 id="glo:media"></a><span 
class="ecbx-1000">Media</span> </dt><dd 
class="description"><a 
href="https://en.wikipedia.org/wiki/Multimedia" >Data expresing information usually interpreted by humans</a>. 13, 70
     </dd><dt class="description">
<a 
 id="glo:monitor"></a><span 
class="ecbx-1000">Monitor</span> </dt><dd 
class="description">A trusted and reliable peer of a team. 13
     </dd><dt class="description">
<a 
 id="glo:neighborhood-degree"></a><span 
class="ecbx-1000">Neigborhood degree</span> </dt><dd 
class="description">The number of neighbors (peers) to which a chunk is
     forwarded. 24, 37, 38, 44
                                                                  

                                                                  
     </dd><dt class="description">
<a 
 id="glo:origin"></a><span 
class="ecbx-1000">Origin</span> </dt><dd 
class="description">The ﬁrst peer in the path that each chunk follows between the splitter
     and the team. 15
     </dd><dt class="description">
<a 
 id="glo:player"></a><span 
class="ecbx-1000">Player</span> </dt><dd 
class="description"><a 
href="https://en.wikipedia.org/wiki/Media_player_software" >An application that is able to reproduce a media stream</a>. 13
     </dd><dt class="description">
<a 
 id="glo:round"></a><span 
class="ecbx-1000">Round</span> </dt><dd 
class="description">The process of sending a (usually diﬀerent) chunk from the splitter to
     all the peers of the team. 15
     </dd><dt class="description">
<a 
 id="glo:round-time"></a><span 
class="ecbx-1000">Round time</span> </dt><dd 
class="description">The time required to complete a round. 16, 41
     </dd><dt class="description">
<a 
 id="glo:server"></a><span 
class="ecbx-1000">Server</span> </dt><dd 
class="description"><a 
href="https://en.wikipedia.org/wiki/Server_(computing)" >A  process  running  on  the  Internet  that  is  able  to  send  data  upon
     requests</a>. 8, 13
     </dd><dt class="description">
<a 
 id="glo:splitter"></a><span 
class="ecbx-1000">Splitter</span> </dt><dd 
class="description">P2PSP  entity  responsible  for  splitting  the  <a 
href="#glo:media">media</a>  into  chunks  and
     sending the to the team. 13
     </dd><dt class="description">
<a 
 id="glo:start-up-time"></a><span 
class="ecbx-1000">Start-up time</span> </dt><dd 
class="description">The time required by a peer to start playing the stream. 18, 21
     </dd><dt class="description">
<a 
 id="glo:stream"></a><span 
class="ecbx-1000">Stream</span> </dt><dd 
class="description"><a 
href="https://en.wikipedia.org/wiki/Streaming_media" >A sequence of data that is consumed while it is received</a>. 8, 13
     </dd><dt class="description">
<a 
 id="glo:team"></a><span 
class="ecbx-1000">Team</span> </dt><dd 
class="description">The set of peers in an P2PSP overlay. 13
     </dd><dt class="description">
<a 
 id="glo:unicast"></a><span 
class="ecbx-1000">Unicast</span> </dt><dd 
class="description"><a 
href="https://en.wikipedia.org/wiki/Unicast" >A point-to-point communication</a>. 13</dd></dl>
<!--l. 1--><p class="noindent" >
</p>
   <h3 class="likesectionHead"><a 
 id="x1-3100010"></a>References</h3>
<!--l. 1--><p class="noindent" >
   </p><div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
 [1]<span class="bibsp">   </span></span><a 
 id="Xbaccichet2007content"></a>Pierpaolo  Baccichet,  Jeonghun  Noh,  Eric  Setton,  and  Bernd  Girod.
   Content-aware p2p video streaming with low latency.  In <span 
class="ecti-1000">Multimedia and</span>
   <span 
class="ecti-1000">Expo, 2007 IEEE International Conference on</span>, pages 400–403. IEEE, 2007.
                                                                  

                                                                  
   </p>
   <p class="bibitem" ><span class="biblabel">
 [2]<span class="bibsp">   </span></span><a 
 id="Xchu2009auction"></a>Xiaowen  Chu,  Kaiyong  Zhao,  Zongpeng  Li,  and  Anirban  Mahanti.
   Auction-based  on-demand  p2p  min-cost  media  streaming  with  network
   coding.      <span 
class="ecti-1000">IEEE  Transactions  on  Parallel  and  Distributed  Systems</span>,
   20(12):1816–1829, 2009.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [3]<span class="bibsp">   </span></span><a 
 id="XComer1"></a>Douglas E. Comer. <span 
class="ecti-1000">Internetworking with TCP/IP. Principles, Protocols,</span>
   <span 
class="ecti-1000">and Architectures (4th Edition)</span>, volume 1. Prentice Hall, 2000.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [4]<span class="bibsp">   </span></span><a 
 id="Xshabtay2011ip"></a>Lior  Shabtay  and  Benny  Rodrig.   Ip  multicast  in  vlan  environment,
   April 12 2011. US Patent 7,924,837.
</p>
   </div>
    
</body> 
</html>
                                                                  



<!DOCTYPE html> 
<html> 
<head> <title>P2PSP (Peer-to-Peer Straightforward Protocol)</title> 
<meta charset="UTF-8" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<link rel="stylesheet" type="text/css" href="index.css" /> 
<script type="text/javascript" 
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" 
></script> 
<style type="text/css"> 
.MathJax_MathML {text-indent: 0;} 
</style> 
</head><body 
>
   <div class="maketitle">
                                                                  

                                                                  
                                                                  

                                                                  

<h2 class="titleHead">P2PSP (Peer-to-Peer Straightforward Protocol)</h2>
 <div class="author" ><span 
class="ecrm-1200">The P2PSP team</span></div><br />
<div class="date" ><span 
class="ecrm-1200">August 23, 2018</span></div>
   </div>
   <div 
class="abstract" 
>
<div class="center" 
>
<!--l. 26--><p class="noindent" >
</p><!--l. 26--><p class="noindent" ><span 
class="ecbx-0900">Abstract</span></p></div>
     <!--l. 1--><p class="indent" >    <span 
class="ecrm-0900">P2PSP (</span><a 
href="https://p2psp.github.io" class="url" ><span 
class="ectt-0900">https://p2psp.github.io</span></a><span 
class="ecrm-0900">) is an application-layer protocol</span>
     <span 
class="ecrm-0900">that provides real-time broadcasting, also known as Application Layer</span>
     <span 
class="ecrm-0900">Multicast (ALM), of a media stream on the Internet. Peers collaborate</span>
     <span 
class="ecrm-0900">to diseminate the stream that is generated by a single source, minimizing</span>
     <span 
class="ecrm-0900">the latency and the protocol overhead. P2PSP overlays are push-based</span>
     <span 
class="ecrm-0900">(topology-driven) meshes. To minimize the transmission latency, P2PSP</span>
     <span 
class="ecrm-0900">establishes a communication between nearby peers, and chunks of data are</span>
     <span 
class="ecrm-0900">ﬂooded without explicit requests. P2PSP has a modular design organized</span>
     <span 
class="ecrm-0900">in </span><span 
class="ecti-0900">sets of rules</span><span 
class="ecrm-0900">,  where each module is especialized in implementing a</span>
     <span 
class="ecrm-0900">diﬀerent functionality (use of native IPM (IP Multicast), NAT traversal,</span>
     <span 
class="ecrm-0900">etc.).</span>
</p>
</div>
   <h3 class="likesectionHead"><a 
 id="x1-1000"></a>Contents</h3>
   <div class="tableofcontents">
   <span class="sectionToc" >1 <a 
href="#x1-20001" id="QQ2-1-2">STS (Splitters Tracking Set)</a></span>
<br />   <span class="sectionToc" >2 <a 
href="#x1-30002" id="QQ2-1-5">DBS (Data Broadcasting Set)</a></span>
<br />    <span class="subsectionToc" >2.1 <a 
href="#x1-40002.1" id="QQ2-1-7">Feeding the team</a></span>
<br />    <span class="subsectionToc" >2.2 <a 
href="#x1-50002.2" id="QQ2-1-8">Joining a team</a></span>
<br />    <span class="subsectionToc" >2.3 <a 
href="#x1-60002.3" id="QQ2-1-9">Chunk ﬂooding</a></span>
                                                                  

                                                                  
<br />    <span class="subsectionToc" >2.4 <a 
href="#x1-70002.4" id="QQ2-1-15">Buﬀering chunks</a></span>
<br />    <span class="subsectionToc" >2.5 <a 
href="#x1-80002.5" id="QQ2-1-16">Leaving a team</a></span>
<br />    <span class="subsectionToc" >2.6 <a 
href="#x1-90002.6" id="QQ2-1-17">Free-riding control</a></span>
<br />   <span class="sectionToc" >3 <a 
href="#x1-100003" id="QQ2-1-18">IMS (Ip Multicast Set)</a></span>
<br />   <span class="sectionToc" >4 <a 
href="#x1-110004" id="QQ2-1-19">FCS (Free-riding Control Set)</a></span>
<br />   <span class="sectionToc" >5 <a 
href="#x1-120005" id="QQ2-1-20">TAS (Topology Adaptation Set)</a></span>
<br />   <span class="sectionToc" >6 <a 
href="#x1-130006" id="QQ2-1-21">MRS (Massively-lost chunk Recovery Set)</a></span>
<br />   <span class="sectionToc" >7 <a 
href="#x1-140007" id="QQ2-1-22">ACS (Adaptive Capacity Set)</a></span>
<br />   <span class="sectionToc" >8 <a 
href="#x1-150008" id="QQ2-1-23">NTS (NAT Traversal Set)</a></span>
<br />    <span class="subsectionToc" >8.1 <a 
href="#x1-160008.1" id="QQ2-1-24">Traﬃc ﬁltering</a></span>
<br />    <span class="subsectionToc" >8.2 <a 
href="#x1-170008.2" id="QQ2-1-27">Cone VS symmetric</a></span>
<br />    <span class="subsectionToc" >8.3 <a 
href="#x1-180008.3" id="QQ2-1-28">Port allocation</a></span>
<br />    <span class="subsectionToc" >8.4 <a 
href="#x1-190008.4" id="QQ2-1-29">NAT type analysis</a></span>
<br />    <span class="subsectionToc" >8.5 <a 
href="#x1-200008.5" id="QQ2-1-30">(Theoretical) NAT traversal performance of DBS</a></span>
<br />    <span class="subsectionToc" >8.6 <a 
href="#x1-210008.6" id="QQ2-1-35">A port prediction algorithm (Max’s proposal)</a></span>
<br />   <span class="sectionToc" >9 <a 
href="#x1-220009" id="QQ2-1-36">MCS (Multi-Channel Set)</a></span>
   </div>
<!--l. 32--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-20001"></a>STS (Splitters Tracking Set)</h3>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-20011"></a>
                                                                  

                                                                  
<!--l. 9--><p class="noindent" > <div style="text-align:center;"> <img width=600 src="graphics/icecast-P2PSP.png" /> </div> 
<br />  </p><div class="caption" 
><span class="id">Figure 1:  </span><span  
class="content">A  possible  data-ﬂow  in  an  hybrid  Icecast/P2PSP  network.
<!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
represents                         a                         splitter                         and
<!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
a peer.</span></div><!--tex4ht:label?: x1-20011 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
<!--l. 15--><p class="indent" >   P2PSP supposes that there is a collection of channels that are broadcasted in
parallel.<span class="footnote-mark"><a 
href="index2.html#fn1x0"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-2002f1"></a>  The channels are
available at one or more<span class="footnote-mark"><a 
href="index3.html#fn2x0"><sup class="textsuperscript">2</sup></a></span><a 
 id="x1-2003f2"></a> 
streaming <span 
class="ecti-1000">servers</span>, and each channel has a diﬀerent URL (Universal Resource
Locator), usually expressed as a Web address with the structure:
                                                                  

                                                                  
</p>
   <div class="verbatim" id="verbatim-1">
  http://name.icecast.server/name_of_the_channel
</div>
<!--l. 27--><p class="nopar" >
</p><!--l. 30--><p class="indent" >   P2PSP does not perform data-ﬂow control over the stream. The transmission
bit-rate between P2PSP entities is controlled by an external server, which provides
the stream. Fig. <a 
href="#x1-20011">1<!--tex4ht:ref: fig:icecast-P2PSP --></a> shows an example of an hybrid Icecast/P2PSP streaming overlay
where several Icecast servers relay a set of channels produced by a set of
source-clients, directly or through other servers. As can be seen, a listener (which
usually plays de stream) can be replaced by a <span 
class="ecti-1000">splitter</span>, a P2PSP entity that sends the
received stream (a single channel) to a set of P2PSP <span 
class="ecti-1000">peers</span>, called <span 
class="ecti-1000">team</span>.
Notice that, considering that a player can be attached to each peer, the
scalability of the hybrid alternative is much higher than the pure client/server
architecture.
</p><!--l. 52--><p class="indent" >   Usually, users are mainly interested in receiving channels, not in knowing the
topology of the overlay. In a pure Icecast system, users request the channels directly
to the servers. Unfortunately, this simple procedure has a drawback: normally, users
does not know the load of the servers nor their distance to the user’s player.
This problem can be solved using a <span 
class="ecti-1000">load balancer</span>. The listeners (and the
splitters) which know the URL of the required channel, connects ﬁrst to the
load balancer which redirects them (with a HTTP 302 code) to a suitable
server.
</p><!--l. 63--><p class="indent" >   This idea can be extended to take advantage of the existence of P2PSP teams in hybrid
overlays, where some users run a local peer to retrieve a copy of the stream. In this case, the peer
communicates<span class="footnote-mark"><a 
href="index4.html#fn3x0"><sup class="textsuperscript">3</sup></a></span><a 
 id="x1-2004f3"></a> 
with the load balancer to tell it that there is a peer running in the same
host that the player. Thus, when the player requests to the load balancer
the reception of the stream, the load balancer redirects it towards the local
peer.<span class="footnote-mark"><a 
href="index5.html#fn4x0"><sup class="textsuperscript">4</sup></a></span><a 
 id="x1-2005f4"></a> 
</p><!--l. 84--><p class="indent" >   When a network entity (usually, a player) connects with a peer, this must
connects with a splitter which is transmitting the stream selected by the user.
Depending on maximum number of potential peers that are retrieving the same
channel, more than one splitter could be available. This information is served by a
                                                                  

                                                                  
<span 
class="ecti-1000">splitters tracker</span>, and generated when a new splitter is instantiated. The
tracker keeps updated a table indexed by names of channels, where every
entry contains a list of splitters that transmit the corresponding channel.
Therefore, to ﬁnd a suitable splitter, the peer ﬁrst retrieves from the splitters
tracker a list of splitters. Then, the peer tries to connect with all the
splitters<span class="footnote-mark"><a 
href="index6.html#fn5x0"><sup class="textsuperscript">5</sup></a></span><a 
 id="x1-2006f5"></a> 
in parallel, and the fastest connection determines the selected splitter (the rest of
successful connections are closed). This procedure should select the “closest” splitter
to the peer in terms of network latency.
</p><!--l. 109--><p class="indent" >   The splitters send to the tracker a message with the current number
<!--l. 110--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>t</mi></math> of
peers in their teams. When a splitters (and its team) is created, it sends a message
<!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math> with
<!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>t</mi> <mo 
class="MathClass-rel">≥</mo> <msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
><mo 
class="MathClass-bin">−</mo> <mn>1</mn></math> where
<!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math> is the maximum
team size<span class="footnote-mark"><a 
href="index7.html#fn6x0"><sup class="textsuperscript">6</sup></a></span><a 
 id="x1-2007f6"></a> 
for that splitter (at least one monitor peer must be in each
team). When the team is full, the splitter sends a message with
<!--l. 115--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>t</mi> <mo 
class="MathClass-rel">=</mo> <mn>0</mn></math>.
When the team is shutted down, the splitter sends a
<!--l. 116--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>t</mi> <mo 
class="MathClass-rel">=</mo> <mo 
class="MathClass-bin">−</mo><mn>1</mn></math>.
Using the number of free spaces in each team, the splitters tracker can perform some
load balacing among the teams, by including only those teams with more room in the
<!--l. 118--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mstyle 
class="text"><mtext  >list of splitters</mtext></mstyle></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
response.
                                                                  

                                                                  
</p><!--l. 122--><p class="indent" >   <a 
 id="x1-20082"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img width=900 src="graphics/STS_example.png" /> </div> 
<br /> <div class="caption" 
><span class="id">Figure 2: </span><span  
class="content">Timeline example of an STS interaction.</span></div><!--tex4ht:label?: x1-20082 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
<!--l. 128--><p class="indent" >   The Fig. <a 
href="#x1-20082">2<!--tex4ht:ref: fig:STS_example --></a> shown an example of an STS communication. When the peer is created, it
sends a <!--l. 129--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
message to the load balancer telling that a player is running in the same
host that the peer and therefore, the peers should be redirected towards
it. When the splitters are instantiated, they send their teams sizes
(<!--l. 133--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn></math>,
supposing that only one monitor has added to each team). The player is redirected to
the peer which, after receiving the list of splitters from the tracker, selects the
Splitter<!--l. 135--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><mn>1</mn></mrow></msub 
></math> because answers
ﬁrst than the Splitter<!--l. 136--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>.
</p>
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-30002"></a>DBS (Data Broadcasting Set)</h3>
   <div class="table">
                                                                  

                                                                  
<!--l. 9--><p class="indent" >   <a 
 id="x1-30011"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div class="tabular"> <table id="TBL-2" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1" /><col 
id="TBL-2-2" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-1-1"  
class="td11">                                                          Parameter  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-1-2"  
class="td11"> Meaning                                                       </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-2-1"  
class="td11"> <!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-2-2"  
class="td11"> Buﬀer size in chunks                                       </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-3-1"  
class="td11"> <!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>C</mi></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-3-2"  
class="td11"> Chunk size</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-4-1"  
class="td11"> <!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>L</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-4-2"  
class="td11"> Maximum losses of chunk allowed by the splitter  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-5-1"  
class="td11"> <!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-5-2"  
class="td11"> Number of monitors                                       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-6-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-6-1"  
class="td11"> <!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>N</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-6-2"  
class="td11"> Maximum number of peers in a team                 </td></tr></table>
</div>
<br /> <div class="caption" 
><span class="id">Table 1: </span><span  
class="content">Nomenclature used in DBS.</span></div><!--tex4ht:label?: x1-30011 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
   </div>
<!--l. 22--><p class="indent" >   DBS provides ALM <span class="cite">[<a 
href="#Xbanerjee2002scalable">2</a>]</span> of a media stream in unicast environments <span class="cite">[<a 
href="#Xcomer2003computer">5</a>]</span>.
The media is sent by a streaming server, and received by a
splitter</p><!--l. 26--><p class="indent" >      <span 
class="ecbx-1000">(see Sec.</span><span 
class="ecbx-1000"> </span><a 
href="#x1-20001"><span 
class="ecbx-1000">1</span><!--tex4ht:ref: sec:STS --></a><span 
class="ecbx-1000">)</span>                                                                      . The
splitter divides the stream into a sequence of <span 
class="ecti-1000">chunks</span>, and relay them to its team, where it can
be up to <!--l. 28--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math>
peers. Each peer gathers the chunks from the splitter and the rest of peers of the
team, and sends them to a player. The Tab. <a 
href="#x1-30011">1<!--tex4ht:ref: tab:DBS_nomenclature --></a> gathers up the deﬁnitions used in the
DBS.
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.1   </span> <a 
 id="x1-40002.1"></a>Feeding the team</h4>
<!--l. 8--><p class="noindent" >The splitter divides the stream into chunks of constant length
<!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>C</mi></math>,
and sends exclusively each chunk to a diﬀerent <span 
class="ecti-1000">origin</span>
<span 
class="ecti-1000">peer</span><span class="footnote-mark"><a 
href="index8.html#fn7x0"><sup class="textsuperscript">7</sup></a></span><a 
 id="x1-4001f7"></a> ,
using a round-robin schema. The teams are created with a least one monitor
peer<span class="footnote-mark"><a 
href="index9.html#fn8x0"><sup class="textsuperscript">8</sup></a></span><a 
 id="x1-4002f8"></a> 
that runs, by default, in the same host that the splitter, and listens to the port 9999.
Chunks are enumerated to distinguish them at the peers.
</p><!--l. 37--><p class="indent" >   We deﬁne a <span 
class="ecti-1000">round </span>as the process of sending a (diﬀerent) chunk from the splitter
to all the peers of the team. In other words, in a round, all peers of the team should
have received a diﬀerent chunk from the splitter. Notice that the round-time is
variable, and depends on the current number of peers in the team, the chunk-size,
and the average bit-rate of the media.
</p><!--l. 44--><p class="indent" >   The splitter remembers which chunk, of a list of the last
<!--l. 44--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>
chunks transmitted to the team, was sent to each peer.
</p><!--l. 48--><p class="indent" >   See <a 
href="https://github.com/P2PSP/simulator/blob/f0c73be1817e7d3b816cc61cd2c8e59b17f9a0e6/src/core/splitter_dbs.py#L296" ><!--l. 48--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >destination_of_chunk</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math></a>.
</p>
                                                                  

                                                                  
   <h4 class="subsectionHead"><span class="titlemark">2.2   </span> <a 
 id="x1-50002.2"></a>Joining a team</h4>
<!--l. 8--><p class="noindent" >After connecting with a splitter, incoming peers request (using a reliable communication) to
the splitter the current list of peers in the team. To minimize the joining time, the peer sends
a <!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math> message
to each peer of the team, in parallel with the reception of the list. When a peer of the team
receives a <!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>,
it adds the sender of the message to a table of peers called
<!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >forward</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>. If a peer
<!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> has an entry
<!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >forward</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">=</mo> <msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math> then, each chunk
received by <!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> and
originated at <!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>j</mi></mrow></msub 
></math> will
be forwarded to <!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math>.
</p><!--l. 24--><p class="indent" >   The splitter, in a loop: (1) listens to the incoming peers, (2) sends the list of peers
in the team, and (3) adds the incoming peer to the list.
</p><!--l. 9--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.3   </span> <a 
 id="x1-60002.3"></a>Chunk ﬂooding</h4>
<!--l. 16--><p class="noindent" >DBS is a content-unaware push-based protocol, where when a peer received a chunk,
it can be retransmitted to a large number of neighbors. To avoid network
congestion while ﬂooding, sending peers must perform some kind of data
ﬂow-control.
</p><!--l. 24--><p class="indent" >   Congestion control is performed by means of the basic idea of, <span 
class="ecsl-1000">if I have received a</span>
<span 
class="ecsl-1000">chunk, I should send a chunk</span>. It is easy to see that, in a fully connected
overlay, this allows to control the data ﬂow. However, peers can be “connected”
with a variable number of neighbors and therefore, if the splitter follows
a pure round-robin strategy, some peers can send more chunks that they
receive.
</p><!--l. 31--><p class="indent" >   The previous idea can be improved to handle a variable
connectivity degree. Each peer use an array of FIFO queues,
<!--l. 32--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >pending</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>, indexed
by the neighbor end-points, where each queue stores buﬀer positions. Thus, if for example
<!--l. 34--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >pending</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>x</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><mn>1</mn><mn>1</mn><mo 
class="MathClass-punc">,</mo><mn>2</mn><mn>2</mn></mrow><mo 
class="MathClass-close">}</mo></mrow></math>, chunks found
at positions <!--l. 35--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn><mn>1</mn></math> and
<!--l. 35--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>2</mn><mn>2</mn></math> of the buﬀer have
to be sent to peer <!--l. 36--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>x</mi></mrow></msub 
></math>
when a round-robin scheduler used by the peer select
<!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>x</mi></mrow></msub 
></math>. The
scheduler selects a diﬀerent neighbor, using a round-robin scheme, for each new
received chunk.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-60013"></a>
                                                                  

                                                                  
<!--l. 41--><p class="noindent" > <div style="text-align:center;"> <img width=250 src="graphics/team_0.png" /> </div> 
<br />  </p><div class="caption" 
><span class="id">Figure 3:    </span><span  
class="content">A    team    has    been    created    with    a    single    monitor
<!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
(<!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
messages   are   not   shown).   Chunks   with   numbers   0   and   1   (the   time
<!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>t</mi></math>
is   measured   in   chunks-time)   have   been   transmitted   from   the   splitter
<!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
to <!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>.
<!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>F</mi></math>
and <!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>P</mi></math>
represents the <!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >forward</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
and the <!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >pending</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
structures, respectively. The chunks stored in the buﬀer is shown under the
entity.</span></div><!--tex4ht:label?: x1-60013 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-60024"></a>
                                                                  

                                                                  
<!--l. 51--><p class="noindent" > <div style="text-align:center;"> <img width=250 src="graphics/team_1.png" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 4: </span><span  
class="content">Peer <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
joins the team (the <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>’s
are not shown). In <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>,
<!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>F</mi> <mo 
class="MathClass-rel">=</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
> <mo 
class="MathClass-punc">:</mo> <mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></mrow><mo 
class="MathClass-close">}</mo></mrow></math>
because when <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
receives the <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
from <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>,
<!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is      the      origin      peer      for      all      chunks      received      from
<!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
and <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
is   its   neighbor.   After   that,   when   the   chunk   number   2   arrives   to
<!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
from <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>,
an entry <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
> <mo 
class="MathClass-punc">:</mo> <mn>2</mn></math>
is created in <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>P</mi><mrow ><mo 
class="MathClass-open">{</mo><mrow></mrow><mo 
class="MathClass-close">}</mo></mrow></math>
for  that  chunk,  and  this  entry  is  deleted  when  the  chunk  2  is  sent  to
<!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>.
When <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
receives the chunk 2, <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
inserts the entry <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
> <mo 
class="MathClass-punc">:</mo> <msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
in its forwarding table because <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
considers to <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
as a neighbor. Notice that <!--l. 62--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
does not receive chunks 0 and 1 because these chunks belong to a old (already
played) section of the stream.</span></div><!--tex4ht:label?: x1-60024 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-60035"></a>
                                                                  

                                                                  
<!--l. 66--><p class="noindent" > <div style="text-align:center;"> <img width=300 src="graphics/team_2.png" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 5: </span><span  
class="content"><!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
joins the team (sending the <!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
not shown). <!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
and <!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
includes <!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
in     their     forwarding     tables.     The     chunk     3     is     received     by
<!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
which decides to send it to <!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>,
which adds <!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
to  its  forwarding  table.  Chunk  3  remains  as  pending  to  be  sent  to
<!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
when the next chunk is received by <!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>.</span></div><!--tex4ht:label?: x1-60035 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-60046"></a>
                                                                  

                                                                  
<!--l. 75--><p class="noindent" > <div style="text-align:center;"> <img width=330 src="graphics/team_3.png" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 6: </span><span  
class="content">Chunk 4 is received by <!--l. 77--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
which relays it to <!--l. 77--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>,
what relays chunk 3 to <!--l. 77--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>.</span></div><!--tex4ht:label?: x1-60046 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-60057"></a>
                                                                  

                                                                  
<!--l. 81--><p class="noindent" > <div style="text-align:center;"> <img width=330 src="graphics/team_4.png" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 7: </span><span  
class="content">Chunk 5 is received by <!--l. 84--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
which relays it to <!--l. 84--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>.
<!--l. 84--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
adds <!--l. 84--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>M</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
to its forwarding table. At this moment, all nodes knows the rest of the team.</span></div><!--tex4ht:label?: x1-60057 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
                                                                  

                                                                  
<!--l. 89--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img width=350 src="graphics/team_5.png" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 93--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img width=380 src="graphics/team_6.png" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 97--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img width=320 src="graphics/team_7.png" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 101--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img width=200 src="graphics/team_8.png" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 105--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img width=280 src="graphics/team_9.png" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 109--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img width=350 src="graphics/team_10.png" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 113--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img width=210 src="graphics/team_11.png" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 117--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img width=210 src="graphics/team_12.png" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
                                                                  

                                                                  
<!--l. 121--><p class="indent" >   </p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img width=210 src="graphics/team_13.png" /> </div> 
                                                                  

                                                                  
   </div><hr class="endfloat" />
<!--l. 126--><p class="indent" >   An example of the ﬂooding with congestion control algorithm has been
show in the Figs. <a 
href="#x1-60013">3<!--tex4ht:ref: fig:team_0 --></a>, ... Notice that in this example all messages are received
successfully.
</p><!--l. 130--><p class="indent" >   As can be seen in the previous example, when a peer
<!--l. 130--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math> receives
a chunk, <!--l. 131--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math>
ﬂoods a set of chunks to one of its its neighbors (obviously, except the neighbor
sender of the chunk), using round-robin schema. The size of this set, what we call
<!--l. 134--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >pending</mtext></mstyle></math>,
depends on how many neighbors a peer has.
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.4   </span> <a 
 id="x1-70002.4"></a>Buﬀering chunks</h4>
<!--l. 8--><p class="noindent" >In order to hide the jitter generated by the physical network and the
protocol itself, peers need to store the received chunks in a buﬀer
during a period of time before playing them. A chunk with number
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math> is inserted in the
position <!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>x</mi><mi mathvariant="italic">mod</mi><mn>2</mn><mi 
>B</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></math> of the
buﬀer, where <!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>
is the maximum number of chunks that the buﬀer will store. In a peer’s life,
<!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math> is constant, but diﬀerent
peers can use distinct <!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>
values.
</p><!--l. 15--><p class="indent" >   The buﬀer is implemented as a circular queue of
<!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>2</mn><mi 
>B</mi></math> chunks, which is
ﬁlled up to only <!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>
chunks in the buﬀering time. Chunks with a higher number (newer chunks) are
inserted in the head of the buﬀer. The chunk pointed by the tail of the buﬀer is sent
to the player (if there is a chunk in that cell of the buﬀer). This action is carried out
each time a new chunk is received.
</p><!--l. 22--><p class="indent" >   Chunks can be lost.<span class="footnote-mark"><a 
href="index10.html#fn9x0"><sup class="textsuperscript">9</sup></a></span><a 
 id="x1-7001f9"></a> 
A chunk is considered as lost when it is time to send it to the player and the chunk
has not been received. In this situation, for each lost chunk, the peer sends a
<!--l. 26--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">request</mi><mstyle 
class="text"><mtext  >lost_chunk_number</mtext></mstyle></mrow><mo 
class="MathClass-close">]</mo></mrow></math> (that
is the number of the next chunk to be played) to the origin peer of the next chunk
stored in the buﬀer. This peer has to characteristics: (1) it is not necessary a
neighbor peer, and (2) there is a high probability that this chunk has been stored in
the buﬀer “for a long time”, so, if it is not a neighbor, the link between it and the
peer is working fairly well.
</p><!--l. 35--><p class="indent" >   In the current implementation, the destination of the
                                                                  

                                                                  
<!--l. 36--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">request</mi><mo 
class="MathClass-punc">.</mo><mo 
class="MathClass-punc">.</mo><mo 
class="MathClass-punc">.</mo></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
message is the neighbor with the smaller chunk debt. This, a priori, has
the drawback that this peer will always selected for relaying all the lost
chunks because i will have a smaller debt as a consequence of the requests.
</p><!--l. 42--><p class="indent" >   In this situation, it is also possible that some peers can request redundant
paths between an origin peer and itself, and therefore, some chunks could
be received more than once. If this case, for each duplicate chunk, a peer
<!--l. 45--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> should send
a <!--l. 45--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">prune</mi><mstyle 
class="text"><mtext  >duplicate_chunk_number</mtext></mstyle></mrow><mo 
class="MathClass-close">]</mo></mrow></math> message to
those neighbors that have sent to it the duplicate chunk. Neighbors receiving such message from
peer <!--l. 48--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> should
remove the <!--l. 48--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
from <!--l. 48--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >forward</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>,
where <!--l. 49--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math>
is the origin peer of the duplicate chunk.
</p><!--l. 58--><p class="indent" >   The buﬀering time determines how much time the peers must wait before start
playing the chunks. Considering that chunks can be lost in transit or delayed more
than <!--l. 60--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>
times of chunk, randomly, it is diﬃcult to determine, a priori the optimal
buﬀering time. In the current implementation, peers buﬀer a variable number
of chunks that depends on the order in which chunks are received. If
<!--l. 63--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math> is the (number
of the) ﬁrst chunk received (the ﬁrst chunk to be played), the buﬀering time ﬁnishes when
the chunk <!--l. 65--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>x</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
> <mo 
class="MathClass-bin">+</mo> <mi 
>B</mi></math> is
received.<span class="footnote-mark"><a 
href="index11.html#fn10x0"><sup class="textsuperscript">10</sup></a></span><a 
 id="x1-7002f10"></a> 
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.5   </span> <a 
 id="x1-80002.5"></a>Leaving a team</h4>
<!--l. 8--><p class="noindent" >An outgoing peer must to: (1) say <!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">goodbye</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
to the splitter and the neighbor peers (in this order), (2) relay
any pending (received but yet not sent) chunks, and (3) wait for a
<!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">goodbye</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math> from
the splitter. In case of timeout, the leaving procedure is reset a number of
times.
</p><!--l. 14--><p class="indent" >   When a peer of the team receives a
<!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">goodbye</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>, removes the
                                                                  

                                                                  
sender from the <!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >forward</mtext></mstyle></math>.
</p><!--l. 17--><p class="indent" >   The splitter removes the peer from the list of peers.
</p><!--l. 19--><p class="indent" >   Outgoing peers does not wait for a any reply from the neighbors to go.
</p><!--l. 18--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.6   </span> <a 
 id="x1-90002.6"></a>Free-riding control</h4>
<!--l. 8--><p class="noindent" >In each team there are a set of <span 
class="ecti-1000">monitors </span>(trusted peers whose behavior is predictable
and that are only known by the splitter), which complain to their splitter with a
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">lost</mi><mstyle 
class="text"><mtext  >lost_chunk_number</mtext></mstyle></mrow><mo 
class="MathClass-close">]</mo></mrow></math> for
each lost chunk. The splitter only considers these type of messages if they come from
a monitor.
</p><!--l. 14--><p class="indent" >   If a peer <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math>
accumulates more than <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>L</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math>
losts in <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi></math>
rounds, <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math>
is removed from the splitter’s list of peers. Notice that
<!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>L</mi></math> will tend to be proportional
to the number <!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math> of monitors,
especially if those cases where <!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math>
is a gone peer that was unable to transmit the
<!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">goodbye</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
messages.
</p><!--l. 21--><p class="indent" >   This last functionality has not been implemented, at least, as it has been
explained here. The forget() thread is controlled by a timer, not by a counter of
rounds.
</p><!--l. 26--><p class="indent" >   Peers also control that at least one chunk is received from a neighbor in each
round.<span class="footnote-mark"><a 
href="index12.html#fn11x0"><sup class="textsuperscript">11</sup></a></span><a 
 id="x1-9001f11"></a>  If happens that
a peer <!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>x</mi></mrow></msub 
></math> does not receives
a chunk from peer <!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>y</mi></mrow></msub 
></math>
between <!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>D</mi></mrow><mrow 
><mo 
class="MathClass-bin">∗</mo></mrow></msup 
></math>
consecutive rounds, <!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>x</mi></mrow></msub 
></math>
removes <!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>y</mi></mrow></msub 
></math>
of its forwaring table.
</p>
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-100003"></a>IMS (Ip Multicast Set)</h3>
<!--l. 8--><p class="noindent" >IPM is available by default in LANs (Local Are Network)s and VLANs (Virtual
                                                                  

                                                                  
LANs) <span class="cite">[<a 
href="#Xshabtay2011ip">6</a>]</span>, but not in the Internet <span class="cite">[<a 
href="#XComer1">4</a>]</span>. IMS runs on the top of DBS and provides
eﬃcient native IPM, where available.
</p><!--l. 13--><p class="indent" >   The idea of IMS is simple: all peers in the same LAN or
VLAN have the same network address. When a joining peer
<!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> receives
the list of peers from its splitter, ﬁrst checks if there are neighbors in the same subnet
(all of them share the same private network address). For all those peers,
<!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> uses the IP address
<!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">224.0.0.1</mi></math> (all systems on this
subnet), (default) port <!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">1234</mi></math>,
to multicast (only) the chunks received from the splitter. When implementing IMS,
all peers in the same local network communicate using this IPM group address and
port. The splitter do a similar check: for all those peers that are in the same local
network that then splitter, the splitter sends the chunk to the multicast channel
<!--l. 24--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">224.0.0.1</mi></math>:<!--l. 24--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">1234</mi></math>.
</p><!--l. 41--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-110004"></a>FCS (Free-riding Control Set)</h3>
<!--l. 6--><p class="noindent" >DBS does not imposes any control over the grade of solidarity of the peers. This
means that selﬁsh peers (or simply peers with reduced connectivity as a
consecuence, for example, of NAT issues) can stay in the team thanks to the
generosity of the rest of peers. If this is unnaceptable, this set of rules try to that
all the peers of the team to share the same number of chunks that they
receive.
</p><!--l. 13--><p class="indent" >   To know the level of solidarity between neighbor peers, each peer implements a table of chunk
debts, <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >debt</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>. Every
time <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math> sends a
chunk to <!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>l</mi></mrow></msub 
></math>,
<!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math> runs
<!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >debt</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>l</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mstyle 
class="text"><mtext  >debt</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>l</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-bin">+</mo> <mn>1</mn></math>, and
<!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>l</mi></mrow></msub 
></math> runs
<!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >debt</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mstyle 
class="text"><mtext  >debt</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow><mo 
class="MathClass-bin">∕</mo><mn>2</mn></math>. So,
peers increment the insolidarity measurement incrementally and decreases it
exponentially towards zero. This respond to the idea of that, if a peer keeps sending
chunks to their neighbors, it has doing its best in retransmitting the chunks it must
forward.
</p><!--l. 23--><p class="indent" >   With the <!--l. 23--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >debt</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
information, peers modify the way the neighbor are selected during the ﬂooding procedure.
Now, the <!--l. 25--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >pending</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
list is sorted by debts (those peers with a lower debt will appear in the ﬁrst positions
of <!--l. 26--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >pending</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>),
and when a peer receives a chunk from the splitter, the run over the
<!--l. 28--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >pending</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math> list
                                                                  

                                                                  
will be reset. In this way, supportive peers will be served ﬁrst, incrementing
the QoE of the corresponding users. On the other hand, those peers with
a higher chunk debt will tend to be unserved if no enough bandwidth is
available.
</p><!--l. 33--><p class="indent" >   The second mechanism to increase the grade of solidarity is to send the
<!--l. 34--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">request</mi><mstyle 
class="text"><mtext  >lost_chunk_number</mtext></mstyle></mrow><mo 
class="MathClass-close">]</mo></mrow></math> to
those peers with a higher debt. So, if the insolidarity is produced by a overlay
topology imbalance, badly connected peers peers can mitigate this problem
forwarding more chunks to their neighbors.
</p><!--l. 68--><p class="indent" >   The prioritized round-robin neighbor selection has not yet been implemented as it has been
explained here. The <!--l. 69--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mstyle 
class="text"><mtext  >debt</mtext></mstyle><mrow ><mo 
class="MathClass-open">[</mo><mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
structure exists, but is used for a diﬀerent purporse.
</p><!--l. 44--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5   </span> <a 
 id="x1-120005"></a>TAS (Topology Adaptation Set)</h3>
<!--l. 8--><p class="noindent" >In TAS, the splitter request to each peer of the team the list of neighbors
(peers that send chunks directly, in one hop). This communication is reliable
(TCP) and transmits the lists as a collection of end-points. The number of
requests per round is limited by the available bandwidth in the overlay, and by
the request-ratio deﬁned at the splitter. Obviously, the higher the ratio, a
more accurate description of the real connectivity in the overlay will be
obtained.
</p><!--l. 26--><p class="indent" >   After knowing the connectivity degree of each peer, the slitter can adapt the
round-robin scheduling of the origin peers by sending a number of chunks
proportional to the inverse of the degree of the origin peer.
</p><!--l. 47--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">6   </span> <a 
 id="x1-130006"></a>MRS (Massively-lost chunk Recovery Set)</h3>
<!--l. 8--><p class="noindent" >MRS extends DBS (or an extension of it) to retransmit massively-lost chunks. MRS
should be implemented if error-prone communications are expected, specially if these
channels are used by the splitter. MRS is based on the use of monitors (see Sec: <a 
href="#x1-90002.6">2.6<!--tex4ht:ref: sec:free_riding_control --></a>).
The idea is: the splitter will resend lost chunks to one or more the monitors when all
monitors report their loss. To increase the probability of receiving on time the resent
chunk (by normal peers), monitors halves the number of chunks in their buﬀers in
relation to common peers. Notice that MRS only modiﬁes the behavior of the
splitters and the monitors (normal peers does no need to implement LRS or its
extensions).
                                                                  

                                                                  
</p><!--l. 50--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">7   </span> <a 
 id="x1-140007"></a>ACS (Adaptive Capacity Set)</h3>
<!--l. 8--><p class="noindent" >ACS relaxes the peer’s upload requirements imposed by DBS. It should be
used in if it is known that some peers can provide the capacity than others
cannot, or when we want to mix the CS and P2P models, sending more
chunks from the splitter to one or more monitors controlled by the contents
provider.
</p><!--l. 14--><p class="indent" >   ACS is based on the idea of using the information that the splitter knows about
the number of chunks that each peer has lost (see Sec <a 
href="#x1-90002.6">2.6<!--tex4ht:ref: sec:free_riding_control --></a>), to send to those more
reliable peers a higher number of chunks than to the others. In other words, ACS
adapts the round-time of each peer to its capacity.
</p><!--l. 20--><p class="indent" >   Notice that ACS only aﬀects the behavior of the splitter.
</p><!--l. 53--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">8   </span> <a 
 id="x1-150008"></a>NTS (NAT Traversal Set)</h3>
<!--l. 8--><p class="noindent" >Most of the peers run inside of “private” networks, i.e. behind NAT devices.
NTS<span class="footnote-mark"><a 
href="index13.html#fn12x0"><sup class="textsuperscript">12</sup></a></span><a 
 id="x1-15001f12"></a> 
is an DBS extension which provides peer connectivity for some
NAT conﬁgurations where DBS can not provide direct peer
communication.<span class="footnote-mark"><a 
href="index14.html#fn13x0"><sup class="textsuperscript">13</sup></a></span><a 
 id="x1-15002f13"></a> 
</p><!--l. 22--><p class="indent" >   Peers behind the same NAT will use the same external (also called “public”,
because in most cases we have not nested NAT conﬁgurations) IP address of the
NAT. Basically, there exist two diﬀerent types of NATs: (1) <span 
class="ecti-1000">cone</span>, and (2) <span 
class="ecti-1000">symmetric</span>.
At the same time, NATs can implement diﬀerent ﬁltering strategies for the packets
that comes from the external side: (a) <span 
class="ecti-1000">no ﬁltering</span>, (b) <span 
class="ecti-1000">source IP ﬁltering</span>, and
(c) <span 
class="ecti-1000">source end-point ﬁltering</span>. Finally, NATs can use several port allocation
algorithms, among which, the most frequent are: (i) <span 
class="ecti-1000">port preservation </span>and (ii)
<span 
class="ecti-1000">random port</span>. Notice that in this discussion, only UDP transmissions will be
considered.
</p>
                                                                  

                                                                  
   <h4 class="subsectionHead"><span class="titlemark">8.1   </span> <a 
 id="x1-160008.1"></a>Traﬃc ﬁltering</h4>
<!--l. 35--><p class="noindent" >Lets suppose a team in which, for the sake of simplicity, there is only one external (public) peer
<!--l. 36--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>e</mi></mrow></msub 
></math>, and that a new internal
(private) peer <!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> has sent
the sequence of [<!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>]’s (see
Sec <a 
href="#x1-50002.2">2.2<!--tex4ht:ref: sec:joining --></a>). Lets denote <!--l. 38--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>’s
NAT as <!--l. 38--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>. When no
ﬁltering is used at all, <!--l. 39--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
forwards to <!--l. 39--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
any external packet that arrives to it (obviously, if it was sent to the entry in
<!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>’s
translation table that was created during the transmission of the sequence of
[<!--l. 42--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>]’s),
independently on the source end-points of the packets. In the case of source (IP) address
ﬁltering, <!--l. 44--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
will forward the packets only if they come from
<!--l. 45--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>e</mi></mrow></msub 
></math>’s host. When source
end-point ﬁltering is used, <!--l. 45--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
also checks the source port, i.e., that the packets were originated at
<!--l. 47--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>e</mi></mrow></msub 
></math>’s
end-point.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-160018"></a>
                                                                  

                                                                  
<!--l. 50--><p class="noindent" > <div style="text-align:center;"> <img width=500 src="graphics/cone_NAT.png" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 8: </span><span  
class="content">Cone NAT port allocation.</span></div><!--tex4ht:label?: x1-160018 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-160029"></a>
                                                                  

                                                                  
<!--l. 55--><p class="noindent" > <div style="text-align:center;"> <img width=500 src="graphics/symmetric_NAT.png" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 9: </span><span  
class="content">Symmetric NAT port allocation.</span></div><!--tex4ht:label?: x1-160029 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">8.2   </span> <a 
 id="x1-170008.2"></a>Cone VS symmetric</h4>
<!--l. 60--><p class="noindent" >Cone NATs use the same external end-point for every packet that comes from the same
internal end-point, independently on the destination of the packets (see Fig. <a 
href="#x1-160029">9<!--tex4ht:ref: fig:cone_NAT --></a>). For the
external peer <!--l. 63--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>e</mi></mrow></msub 
></math>,
the situation is identical to the case in which the NATed peer
<!--l. 64--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> would
be running in a public host.
</p><!--l. 66--><p class="indent" >   Symmetric NATs use diﬀerent external end-points for diﬀerent packets that comes from
the same internal end-point, when these packets have diﬀerent destination end-points
(see Fig. <span 
class="ecbx-1000">??</span>). Thus, two diﬀerent external peers will see two diﬀerent public end-points
of <!--l. 70--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>e</mi></mrow></msub 
></math>.
</p><!--l. 72--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.3   </span> <a 
 id="x1-180008.3"></a>Port allocation</h4>
<!--l. 73--><p class="noindent" >In  the  case  of  port  preservation,  if
<!--l. 73--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>X</mi></math>:<!--l. 73--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math>
is the private end-point (IP address:port) of a UDP packet, the NAT will use the public port
<!--l. 75--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math>, if available
(notice that <!--l. 75--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math>
cound have been assigned to a previous communcation). If
<!--l. 76--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math> were
unavailable, the NAT usually will assign the closer free port (this is called
“sequentially port allocation”), usually by increasing the port value, although this
behavior has not been standarized at all.
</p><!--l. 81--><p class="indent" >   When random port allocation is implemented, the public port will be assigned at
random. Notice that, even in SN-PPA conﬁgurations, in most of the real situations
(where peers must compete with the rest of processes that use the network for the
same NAT resources,) some kind of randomization should be always expected during
a the port assignment.
</p><!--l. 88--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.4   </span> <a 
 id="x1-190008.4"></a>NAT type analysis</h4>
<!--l. 89--><p class="noindent" >An incoming peer <!--l. 89--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
can determine its NAT behavior using the following steps:
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-19002x1">Let <!--l. 92--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mi 
>M</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">}</mo></mrow></math> the public ports
     used by peer <!--l. 93--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>, whose
                                                                  

                                                                  
     NAT is <!--l. 93--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>, to send
     the [<!--l. 93--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>] UDP packets
     towards the splitter <!--l. 94--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     and the <!--l. 94--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     monitor peers of the team, in this order. This data is known by
     <!--l. 95--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
     after receiving the acknowledgment of each
     [<!--l. 96--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>].
     Compute <table class="equation"><tr><td> <a 
 id="x1-19003r1"></a>
     <!--l. 97--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                                         <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo><msub><mrow 
> <mi mathvariant="sans-serif">A</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
> <mo 
class="MathClass-bin">−</mo><msub><mrow 
><mi mathvariant="sans-serif">A</mi></mrow><mrow 
><mi 
>k</mi><mo 
class="MathClass-bin">−</mo><mn>1</mn></mrow></msub 
>
</math></td><td class="eq-no">(1)</td></tr></table>
     <!--l. 101--><p class="noindent" >for <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>k</mi> <mo 
class="MathClass-rel">=</mo> <mn>1</mn><mo 
class="MathClass-punc">,</mo><mn>2</mn><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><mi 
>M</mi></math>, the <span 
class="ecti-1000">port distances</span>
     gathered by <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>.
     </p></li>
     <li 
  class="enumerate" id="x1-19005x2">Determine a <span 
class="ecti-1000">port step </span><table class="equation"><tr><td> <a 
 id="x1-19006r2"></a>
     <!--l. 103--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>Δ</mi> <mo 
class="MathClass-rel">=</mo> <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  align="axis" style=""  
equalrows="false" columnlines="none" equalcolumns="false" class="array"> <mtr><mtd 
class="array"  columnalign="left">  <mn>0</mn><mo 
class="MathClass-punc">,</mo>                   </mtd><mtd 
class="array"  columnalign="right"> <mstyle 
class="text"><mtext  >if </mtext></mstyle><mo 
class="MathClass-op">∀</mo><mi 
>i</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <mn>0</mn> </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left">  <mi mathvariant="normal">GCD</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>m</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-punc">,</mo> </mtd><mtd 
class="array"  columnalign="right">    <mstyle 
class="text"><mtext  >otherwise</mtext></mstyle>  </mtd></mtr><!--lr--></mtable>                                                         </mrow></mfenced>
</math></td><td class="eq-no">(2)</td></tr></table>
     <!--l. 110--><p class="noindent" >where GCD is the Greatest Common Divisor operator.
     </p></li>
     <li 
  class="enumerate" id="x1-19008x3">If <!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Δ</mi> <mo 
class="MathClass-rel">=</mo> <mn>0</mn></math>
     (<!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     is using the same external port for communicating
     <!--l. 112--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> with the rest of peers
     of the team) then <!--l. 112--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
                                                                  

                                                                  
     is behind a cone NAT. Notice that public (not NATed) peers will be considered
     as being using this type of NAT, also.
     </li>
     <li 
  class="enumerate" id="x1-19010x4">If <!--l. 115--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Δ</mi> <mo 
class="MathClass-rel">&#x003E;</mo> <mn>0</mn></math>
     (<!--l. 115--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     is using a diﬀerent external port for each external peer) then
     <!--l. 116--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
     is behind a symmetric NAT. In this case:
         <ol  class="enumerate2" >
         <li 
  class="enumerate" id="x1-19012x1">If <table class="equation"><tr><td> <a 
 id="x1-19013r3"></a>
         <!--l. 119--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                                       <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <mo 
class="MathClass-rel">⋯</mo> <mo 
class="MathClass-rel">=</mo> <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>m</mi></mrow></msub 
>
</math></td><td class="eq-no">(3)</td></tr></table>
         <!--l. 122--><p class="noindent" >then <!--l. 122--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
         is using sequentially port allocation.
         </p></li>
         <li 
  class="enumerate" id="x1-19015x2">If <table class="equation"><tr><td> <a 
 id="x1-19016r4"></a>
         <!--l. 124--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                            <mi 
>Δ</mi> <mo 
class="MathClass-rel">=</mo><munder class="msub"><mrow 
><mo class="qopname"> lim</mo></mrow><mrow 
><mi 
>m</mi><mo 
class="MathClass-rel">→</mo><mi 
>∞</mi></mrow></munder 
><mi mathvariant="normal">GCD</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>m</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mn>1</mn><mo 
class="MathClass-punc">.</mo>
</math></td><td class="eq-no">(4)</td></tr></table>
         <!--l. 127--><p class="noindent" >then <!--l. 127--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
         is using random port allocation.</p></li></ol>
     </li></ol>
                                                                  

                                                                  
<!--l. 131--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.5   </span> <a 
 id="x1-200008.5"></a>(Theoretical) NAT traversal performance of DBS</h4>
   <div class="table">
                                                                  

                                                                  
<!--l. 134--><p class="indent" >   <a 
 id="x1-200012"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div class="tabular"> <table id="TBL-4" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-4-1g"><col 
id="TBL-4-1" /></colgroup><colgroup id="TBL-4-2g"><col 
id="TBL-4-2" /></colgroup><colgroup id="TBL-4-3g"><col 
id="TBL-4-3" /></colgroup><colgroup id="TBL-4-4g"><col 
id="TBL-4-4" /></colgroup><colgroup id="TBL-4-5g"><col 
id="TBL-4-5" /></colgroup><colgroup id="TBL-4-6g"><col 
id="TBL-4-6" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-4-1-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-1-1"  
class="td11"> Peer1/2  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-2"  
class="td11">  CN  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-3"  
class="td11"> CN-AF  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-4"  
class="td11"> CN-EF  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-5"  
class="td11"> SN-PPA  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-6"  
class="td11"> SN-RPA  </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-2-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-2-1"  
class="td11"> CN         </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-3"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-4"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-5"  
class="td11">    DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-6"  
class="td11">    DBS  </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-3-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-3-1"  
class="td11"> CN-AF </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-2"  
class="td11"> DBS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-3"  
class="td11"> DBS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-4"  
class="td11"> DBS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-5"  
class="td11"> NTS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-6"  
class="td11"> -</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-4-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-4-1"  
class="td11"> CN-EF    </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-3"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-4"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-5"  
class="td11">    NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-6"  
class="td11">        -  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-5-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-5-1"  
class="td11"> SN-PPA  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-3"  
class="td11">   NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-4"  
class="td11">   NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-5"  
class="td11">    NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-6"  
class="td11">        -  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-6-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-6-1"  
class="td11"> SN-RPA  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-3"  
class="td11">       -  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-4"  
class="td11">      -  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-5"  
class="td11">       -  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-6"  
class="td11">        -  </td></tr></table></div>
<br /> <div class="caption" 
><span class="id">Table 2: </span><span  
class="content">NAT traversal success for diﬀerent NAT typical combinations. CN-NF
(also known by “full cone NAT”) stands for Cone NAT (without packet ﬁltering).
CN-AF (also known as “restricted cone NAT”) stands for Cone NAT with source
Address Filtering. CN-EF (also known by “port restricted cone NAT”) stands for
Cone NAT source End-point Filtering. SN-PPA stands for Symmetric NAT Port
Preservation Allocation, and no packet ﬁltering has been considered. SN-RPA
stands for Symmetric NAT Random Port Allocation, and no packet ﬁltering has
been used. </span></div><!--tex4ht:label?: x1-200012 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-2000210"></a>
                                                                  

                                                                  
<!--l. 157--><p class="noindent" > <div style="text-align:center;"> <img width=600 src="graphics/UDP_Hole_Punching_RCN.png" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 10: </span><span  
class="content">An example that shows how it is possible to establish a connection
with                  DBS                  when                  two                  peers
<!--l. 160--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and
<!--l. 160--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
that are behind cone NATs.</span></div><!--tex4ht:label?: x1-2000210 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-2000311"></a>
                                                                  

                                                                  
<!--l. 164--><p class="noindent" > <div style="text-align:center;"> <img width=600 src="graphics/UDP_Hole_Punching_SN_failure.png" /> </div> 
<br />           </p><div class="caption" 
><span class="id">Figure 11:                 </span><span  
class="content">An                 example                 that
shows why its is impossible to establish a connection with DBS when two peers
<!--l. 167--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and
<!--l. 167--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
that are behind symmetric NATs.</span></div><!--tex4ht:label?: x1-2000311 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
                                                                  

                                                                  
<!--l. 171--><p class="indent" >   <a 
 id="x1-2000412"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img width=800 src="graphics/SNTuCPP.png" /> </div> 
<br /> <div class="caption" 
><span class="id">Figure 12:  </span><span  
class="content">Timeline  of  an  (ideal)  NTS  interaction  between  two  peers
<!--l. 174--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and
<!--l. 174--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
which are behind symmetric NATs. </span></div><!--tex4ht:label?: x1-2000412 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
<!--l. 177--><p class="indent" >   Table <a 
href="#x1-200012">2<!--tex4ht:ref: tab:theoretical --></a> shows the theoretical traversal success of DBS (or an extension of it) for
diﬀerent NAT type combinations. Peer1 represents to a peer already joined to the
team, and Peer2 to an incoming peer. The entries labeled with “DBS” are those
that will be handled by DBS, out-of-the-box. An explanation of why the
DBS handshake works for such conﬁgurations is shown in Fig. <a 
href="#x1-2000210">10<!--tex4ht:ref: fig:UDP_Hole_Punching_RCN --></a>. Notice
that source end-point ﬁltering has been used in this example, although a
similar results should be obtained for simple source address ﬁltering. On the
other hand, the combinations labeled with “-” or “NTS” will not work with
DBS (see Fig.<a 
href="#x1-2000311">11<!--tex4ht:ref: fig:UDP_Hole_Punching_SN_failure --></a>). In fact, only the “NTS” entries should work, in general,
with NTS, depending on the port prediction algorithm and the number of
tries.
</p><!--l. 192--><p class="indent" >   Fig. <a 
href="#x1-2000412">12<!--tex4ht:ref: fig:SNTuCPP --></a> shows an example of an NTS (NAT traversal) success. When the new NATed
peers, <!--l. 193--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and <!--l. 193--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>,
arrive at the team, the following events happen:
</p>
     <ul class="itemize1">
     <li class="itemize"><!--l. 201--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     requests to join the team (the joining request is not shown in the ﬁgure for
     brevity) and <!--l. 202--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     sends to <!--l. 202--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     an empty list of peers. At this moment, <!--l. 203--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     has joined the team.
     </li>
     <li class="itemize"><!--l. 204--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     requests <!--l. 204--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     to join through an external port <!--l. 205--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
     (again, this message is not shown). <!--l. 205--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     sends to <!--l. 205--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     the list of peers. This list contains only the endpoint of <!--l. 206--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>.
     </li>
     <li class="itemize">NAT <!--l. 207--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     relays towards <!--l. 207--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     the previuos message.
     </li>
     <li class="itemize"><!--l. 208--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     answers <!--l. 208--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mi 
>M</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     to <!--l. 208--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>.
     </li>
     <li class="itemize"><!--l. 209--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     relays the previous message, which is received by <!--l. 210--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>.
                                                                  

                                                                  
     Due to <!--l. 210--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     is a symmetric NAT, a new source port <!--l. 210--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     is used for this message.
     </li>
     <li class="itemize"><!--l. 212--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     sends <!--l. 212--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><mi 
>M</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     towards <!--l. 212--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>.
     </li>
     <li class="itemize">The previous message is relayed by <!--l. 213--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>.
     Simultaneously, <!--l. 214--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     informs to <!--l. 214--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     that <!--l. 214--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     has communicated with it, using the external endpoint <!--l. 215--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 216--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     acknowledges the reception of the previous message.
     </li>
     <li class="itemize"><!--l. 218--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     requests to join the team (not shown) and <!--l. 218--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     sends to it the current list of peers, which contains the endpoint of <!--l. 220--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     and the tuple <!--l. 220--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>A</mi></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mi 
>#</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>
     (the external endpoint used by <!--l. 221--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     to communicate with <!--l. 221--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>,
     the maximum port step in NAT <!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>,
     <!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>A</mi></mrow></msub 
></math>
     measured by <!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     for <!--l. 222--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     thoroughtout its incorporation to the team, and the index of <!--l. 224--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>,
     <!--l. 224--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>#</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>,
     in the list of peers). Using this information, <!--l. 225--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     will perform the port prediction for the external port that <!--l. 226--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
mathvariant="bold-script">𝒜</mi></math>
     will assign to <!--l. 226--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     when it be communicating with <!--l. 227--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>.
     This prediction is the list of ports <!--l. 228--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>Z</mi></mrow><mrow 
><mi 
>#</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow></msub 
> <mo 
class="MathClass-rel">=</mo></math> <span 
class="ectt-0800">get_guessed_ports</span><span 
class="ectt-1000">(</span><!--l. 229--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>#</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math><span 
class="ectt-0800">,</span><!--l. 229--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math><span 
class="ectt-0800">,</span><!--l. 229--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>A</mi></mrow></msub 
></math><span 
class="ectt-1000">)</span>
     is populated by <!--l. 230--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     using the Algorithm <span 
class="ecbx-1000">??</span>.
     </li>
     <li class="itemize"><!--l. 231--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>
     retransmits the previous message.
     </li>
     <li class="itemize"><!--l. 232--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     sends a <!--l. 232--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mi 
>M</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     towards <!--l. 232--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>.
                                                                  

                                                                  
     </li>
     <li class="itemize"><!--l. 233--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>
     retransmits the previous message, which arrives to <!--l. 234--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>,
     and <!--l. 234--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     sends a <!--l. 235--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     towards <!--l. 236--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>,
     which has been computed in the Step 08.
     </li>
     <li class="itemize">The previous message arrives to <!--l. 237--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>A</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>
     (which is correct), but <!--l. 238--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
     discards this packet because still there is not a working entry in its translation
     table for the key <!--l. 241--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>B</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 242--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     acknowledges the <!--l. 242--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mi 
>M</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>,
     which arrived in the Step 11.
     </li>
     <li class="itemize">The <!--l. 244--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><mi 
>M</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     message is received by <!--l. 244--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     and <!--l. 245--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     informs to <!--l. 245--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     that <!--l. 245--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     is also using the port <!--l. 245--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     (this information is used to compute the maximum port step <!--l. 246--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>B</mi></mrow></msub 
></math>
     in NAT <!--l. 247--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math>,
     measured for <!--l. 247--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     thoroughout its incorporation.
     </li>
     <li class="itemize"><!--l. 248--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     acknowledges the previous reception.
     </li>
     <li class="itemize"><!--l. 249--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     sends to <!--l. 249--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     the message <!--l. 249--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>B</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>B</mi></mrow></msub 
><mo 
class="MathClass-punc">,</mo><msup><mrow 
><mi 
>S</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     (external end-point used by <!--l. 250--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     to talk with <!--l. 250--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>,
     port step measured for <!--l. 251--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     and a new temporaly listenning port <!--l. 252--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>S</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
></math>
     at node <!--l. 252--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>).
     The tuple <!--l. 253--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>B</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>B</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>
     allows <!--l. 253--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     to predict which external port (<!--l. 254--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>)
     will use <!--l. 255--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">NAT</mi><mi 
>B</mi></math>
                                                                  

                                                                  
     when <!--l. 255--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     sends a packet to <!--l. 255--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>.
     The extra socket bound by <!--l. 256--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     to <!--l. 256--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>S</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
></math>
     will be used to update the external port that <!--l. 257--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     is currently using to communicate with the rest of peers of the team.
     </li>
     <li class="itemize"><!--l. 259--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     receives the previous message.
     </li>
     <li class="itemize"><!--l. 260--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     says <!--l. 260--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     to EEP <!--l. 261--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi mathvariant="normal">NAT</mi><mi 
>B</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 262--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     says <!--l. 262--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mi 
>S</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     to EEP <!--l. 262--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>S</mi><mo 
class="MathClass-punc">,</mo><msup><mrow 
><mi 
>S</mi></mrow><mrow 
><mi 
>′</mi></mrow></msup 
></mrow><mo 
class="MathClass-close">)</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 263--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">NAT</mi><mi 
>B</mi></math>
     relays the message <!--l. 264--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     towards <!--l. 264--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     and <!--l. 264--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><mi 
>S</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     is received by <!--l. 265--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     (which updates the external port for <!--l. 266--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>).
     Notice that at this moment, <!--l. 266--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     knows that <!--l. 266--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     is able to send data to it.
     </li>
     <li class="itemize">Both, <!--l. 268--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     and <!--l. 268--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     acknowledges the <!--l. 268--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     messages.
     </li>
     <li class="itemize"><!--l. 270--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><mi 
>S</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     is received by <!--l. 270--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>,
     <!--l. 271--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     is received by <!--l. 271--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">NAT</mi><mi 
>A</mi></math>
     and the timer assigned to the message <!--l. 272--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     sent in Step 11 timeouts and this message is re-sent.
     </li>
     <li class="itemize"><!--l. 274--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
                                                                  

                                                                  
     receives <!--l. 274--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     and <!--l. 274--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">NAT</mi><mi 
>A</mi></math>
     receives <!--l. 275--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 276--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     is delivered to <!--l. 276--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>.
     At this moment, <!--l. 277--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     knows that <!--l. 277--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     is able to send data to it.
     </li>
     <li class="itemize"><!--l. 278--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     acknowledges the previous <!--l. 278--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>.
     </li>
     <li class="itemize"><!--l. 279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     arrives to <!--l. 279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="normal">NAT</mi><mi 
>B</mi></math>.
     </li>
     <li class="itemize"><!--l. 280--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">ack</mi><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
     arrives to <!--l. 280--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>.
     </li>
     <li class="itemize"><!--l. 281--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     and <!--l. 281--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
     annouce to the <!--l. 281--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
     the source port used by the other peer.
     </li>
     <li class="itemize">This information is received by the <!--l. 283--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>,
     which updates the external port information for <!--l. 284--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
     and <!--l. 284--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>.</li></ul>
<!--l. 287--><p class="indent" >   Summarizing, NTS can provide connectivity for those peers that are behind
port-preservation symmetric NATs with sequential port allocation.
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.6   </span> <a 
 id="x1-210008.6"></a>A port prediction algorithm (Max’s proposal)</h4>
<!--l. 292--><p class="noindent" >When both peers, Peer1 and Peer2, are behind symmetric NATs, both must predict
the port that the NAT of the interlocutor peer will use to send the packets towards
it. And obviously, this must be performed by each already incorporated peer that is
behind a symmetric NAT.
</p><!--l. 297--><p class="indent" >   The list of predicted ports <!--l. 297--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Z</mi></math>
that a a peer <!--l. 297--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>x</mi></mrow></msub 
></math>
performs is determined by: </p><table class="equation"><tr><td> <a 
 id="x1-21001r5"></a>
                                                                  

                                                                  
<!--l. 299--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
 <mtable  align="axis" style=""  
equalrows="false" columnlines="none none" equalcolumns="false" class="array"> <mtr><mtd 
class="array"  columnalign="right">  <mi 
>Z</mi> </mtd><mtd 
class="array"  columnalign="center">   <mo 
class="MathClass-rel">=</mo>   </mtd><mtd 
class="array"  columnalign="left"> <msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
> <mo 
class="MathClass-bin">+</mo> <mi 
>x</mi> <mo 
class="MathClass-bin">+</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>s</mi> <mo 
class="MathClass-rel">∈</mo><mrow ><mo 
class="MathClass-open">{</mo><mrow><mn>0</mn><mo 
class="MathClass-punc">,</mo><mn>1</mn><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><mi 
>N</mi><mo 
class="MathClass-bin">∕</mo><mn>2</mn> <mo 
class="MathClass-bin">−</mo> <mn>1</mn></mrow><mo 
class="MathClass-close">}</mo></mrow></mrow><mo 
class="MathClass-close">}</mo></mrow><mo 
class="MathClass-punc">;</mo>      </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="right">  <mi 
>Z</mi> </mtd><mtd 
class="array"  columnalign="center"> <mo 
class="MathClass-bin">+</mo> <mo 
class="MathClass-rel">=</mo> </mtd><mtd 
class="array"  columnalign="left"> <msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
> <mo 
class="MathClass-bin">+</mo> <mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>x</mi> <mo 
class="MathClass-bin">+</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>s</mi> <mo 
class="MathClass-rel">∈</mo><mrow ><mo 
class="MathClass-open">{</mo><mrow><mn>0</mn><mo 
class="MathClass-punc">,</mo><mn>1</mn><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><mi 
>N</mi> <mo 
class="MathClass-bin">−</mo> <mn>1</mn></mrow><mo 
class="MathClass-close">}</mo></mrow></mrow><mo 
class="MathClass-close">}</mo></mrow></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-bin">⋅</mo> <mi 
>Δ</mi><mo 
class="MathClass-punc">.</mo> </mtd></mtr><!--rcl--></mtable>
</math></td><td class="eq-no">(5)</td></tr></table>
<!--l. 305--><p class="indent" >   where “<!--l. 305--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin">+</mo> <mo 
class="MathClass-rel">=</mo></math>” denotes the
concatenation of lists and <!--l. 305--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math> is
the number of guessed ports, <!--l. 306--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is the ﬁrst external port (the port used to communicate with
<!--l. 307--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>) assigned to the
incoming peer and <!--l. 308--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Δ</mi></math>
is the (maximum) port step measured for the incoming peer’s NAT.
</p><!--l. 56--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">9   </span> <a 
 id="x1-220009"></a>MCS (Multi-Channel Set)</h3>
<!--l. 1--><p class="noindent" >When using MDC <span class="cite">[<a 
href="#Xbaccichet2007content">1</a>]</span>, SVC <span class="cite">[<a 
href="#Xchu2009auction">3</a>]</span>, or for emulating the CS model, it can be interesting
for peers to belong to more than one team. To implement MCS, peers must replicate
the P2PSP modules (DBS at least) for each team (channel), except the
buﬀer.
</p><!--l. 7--><p class="indent" >   The use of MDC is trivial: the higher the number received descriptions (channels),
even partially, the higher the quality of the playback. However, when transmitting
SVC media, peers should prioritize the reception of the most important layers.
Finally, a pure CS service could be provided if the corresponding splitter announces
one empty team and sends each chunk so many times as teams (with one peer/team)
there are.
</p><!--l. 1--><p class="noindent" >
</p>
   <h3 class="likesectionHead"><a 
 id="x1-230009"></a>References</h3>
<!--l. 1--><p class="noindent" >
   </p><div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
 [1]<span class="bibsp">   </span></span><a 
 id="Xbaccichet2007content"></a>Pierpaolo  Baccichet,  Jeonghun  Noh,  Eric  Setton,  and  Bernd  Girod.
   Content-aware p2p video streaming with low latency.  In <span 
class="ecti-1000">Multimedia and</span>
   <span 
class="ecti-1000">Expo, 2007 IEEE International Conference on</span>, pages 400–403. IEEE, 2007.
                                                                  

                                                                  
   </p>
   <p class="bibitem" ><span class="biblabel">
 [2]<span class="bibsp">   </span></span><a 
 id="Xbanerjee2002scalable"></a>Suman Banerjee, Bobby Bhattacharjee, and Christopher Kommareddy.
   <span 
class="ecti-1000">Scalable application layer multicast</span>, volume 32. ACM, 2002.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [3]<span class="bibsp">   </span></span><a 
 id="Xchu2009auction"></a>Xiaowen  Chu,  Kaiyong  Zhao,  Zongpeng  Li,  and  Anirban  Mahanti.
   Auction-based  on-demand  p2p  min-cost  media  streaming  with  network
   coding.      <span 
class="ecti-1000">IEEE  Transactions  on  Parallel  and  Distributed  Systems</span>,
   20(12):1816–1829, 2009.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [4]<span class="bibsp">   </span></span><a 
 id="XComer1"></a>Douglas E. Comer. <span 
class="ecti-1000">Internetworking with TCP/IP. Principles, Protocols,</span>
   <span 
class="ecti-1000">and Architectures (4th Edition)</span>, volume 1. Prentice Hall, 2000.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [5]<span class="bibsp">   </span></span><a 
 id="Xcomer2003computer"></a>Douglas E  Comer  and  Ralph E  Droms.    <span 
class="ecti-1000">Computer  networks  and</span>
   <span 
class="ecti-1000">internets</span>. Prentice-Hall, Inc., 2003.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [6]<span class="bibsp">   </span></span><a 
 id="Xshabtay2011ip"></a>Lior  Shabtay  and  Benny  Rodrig.   Ip  multicast  in  vlan  environment,
   April 12 2011. US Patent 7,924,837.
</p>
   </div>
    
</body> 
</html>
                                                                  



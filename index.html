<!DOCTYPE html> 
<html> 
<head> <title>P2PSP (Peer-to-Peer Straightforward Protocol)</title> 
<meta charset="UTF-8" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<link rel="stylesheet" type="text/css" href="index.css" /> 
<script type="text/javascript" 
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" 
></script> 
<style type="text/css"> 
.MathJax_MathML {text-indent: 0;} 
</style> 
</head><body 
>
   <div class="maketitle">
                                                                  

                                                                  
                                                                  

                                                                  

<h2 class="titleHead">P2PSP (Peer-to-Peer Straightforward Protocol)</h2>
 <div class="author" ><span 
class="ecrm-1200">The P2PSP team</span></div><br />
<div class="date" ><span 
class="ecrm-1200">August 4, 2018</span></div>
   </div>
   <h3 class="likesectionHead"><a 
 id="x1-1000"></a>Contents</h3>
   <div class="tableofcontents">
   <span class="sectionToc" >1 <a 
href="#x1-20001" id="QQ2-1-2">DBS (Data Broadcasting Set)</a></span>
<br />    <span class="subsectionToc" >1.1 <a 
href="#x1-30001.1" id="QQ2-1-4">Joining a team</a></span>
<br />    <span class="subsectionToc" >1.2 <a 
href="#x1-40001.2" id="QQ2-1-6">Leaving a team</a></span>
<br />    <span class="subsectionToc" >1.3 <a 
href="#x1-50001.3" id="QQ2-1-8">Chunk generation</a></span>
<br />    <span class="subsectionToc" >1.4 <a 
href="#x1-60001.4" id="QQ2-1-10">Chunk ﬂooding</a></span>
<br />    <span class="subsectionToc" >1.5 <a 
href="#x1-70001.5" id="QQ2-1-11">Chunk buﬀering</a></span>
<br />    <span class="subsectionToc" >1.6 <a 
href="#x1-80001.6" id="QQ2-1-12">Free-riding control at splitters</a></span>
<br />   <span class="sectionToc" >2 <a 
href="#x1-90002" id="QQ2-1-13">FCS (Free-riding Control Set)</a></span>
<br />   <span class="sectionToc" >3 <a 
href="#x1-100003" id="QQ2-1-14">IMS (Ip Multicast Set)</a></span>
<br />   <span class="sectionToc" >4 <a 
href="#x1-110004" id="QQ2-1-15">MRS (Massively-lost chunk Recovery Set)</a></span>
<br />   <span class="sectionToc" >5 <a 
href="#x1-120005" id="QQ2-1-16">TAS (Topology Adaptation Set)</a></span>
<br />   <span class="sectionToc" >6 <a 
href="#x1-130006" id="QQ2-1-17">ACS (Adaptive Capacity Set)</a></span>
<br />   <span class="sectionToc" >7 <a 
href="#x1-140007" id="QQ2-1-18">MCS (Multi-Channel Set)</a></span>
<br />   <span class="sectionToc" >8 <a 
href="#x1-150008" id="QQ2-1-19">NTS (NAT Traversal Set)</a></span>
<br />    <span class="subsectionToc" >8.1 <a 
href="#x1-160008.1" id="QQ2-1-20">Traﬃc ﬁltering</a></span>
<br />    <span class="subsectionToc" >8.2 <a 
href="#x1-170008.2" id="QQ2-1-23">Cone VS symmetric</a></span>
<br />    <span class="subsectionToc" >8.3 <a 
href="#x1-180008.3" id="QQ2-1-24">Port allocation</a></span>
<br />    <span class="subsectionToc" >8.4 <a 
href="#x1-190008.4" id="QQ2-1-25">NAT type analysis</a></span>
<br />    <span class="subsectionToc" >8.5 <a 
href="#x1-200008.5" id="QQ2-1-26">(Theoretical) NAT traversal performance of DBS</a></span>
<br />    <span class="subsectionToc" >8.6 <a 
href="#x1-210008.6" id="QQ2-1-31">A port prediction algorithm (Max’s proposal)</a></span>
   </div>
   <div 
class="abstract" 
>
                                                                  

                                                                  
<div class="center" 
>
<!--l. 7--><p class="noindent" >
</p><!--l. 7--><p class="noindent" ><span 
class="ecbx-0900">Abstract</span></p></div>
<!--l. 7--><p class="noindent" >
     </p><!--l. 1--><p class="indent" >   <span 
class="ecrm-0900">P2PSP   (see   </span><a 
href="https://p2psp.github.io" class="url" ><span 
class="ectt-0900">https://p2psp.github.io</span></a><span 
class="ecrm-0900">)   is   an   application-layer</span>
     <span 
class="ecrm-0900">protocol that provides real-time broadcasting, also known as Application</span>
     <span 
class="ecrm-0900">Layer Multicast (ALM), of a media stream on the Internet. As in many</span>
     <span 
class="ecrm-0900">other P2P protocols, peers collaborate to diseminate the stream that is</span>
     <span 
class="ecrm-0900">generated by a single source, minimizing the latency and the protocol</span>
     <span 
class="ecrm-0900">overhead. P2PSP has a modular design organized in </span><span 
class="ecti-0900">sets of rules</span><span 
class="ecrm-0900">, where</span>
     <span 
class="ecrm-0900">each module is especialzed in implementing a diﬀerent functionality.</span>
</p>
</div>
<!--l. 14--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-20001"></a>DBS (Data Broadcasting Set)</h3>
   <div class="table">
                                                                  

                                                                  
<!--l. 4--><p class="indent" >   <a 
 id="x1-20011"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div class="tabular"> <table id="TBL-2" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1" /><col 
id="TBL-2-2" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-1-1"  
class="td11">                                                          Parameter  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-1-2"  
class="td11"> Meaning                                                                                                                                                                                                                                 </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-2-1"  
class="td11"> <!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>G</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-2-2"  
class="td11"> Maximum number of teams                                                                                                                                                                                                        </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-3-1"  
class="td11"> <!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-3-2"  
class="td11"> Maximum number of peers in a team</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-4-1"  
class="td11"> <!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>C</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-4-2"  
class="td11"> Maximum size of a chunk of media                                                                                                                                                                                              </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-5-1"  
class="td11"> <!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-5-2"  
class="td11"> buﬀer size in chunks</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-6-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-6-1"  
class="td11">                                                                     </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-7-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-7-1"  
class="td11"> Entity</td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-7-2"  
class="td11"> Role                                                                                                                                                                                                                                      </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-8-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-8-1"  
class="td11"> <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>O</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-8-2"  
class="td11"> the media source                                                                                                                                                                                                                      </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-9-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-9-1"  
class="td11"> <!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>T</mi></mrow><mo 
class="MathClass-close">}</mo></mrow></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-9-2"  
class="td11"> all the teams that receive the same media stream                                                                                                                                                                           </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-10-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-10-1"  
class="td11"> <!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-10-2"  
class="td11"> teams tracker                                                                                                                                                                                                                          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-11-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-11-1"  
class="td11"> <!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>S</mi></mrow><mo 
class="MathClass-close">}</mo></mrow></math> </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-11-2"  
class="td11"> the set of splitters broadcasting the same stream                                                                                                                                                                            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-12-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-12-1"  
class="td11"> <!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-12-2"  
class="td11"> one of the <!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel">|</mo><mi 
>T</mi><mo 
class="MathClass-rel">|</mo></math> teams in <!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>T</mi></mrow><mo 
class="MathClass-close">}</mo></mrow></math> </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-13-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-13-1"  
class="td11"> <!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-13-2"  
class="td11"> the splitter of <!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math>                                                                                                </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-14-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-14-1"  
class="td11"> <!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-14-2"  
class="td11"> <!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>-th peer of <!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math>            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-15-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-15-1"  
class="td11"> <!--l. 21--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>T</mi></mrow><mrow 
><mi 
>i</mi></mrow></msup 
></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-15-2"  
class="td11"> the neighbors of <!--l. 21--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>                                                                                                                 </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-16-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-16-1"  
class="td11">                                                                     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-17-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-17-1"  
class="td11">                                                            Variable  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-17-2"  
class="td11"> Meaning                                                                                                                                                                                                                                 </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-18-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-18-1"  
class="td11"> <!--l. 25--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-rel">≤</mo><mo 
class="MathClass-rel">|</mo><mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>T</mi></mrow><mo 
class="MathClass-close">}</mo></mrow><mo 
class="MathClass-rel">|</mo><mo 
class="MathClass-rel">≤</mo> <mi 
>G</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-18-2"  
class="td11"> current number of teams broadcasting the same channel                                                                                                                                                                  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-19-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-19-1"  
class="td11"> <!--l. 27--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-rel">≤</mo><mo 
class="MathClass-rel">|</mo><mi 
>T</mi><mo 
class="MathClass-rel">|</mo><mo 
class="MathClass-rel">≤</mo> <mi 
>N</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-19-2"  
class="td11"> current number of peers in team <!--l. 27--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math>                                                                           </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-20-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-20-1"  
class="td11"> <!--l. 28--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-rel">≤</mo><mo 
class="MathClass-rel">|</mo><msup><mrow 
><mi 
>T</mi></mrow><mrow 
><mi 
>i</mi></mrow></msup 
><mo 
class="MathClass-rel">|</mo><mo 
class="MathClass-rel">≤</mo> <mi 
>N</mi></math>  </td><td  style="text-align:left; white-space:nowrap;" id="TBL-2-20-2"  
class="td11"> current number of neighbor peers in <!--l. 28--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>T</mi></mrow><mrow 
><mi 
>i</mi></mrow></msup 
></math>                                                                                      </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-21-"><td  style="text-align:right; white-space:nowrap;" id="TBL-2-21-1"  
class="td11">                                                                    </td></tr></table>
</div>
<br /> <div class="caption" 
><span class="id">Table 1: </span><span  
class="content">Nomenclature used in DBS.</span></div><!--tex4ht:label?: x1-20011 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
   </div>
<!--l. 33--><p class="indent" >   DBS provides ALM <span class="cite">[<a 
href="#Xbanerjee2002scalable">2</a>]</span> of a media stream in unicast environments <span class="cite">[<a 
href="#Xcomer2003computer">4</a>]</span>. The media is sent by a
streaming server <!--l. 35--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>O</mi></math>,
called <span 
class="ecti-1000">source </span>(the nomenclature used for describing DBS is shown in Table <a 
href="#x1-20011">1<!--tex4ht:ref: tab:DBS_nomenclature --></a>), and received by a
set of <span 
class="ecti-1000">splitters </span><!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>S</mi></mrow><mo 
class="MathClass-close">}</mo></mrow></math>.
Each splitter <!--l. 39--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
divides the stream into a sequence of <span 
class="ecti-1000">chunks</span>, and relay them to its corresponding <span 
class="ecti-1000">team</span>
<!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math>, where it can be up to
<!--l. 41--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math> <span 
class="ecti-1000">peers</span>. We deﬁne the set of
teams as <!--l. 42--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>T</mi></mrow><mo 
class="MathClass-close">}</mo></mrow></math>, and enumerate
the peers in the team <!--l. 44--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math>
as <!--l. 44--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi> <mo 
class="MathClass-rel">=</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mo 
class="MathClass-rel">|</mo><mi 
>T</mi><mo 
class="MathClass-rel">|</mo></mrow></msub 
></mrow><mo 
class="MathClass-close">}</mo></mrow></math>.
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.1   </span> <a 
 id="x1-30001.1"></a>Joining a team</h4>
                                                                  

                                                                  
<!--l. 6--><p class="indent" >   <a 
 id="x1-30011"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img height=230 src="graphics/joining.png" /> </div> 
<br />     <div class="caption" 
><span class="id">Figure 1:        </span><span  
class="content">Tasks        involved        in        a        peer        joining.
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
is                   the                   incoming                   peer,                   and
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math>
is        a        peer        that        is        already        in        the        team.
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi></math>
represents                        the                        tracker,                        and
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
the                   splitter                   of                   the                   team
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math>
to                                                                                             which
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math>
belongs,                                                                                        and
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
will be added.</span></div><!--tex4ht:label?: x1-30011 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
<!--l. 12--><p class="noindent" >An incoming peer <!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
(see the tasks described in Fig. <a 
href="#x1-30011">1<!--tex4ht:ref: fig:joining --></a>), interested in a given channel, ﬁrst must
join a team in order to access to the contents of such channel. For that,
<!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> requests a splitter
to the <span 
class="ecti-1000">tracker </span><!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi></math>.
<!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi></math>, that continuously
is receiving, from <!--l. 16--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>S</mi></mrow><mo 
class="MathClass-close">}</mo></mrow></math>,
<span 
class="ecti-1000">reliable</span><span class="footnote-mark"><a 
href="index2.html#fn1x0"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-3002f1"></a> 
messages containing the number of peers of each team of
<!--l. 23--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>T</mi></mrow><mo 
class="MathClass-close">}</mo></mrow></math>, selects a team
with room for <!--l. 24--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>,
and transmits to <!--l. 24--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
a <!--l. 24--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>S</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
message<span class="footnote-mark"><a 
href="index3.html#fn2x0"><sup class="textsuperscript">2</sup></a></span><a 
 id="x1-3003f2"></a> .
Then, <!--l. 26--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> requests
to <!--l. 27--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math> to be
included in <!--l. 27--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math>. If
<!--l. 27--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math> accepts (during the
joining process of <!--l. 28--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> it
could happen that <!--l. 28--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel">|</mo><mi 
>T</mi><mo 
class="MathClass-rel">|</mo> <mo 
class="MathClass-rel">=</mo> <mi 
>N</mi></math>
because other peer are trying to join at the same time), then
<!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math> transmits to
<!--l. 29--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> a message
<!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>T</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math> (more precisely, the list
of peers in <!--l. 30--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math>, in a reliable
message), and runs <!--l. 31--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi> <mo 
class="MathClass-rel">=</mo> <mi 
>T</mi> <mo 
class="MathClass-bin">∪</mo> <msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>,
in this order. If <!--l. 31--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math> does
not accept, <!--l. 32--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math> requests
a new team to <!--l. 32--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi></math>,
and resets the procedure.
</p><!--l. 40--><p class="indent" >   While arriving, <!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
does not store <!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math> as it
is received. Instead, <!--l. 41--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>
sends an (unreliable) <!--l. 42--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
                                                                  

                                                                  
message to each <!--l. 42--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
> <mo 
class="MathClass-rel">∈</mo> <mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>T</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>,
and when <!--l. 43--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math> receives
a <!--l. 43--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>, it performs
<!--l. 43--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>T</mi></mrow><mrow 
><mi 
>k</mi></mrow></msup 
> <mo 
class="MathClass-rel">=</mo> <msup><mrow 
><mi 
>T</mi></mrow><mrow 
><mi 
>k</mi></mrow></msup 
> <mo 
class="MathClass-bin">∪</mo> <msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
></math>. Therefore, the
list of peers <!--l. 44--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>T</mi></mrow><mrow 
><mi 
>k</mi></mrow></msup 
></math> that a
peer <!--l. 44--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math> handles (the
neighbor peers of <!--l. 45--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math>),
initially depends (see Sec. <a 
href="#x1-60001.4">1.4<!--tex4ht:ref: sec:chunk_flooding --></a>) on the number of
<!--l. 46--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">hello</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
messages that it has received. Consequently, it holds that
<!--l. 48--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel">|</mo><msup><mrow 
><mi 
>T</mi></mrow><mrow 
><mi 
>k</mi></mrow></msup 
><mo 
class="MathClass-rel">|</mo><mo 
class="MathClass-rel">≤</mo><mo 
class="MathClass-rel">|</mo><mi 
>T</mi><mo 
class="MathClass-rel">|</mo></math>.
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.2   </span> <a 
 id="x1-40001.2"></a>Leaving a team</h4>
                                                                  

                                                                  
<!--l. 3--><p class="indent" >   <a 
 id="x1-40012"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img height=300 src="graphics/leaving.png" /> </div> 
<br /> <div class="caption" 
><span class="id">Figure 2: </span><span  
class="content">Tasks run when an peer <!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math>
wants to leave its team. <!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math>
is a neighbor of <!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math>.</span></div><!--tex4ht:label?: x1-40012 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
<!--l. 7--><p class="noindent" >An outgoing peer <!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math> (see
Fig. <a 
href="#x1-40012">2<!--tex4ht:ref: fig:leaving --></a>) must to: (1) say <!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">goodbye</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
to <!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math> and
to <!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>T</mi></mrow><mrow 
><mi 
>o</mi></mrow></msup 
></math> (in
this order), (2) relay any pending (received but yet not sent) chunks, and (3) wait for a
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">goodbye</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math> from
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>, which performs
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi> <mo 
class="MathClass-rel">=</mo> <mi 
>T</mi> <mo 
class="MathClass-bin">∖</mo> <msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math>. In case of
a timeout, <!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math>
resets the leaving procedure, for a maximum number of times.
</p><!--l. 14--><p class="indent" >   When a <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math>
receives a <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">goodbye</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
from <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math>,
<!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math> removes
<!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math> from its neighbors
set, by running <!--l. 15--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>T</mi></mrow><mrow 
><mi 
>k</mi></mrow></msup 
> <mo 
class="MathClass-rel">=</mo> <msup><mrow 
><mi 
>T</mi></mrow><mrow 
><mi 
>k</mi></mrow></msup 
> <mo 
class="MathClass-bin">∖</mo> <msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>o</mi></mrow></msub 
></math>.
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.3   </span> <a 
 id="x1-50001.3"></a>Chunk generation</h4>
                                                                  

                                                                  
<!--l. 4--><p class="indent" >   <a 
 id="x1-50013"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img height=300 src="graphics/chunk_generation_and_flooding.png" /> </div> 
<br />      <div class="caption" 
><span class="id">Figure 3:         </span><span  
class="content">Chunk         generation         at         the         splitter
<!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>.
Cchunk ﬂooding at peers <!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math>.</span></div><!--tex4ht:label?: x1-50013 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
<!--l. 8--><p class="noindent" >Splitter <!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>
(see Fig. <a 
href="#x1-50013">3<!--tex4ht:ref: fig:chunk_generation_and_flooding --></a>) divides the stream into chunks of data
(<!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">chunk</mi></math>) of constant
length <!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>C</mi></math>,
and sends exclusively each chunk to a diﬀerent <span 
class="ecti-1000">origin peer</span>
<!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
> <mo 
class="MathClass-rel">∈</mo> <mi 
>T</mi></math>,
using a round-robin schema. Each chunk is enumerated with an index
<!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math>, conforming
a message <!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><msub><mrow 
><mi 
>c</mi></mrow><mrow 
><mi 
>x</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>x</mi><mo 
class="MathClass-punc">,</mo><mi mathvariant="monospace">chunk</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>,
where <!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi> <mo 
class="MathClass-rel">=</mo> <mi 
>i</mi><mspace width="1em" class="nbsp" /><mi mathvariant="normal">mod</mi><mspace width="1em" class="nbsp" /><mo 
class="MathClass-rel">|</mo><mi 
>T</mi><mo 
class="MathClass-rel">|</mo></math>.
</p><!--l. 15--><p class="indent" >   We deﬁne a <span 
class="ecti-1000">round </span>(in a team) as the time necessary to send two
consecutive chunks from the splitter (of such team) to the same
peer, using the round-robing. This time is variable and depends on
<!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel">|</mo><mi 
>T</mi><mo 
class="MathClass-rel">|</mo></math>,
<!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>C</mi></math>, and the average
bit-rate of the media, <!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>.
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.4   </span> <a 
 id="x1-60001.4"></a>Chunk ﬂooding</h4>
<!--l. 2--><p class="noindent" >When a peer <!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math> receives
a chunk from <!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>,
<!--l. 2--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math> ﬂoods the
chunk to <!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
>T</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
> <mo 
class="MathClass-bin">∖</mo> <msubsup><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>,
using a prioritized round-robin schema (see Fig. <a 
href="#x1-50013">3<!--tex4ht:ref: fig:chunk_generation_and_flooding --></a>). Besides, if it is a duplicate chunk,
<!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math> sends
to <!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math> a
<!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">NRFCF</mi><mspace width="1em" class="nbsp" /><msubsup><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>l</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
(<!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">N</mi></math>ot
<!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">R</mi></math>elay
<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">F</mi></math>uture
<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">C</mi></math>hunks
<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">F</mi></math>rom) message,
where <!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>l</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>
is the origin peer of the duplicate chunk. Thus, only the ﬁrst neighbor
<!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math> to send to
<!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math> a chunk “originated” at
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>l</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math> will do that in the future, at
least that <!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
></math> revokes this routing
information by sending <!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">RFCF</mi><mspace width="1em" class="nbsp" /><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>l</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
(<!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">R</mi></math>elay
<!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">F</mi></math>uture
<!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">C</mi></math>hunks
<!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">F</mi></math>rom) to one or more (possibly
                                                                  

                                                                  
the rest of) peers of <!--l. 14--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒯</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math>.
</p><!--l. 16--><p class="indent" >   As said, peers prioritize the ﬂooding of the chunks they relay by sending ﬁrst the
chunks to those neighbors that are more supportive. To achieve that, every time
<!--l. 18--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math> sends a
chunk to <!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>l</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math>,
<!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math> runs
<!--l. 19--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">debt</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>l</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mi mathvariant="monospace">debt</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>l</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-bin">+</mo> <mn>1</mn></math>, and
<!--l. 20--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>l</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math> runs
<!--l. 21--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">debt</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mi mathvariant="monospace">debt</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-bin">−</mo> <mn>1</mn></math>
(see Fig.<span 
class="ecbx-1000">??</span>). Basically, these tables maintain a “debt” of chunks between
evey pair of neighbor peers. In ideal circunstances, debs should be
<!--l. 24--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>0</mn></math>. Debs are
clipped to <!--l. 25--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-bin">±</mo><msub><mrow 
><mi mathvariant="monospace">debt</mi></mrow><mrow 
><mstyle 
class="text"><mtext  >max</mtext></mstyle></mrow></msub 
></math>.
Obviously, a high supportivity means a low debt, and viceversa.
</p><!--l. 19--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.5   </span> <a 
 id="x1-70001.5"></a>Chunk buﬀering</h4>
<!--l. 1--><p class="noindent" >In order to hide the jitter generated by the physical network and the protocol itself,
peers need to store the received chunks in a buﬀer before playing them. A chunk
<!--l. 3--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>c</mi></mrow><mrow 
><mi 
>x</mi></mrow></msub 
></math> is inserted in the
position <!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>x</mi><mspace width="1em" class="nbsp" /><mi mathvariant="italic">mod</mi><mspace width="1em" class="nbsp" /><mi 
>B</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></math> of the buﬀer,
being <!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>B</mi></math> the buﬀer
size in chunks and “<!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="italic">mod</mi></math>”
the modulo operator. A chunk is given as lost when it is time to send it to the player
and the chunk has not been received.
</p><!--l. 23--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.6   </span> <a 
 id="x1-80001.6"></a>Free-riding control at splitters</h4>
<!--l. 1--><p class="noindent" >In each team there are a set of <!--l. 1--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
>M</mi></mrow><mrow 
><mi 
>j</mi></mrow></msup 
> <mo 
class="MathClass-rel">≤</mo> <mi 
>N</mi></math>
<span 
class="ecti-1000">monitors </span><!--l. 1--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">ℳ</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
> <mo 
class="MathClass-rel">∈</mo><msup><mrow 
><mi 
mathvariant="bold-script">𝒯</mi></mrow><mrow 
><mi 
>j</mi></mrow></msup 
></math>
(trusted peers whose behavior is predictable and that are
only known by the splitter), which complain to their splitter
<!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
mathvariant="bold-script">𝒮</mi></mrow><mrow 
><mi 
>j</mi></mrow></msup 
></math> when a chunk is lost.
For every sent chunk <!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math>
to <!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math>,
<!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
mathvariant="bold-script">𝒮</mi></mrow><mrow 
><mi 
>j</mi></mrow></msup 
></math> performs
<!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>D</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>x</mi></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">=</mo> <msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math>
to associate every sent chunk with its destination (origin) peer
<!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math>. If happens
that <!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>L</mi></math>
<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi mathvariant="monospace">LC</mi><mspace width="1em" class="nbsp" /><mi 
>x</mi></mrow><mo 
class="MathClass-close">]</mo></mrow></math>
                                                                  

                                                                  
(<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">L</mi></math>ost
<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">C</mi></math>hunk)
messages have beeen received from any of the monitors (the splitter only considers
these kind of messages if they come from a monitor) in a number of rounds (see
Fig. <span 
class="ecbx-1000">??</span> for the exact computation of the number of lost chunks per peer per round),
then <!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math>
is considered as a gone peer and it is removed from the list of peers of the
splitter.
</p><!--l. 15--><p class="indent" >   <span 
class="ecbx-1000">This last functionality has not been implemented, at least, as it has</span>
<span 
class="ecbx-1000">been explained here. The </span><span 
class="ectt-1000">forget </span><span 
class="ecbx-1000">thread is controlled by a timer, not by a</span>
<span 
class="ecbx-1000">counter of rounds.</span>
</p><!--l. 18--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-90002"></a>FCS (Free-riding Control Set)</h3>
<!--l. 1--><p class="noindent" >DBS does not imposes any control over the grade of solidarity of the peers. This
means that some selﬁsh peers (on simply peers with reduced connectivity as a
consecuence, for example, of NAT issues) can stay in the team thanks to the
generosity of the rest of peers. If this is unnaceptable, this set of rules forces to
all the peers of the team to share the same number of chunks that they
receive.
</p><!--l. 8--><p class="indent" >   To achieve this behavior, FCS deﬁnes that, if
<!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math> realises
that <!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">debt</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>l</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></mrow><mo 
class="MathClass-close">]</mo></mrow> <mo 
class="MathClass-rel">&#x003E;</mo><msub><mrow 
> <mi mathvariant="monospace">debt</mi></mrow><mrow 
><mstyle 
class="text"><mtext  >max</mtext></mstyle></mrow></msub 
></math>,
then <!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math>
removes <!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>l</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math>
from <!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒯</mi></mrow><mrow 
><mi 
>k</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math>.
Obviously, <!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>l</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math>
should churn, unless it not interested in playing the media.
</p><!--l. 22--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-100003"></a>IMS (Ip Multicast Set)</h3>
<!--l. 1--><p class="noindent" >IPM is available by default in LANs (Local Are Network)s and VLANs (Virtual
LAN)s <span class="cite">[<a 
href="#Xshabtay2011ip">5</a>]</span>, but not in the Internet <span class="cite">[]</span>. IMS runs on the top of DBS and provides
eﬃcient native IPM, where available.
</p><!--l. 6--><p class="indent" >   The idea of IMS is simple: all peers in the same LAN or
VLAN have the same network address. When a joining peer
<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math> receives
<!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">[</mo><mrow><msup><mrow 
><mi 
mathvariant="bold-script">𝒯</mi></mrow><mrow 
><mi 
>j</mi></mrow></msup 
></mrow><mo 
class="MathClass-close">]</mo></mrow></math> from
<!--l. 8--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
mathvariant="bold-script">𝒮</mi></mrow><mrow 
><mi 
>j</mi></mrow></msup 
></math>,
ﬁrst checks if there are neighbors in the same subnet (all of them
                                                                  

                                                                  
share the same private network address). For all those peers,
<!--l. 10--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math> uses the IP address
<!--l. 11--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">224.0.0.1</mi></math> (all systems on this
subnet), (default) port <!--l. 12--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">1234</mi></math>,
to broadcast (only) the chunks received from the splitter. When implementing IMS,
all peers in the same local network communicate using this IPM group and port. The
splitter do a similar check: for all those peers that are in the same local network
that then splitter, the splitter sends the chunk to the multicast channel
<!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">224.0.0.1</mi></math>:<!--l. 17--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">1234</mi></math>.
</p><!--l. 26--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-110004"></a>MRS (Massively-lost chunk Recovery Set)</h3>
<!--l. 1--><p class="noindent" >LRS extends DBS (or an extension of it) to retransmit massively-lost chunks. LRS should
be implemented if error-prone communications are expected, specially if these channels
are used by the splitter. LRS is based on the use of monitors (see Procedure <a 
href="#x1-80001.6">1.6<!--tex4ht:ref: dbs:frcS --></a>). The
idea is: <!--l. 5--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
mathvariant="bold-script">𝒮</mi></mrow><mrow 
><mi 
>j</mi></mrow></msup 
></math>
will resend lost chunks to one or more the monitors when all monitors in
<!--l. 6--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
mathvariant="bold-script">𝒯</mi></mrow><mrow 
><mi 
>j</mi></mrow></msup 
></math>
report their loss. To increase the probability of receiving on time the resent
chunk (by normal peers), monitors halves the number of chunks in their
buﬀers in relation to common peers. LRS only modiﬁes the behavior of
<!--l. 9--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
mathvariant="bold-script">𝒮</mi></mrow><mrow 
><mi 
>j</mi></mrow></msup 
></math> and
the monitors (normal peers does no need to implement LRS or its extensions).
</p><!--l. 30--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5   </span> <a 
 id="x1-120005"></a>TAS (Topology Adaptation Set)</h3>
<!--l. 1--><p class="noindent" >In TAS, the splitter request to each peer of the team the list of neighbors
(peers that send chunks directly, in one hop). This communication is reliable
(TCP) and transmits the lists as a collection of end-points. The number of
requests per round is limited by the available bandwidth in the overlay, and by
the request-ratio deﬁned at the splitter. Obviously, the higher the ratio, a
more accurate description of the real connectivity in the overlay will be
obtained.
</p><!--l. 12--><p class="indent" >   After knowing the connectivity degree of each peer, the slitter can adapt the
round-robing scheduling of the origin peers by sending a number of chunks
proportional to the inverse of the degree.
</p><!--l. 34--><p class="noindent" >
                                                                  

                                                                  
</p>
   <h3 class="sectionHead"><span class="titlemark">6   </span> <a 
 id="x1-130006"></a>ACS (Adaptive Capacity Set)</h3>
<!--l. 1--><p class="noindent" >ACS relaxes the peer’s upload requirements imposed by DBS. It should be used in if
it is known that some peers can provide the capacity than others cannot, or
when we want to mix the CS and P2P models, sending more chunks from
<!--l. 4--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math> to
one or more monitors controlled by the contents provider.
</p><!--l. 7--><p class="indent" >   ACS is based on the idea of using the information that
<!--l. 7--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
mathvariant="bold-script">𝒮</mi></math>
knows about the number of chunks that each peer has lost (see Procedure <a 
href="#x1-80001.6">1.6<!--tex4ht:ref: dbs:frcS --></a>), to
send to those more reliable peers a higher number of chunks than to the others. In
other words, ACS adapts the round-time of each peer to its capacity.
</p><!--l. 13--><p class="indent" >   Notice that ACS only aﬀects the behavior of
<!--l. 13--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
mathvariant="bold-script">𝒮</mi></math>.
</p><!--l. 38--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">7   </span> <a 
 id="x1-140007"></a>MCS (Multi-Channel Set)</h3>
<!--l. 1--><p class="noindent" >When using MDC <span class="cite">[<a 
href="#Xbaccichet2007content">1</a>]</span>, SVC <span class="cite">[<a 
href="#Xchu2009auction">3</a>]</span>, or for emulating the CS model, it can be interesting
for peers to belong to more than one team. To implement MCS, peers must
replicate the LP2PLS protocol layers for each team (channel), except the
buﬀer.
</p><!--l. 6--><p class="indent" >   The use of MDC is trivial: the higher the number received descriptions (channels),
even partially, the higher the quality of the playback. However, when transmitting
SVC media, peers should prioritize the reception of the most important layers.
Finally, a pure CS service could be provided if the corresponding splitter announces
one empty team and sends each chunk so many times as teams (with one peer/team)
there are.
</p><!--l. 42--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">8   </span> <a 
 id="x1-150008"></a>NTS (NAT Traversal Set)</h3>
<!--l. 3--><p class="noindent" >Most most of the peers run inside of “private” networks, i.e. behind NAT devices.
NTS<span class="footnote-mark"><a 
href="index4.html#fn3x0"><sup class="textsuperscript">3</sup></a></span><a 
 id="x1-15001f3"></a> 
is an DBS extension which provides peer connectivity for
some NAT conﬁgurations DBS can not provide direct peer
                                                                  

                                                                  
communication.<span class="footnote-mark"><a 
href="index5.html#fn4x0"><sup class="textsuperscript">4</sup></a></span><a 
 id="x1-15002f4"></a> 
</p><!--l. 17--><p class="indent" >   Peers behind the same NAT will use the same external (also called “public”,
because in most cases we have not nested NAT conﬁgurations) IP address of the
NAT. Basically, there exist two diﬀerent types of NATs: (1) <span 
class="ecti-1000">cone</span>, and (2) <span 
class="ecti-1000">symmetric</span>.
At the same time, NATs can implement diﬀerent ﬁltering strategies for the packets
that comes from the external side: (a) <span 
class="ecti-1000">no ﬁltering</span>, (b) <span 
class="ecti-1000">source IP ﬁltering</span>, and
(c) <span 
class="ecti-1000">source end-point ﬁltering</span>. Finally, NATs can use several port allocation
algorithms, among which, the most frequent are: (i) <span 
class="ecti-1000">port preservation </span>and (ii)
<span 
class="ecti-1000">random port</span>. Notice that in this discussion, only UDP transmission will be
considered.
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.1   </span> <a 
 id="x1-160008.1"></a>Traﬃc ﬁltering</h4>
<!--l. 30--><p class="noindent" >Lets suppose a team in which, for the sake of simplicity, there is only one external (public) peer
<!--l. 31--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
>P</mi></mrow><mrow 
><mi 
>e</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>, and that a new internal
(private) peer <!--l. 32--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math> has sent
the sequence of [<!--l. 33--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>]’s (see
Sec <a 
href="#x1-30001.1">1.1<!--tex4ht:ref: sec:peer_joining --></a>. Lets denote <!--l. 34--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>’s
NAT as <!--l. 34--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="sans-serif">A</mi></math>. When no
ﬁltering is used at all, <!--l. 35--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="sans-serif">A</mi></math>
forwards to <!--l. 35--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>
any external packet that arrives to it (obviously, if it was sent to the entry in
<!--l. 37--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="sans-serif">A</mi></math>’s
translation table that was created during the transmission of the sequence of
[<!--l. 38--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>]’s),
independently on the source end-points of the packets. In the case of source (IP) address
ﬁltering, <!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="sans-serif">A</mi></math>
will forward the packets only if they come from
<!--l. 41--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>e</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>’s host. When source
end-point ﬁltering is used, <!--l. 42--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="sans-serif">A</mi></math>
also checks the source port, i.e., that the packets were originated at
<!--l. 43--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>e</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>’s
end-point.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-160014"></a>
                                                                  

                                                                  
<!--l. 46--><p class="noindent" > <div style="text-align:center;"> <img height=200 src="graphics/cone_NAT.png" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 4: </span><span  
class="content">Cone NAT port allocation.</span></div><!--tex4ht:label?: x1-160014 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-160025"></a>
                                                                  

                                                                  
<!--l. 51--><p class="noindent" > <div style="text-align:center;"> <img height=200 src="graphics/symmetric_NAT.png" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 5: </span><span  
class="content">Symmetric NAT port allocation.</span></div><!--tex4ht:label?: x1-160025 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">8.2   </span> <a 
 id="x1-170008.2"></a>Cone VS symmetric</h4>
<!--l. 56--><p class="noindent" >Cone NATs use the same external end-point for every packet that comes from the same
internal end-point, independently on the destination of the packets (see Fig. <a 
href="#x1-160025">5<!--tex4ht:ref: fig:cone_NAT --></a>). For the
external peer <!--l. 58--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>e</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>,
the situation is identical to the case in which the NATed peer
<!--l. 60--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math> would
be running in a public host.
</p><!--l. 62--><p class="indent" >   Symmetric NATs use diﬀerent external end-points for diﬀerent packets that comes from
the same internal end-point, when these packets have diﬀerent destination end-points
(see Fig. <span 
class="ecbx-1000">??</span>). Thus, two diﬀerent external peers will see two diﬀerent public end-points
of <!--l. 66--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>e</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>.
</p><!--l. 68--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.3   </span> <a 
 id="x1-180008.3"></a>Port allocation</h4>
<!--l. 69--><p class="noindent" >In  the  case  of  port  preservation,  if
<!--l. 69--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>X</mi></math>:<!--l. 69--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math>
is the private end-point (IP address:port) of a UDP packet, the NAT will use the public port
<!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math>, if available
(notice that <!--l. 71--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math>
cound have been assigned to a previous communcation). If
<!--l. 72--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> </math> were
unavailable, the NAT usually will assign the closer free port (this is called
“sequentially port allocation”), usually by increasing the port value, although this
behavior has not been standarized at all.
</p><!--l. 77--><p class="indent" >   When random port allocation is implemented, the public port will be assigned at
random. Notice that, even in SN-PPA conﬁgurations, in most of the real situations
(where peers must compete with the rest of processes that use the network for the
same NAT resources,) some kind of randomization should be always expected during
a the port assignment.
</p><!--l. 84--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.4   </span> <a 
 id="x1-190008.4"></a>NAT type analysis</h4>
<!--l. 85--><p class="noindent" >An incoming peer <!--l. 85--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>
can determine its NAT behavior using the following steps:
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-19002x1">Let <!--l. 88--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mrow ><mo 
class="MathClass-open">{</mo><mrow><msub><mrow 
><mi mathvariant="sans-serif">A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi mathvariant="sans-serif">A</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi mathvariant="sans-serif">A</mi></mrow><mrow 
><mi 
>M</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">}</mo></mrow></math> the public
     ports used by peer <!--l. 89--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>,
                                                                  

                                                                  
     whose NAT is <!--l. 89--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="sans-serif">A</mi></math>, to
     send the [<!--l. 90--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>] UDP
     packets towards <!--l. 90--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msup><mrow 
><mi 
mathvariant="bold-script">𝒮</mi></mrow><mrow 
><mi 
>t</mi></mrow></msup 
></math>
     and the <!--l. 91--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>M</mi></math>
     monitor peers of the team, in this order. This data is known by
     <!--l. 92--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>
     after receiving the acknowledgment of each
     [<!--l. 93--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="monospace">hello</mi></math>].
     Compute <table class="equation"><tr><td> <a 
 id="x1-19003r1"></a>
     <!--l. 94--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                                         <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo><msub><mrow 
> <mi mathvariant="sans-serif">A</mi></mrow><mrow 
><mi 
>k</mi></mrow></msub 
> <mo 
class="MathClass-bin">−</mo><msub><mrow 
><mi mathvariant="sans-serif">A</mi></mrow><mrow 
><mi 
>k</mi><mo 
class="MathClass-bin">−</mo><mn>1</mn></mrow></msub 
>
</math></td><td class="eq-no">(1)</td></tr></table>
     <!--l. 98--><p class="noindent" >for <!--l. 98--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>k</mi> <mo 
class="MathClass-rel">=</mo> <mn>1</mn><mo 
class="MathClass-punc">,</mo><mn>2</mn><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><mi 
>M</mi></math>, the <span 
class="ecti-1000">port distances</span>
     gathered by <!--l. 98--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>.
     </p></li>
     <li 
  class="enumerate" id="x1-19005x2">Determine a <span 
class="ecti-1000">port step </span><table class="equation"><tr><td> <a 
 id="x1-19006r2"></a>
     <!--l. 101--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>Δ</mi> <mo 
class="MathClass-rel">=</mo> <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  align="axis" style=""  
equalrows="false" columnlines="none" equalcolumns="false" class="array"> <mtr><mtd 
class="array"  columnalign="left">  <mn>0</mn><mo 
class="MathClass-punc">,</mo>                   </mtd><mtd 
class="array"  columnalign="right"> <mstyle 
class="text"><mtext  >if </mtext></mstyle><mo 
class="MathClass-op">∀</mo><mi 
>i</mi><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>i</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <mn>0</mn> </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left">  <mi mathvariant="normal">GCD</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>m</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-punc">,</mo> </mtd><mtd 
class="array"  columnalign="right">    <mstyle 
class="text"><mtext  >otherwise</mtext></mstyle>  </mtd></mtr><!--lr--></mtable>                                                         </mrow></mfenced>
</math></td><td class="eq-no">(2)</td></tr></table>
     <!--l. 108--><p class="noindent" >where GCD is the Greatest Common Divisor operator.
     </p></li>
     <li 
  class="enumerate" id="x1-19008x3">If <!--l. 109--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Δ</mi> <mo 
class="MathClass-rel">=</mo> <mn>0</mn></math>
     (<!--l. 109--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="sans-serif">A</mi></math>
     is using the same external port for communicating
     <!--l. 110--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math> with the rest of peers
     of the team) then <!--l. 111--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>
                                                                  

                                                                  
     is behind a cone NAT. Notice that public (not NATed) peers will be considered
     as being using this type of NAT, also.
     </li>
     <li 
  class="enumerate" id="x1-19010x4">If <!--l. 114--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Δ</mi> <mo 
class="MathClass-rel">&#x003E;</mo> <mn>0</mn></math>
     (<!--l. 114--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="sans-serif">A</mi></math>
     is using a diﬀerent external port for each external peer) then
     <!--l. 115--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>i</mi></mrow><mrow 
><mi 
>t</mi></mrow></msubsup 
></math>
     is behind a symmetric NAT. In this case:
         <ol  class="enumerate2" >
         <li 
  class="enumerate" id="x1-19012x1">If <table class="equation"><tr><td> <a 
 id="x1-19013r3"></a>
         <!--l. 119--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                                       <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <mo 
class="MathClass-rel">⋯</mo> <mo 
class="MathClass-rel">=</mo> <msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>m</mi></mrow></msub 
>
</math></td><td class="eq-no">(3)</td></tr></table>
         <!--l. 122--><p class="noindent" >then <!--l. 122--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="sans-serif">A</mi></math>
         is using sequentially port allocation.
         </p></li>
         <li 
  class="enumerate" id="x1-19015x2">If <table class="equation"><tr><td> <a 
 id="x1-19016r4"></a>
         <!--l. 124--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                            <mi 
>Δ</mi> <mo 
class="MathClass-rel">=</mo><munder class="msub"><mrow 
><mo class="qopname"> lim</mo></mrow><mrow 
><mi 
>m</mi><mo 
class="MathClass-rel">→</mo><mi 
>∞</mi></mrow></munder 
><mi mathvariant="normal">GCD</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><msub><mrow 
><mi 
>Δ</mi></mrow><mrow 
><mi 
>m</mi></mrow></msub 
></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mn>1</mn><mo 
class="MathClass-punc">.</mo>
</math></td><td class="eq-no">(4)</td></tr></table>
         <!--l. 127--><p class="noindent" >then <!--l. 127--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi mathvariant="sans-serif">A</mi></math>
         is using random port allocation.</p></li></ol>
     </li></ol>
                                                                  

                                                                  
<!--l. 131--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.5   </span> <a 
 id="x1-200008.5"></a>(Theoretical) NAT traversal performance of DBS</h4>
   <div class="table">
                                                                  

                                                                  
<!--l. 134--><p class="indent" >   <a 
 id="x1-200012"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
<div class="tabular"> <table id="TBL-4" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-4-1g"><col 
id="TBL-4-1" /></colgroup><colgroup id="TBL-4-2g"><col 
id="TBL-4-2" /></colgroup><colgroup id="TBL-4-3g"><col 
id="TBL-4-3" /></colgroup><colgroup id="TBL-4-4g"><col 
id="TBL-4-4" /></colgroup><colgroup id="TBL-4-5g"><col 
id="TBL-4-5" /></colgroup><colgroup id="TBL-4-6g"><col 
id="TBL-4-6" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-4-1-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-1-1"  
class="td11"> Peer1/2  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-2"  
class="td11">  CN  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-3"  
class="td11"> CN-AF  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-4"  
class="td11"> CN-EF  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-5"  
class="td11"> SN-PPA  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-1-6"  
class="td11"> SN-RPA  </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-2-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-2-1"  
class="td11"> CN         </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-3"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-4"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-5"  
class="td11">    DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-2-6"  
class="td11">    DBS  </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-3-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-3-1"  
class="td11"> CN-AF </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-2"  
class="td11"> DBS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-3"  
class="td11"> DBS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-4"  
class="td11"> DBS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-5"  
class="td11"> NTS </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-3-6"  
class="td11"> -</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-4-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-4-1"  
class="td11"> CN-EF    </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-3"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-4"  
class="td11">   DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-5"  
class="td11">    NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-4-6"  
class="td11">        -  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-5-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-5-1"  
class="td11"> SN-PPA  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-3"  
class="td11">   NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-4"  
class="td11">   NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-5"  
class="td11">    NTS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-5-6"  
class="td11">        -  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-6-"><td  style="text-align:left; white-space:nowrap;" id="TBL-4-6-1"  
class="td11"> SN-RPA  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-2"  
class="td11"> DBS  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-3"  
class="td11">       -  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-4"  
class="td11">      -  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-5"  
class="td11">       -  </td><td  style="text-align:right; white-space:nowrap;" id="TBL-4-6-6"  
class="td11">        -  </td></tr></table></div>
<br /> <div class="caption" 
><span class="id">Table 2: </span><span  
class="content">NAT traversal success for diﬀerent NAT typical combinations. CN-NF
(also known by “full cone NAT”) stands for Cone NAT (without packet ﬁltering).
CN-AF (also known as “restricted cone NAT”) stands for Cone NAT with source
Address Filtering. CN-EF (also known by “port restricted cone NAT”) stands for
Cone NAT source End-point Filtering. SN-PPA stands for Symmetric NAT Port
Preservation Allocation, and no packet ﬁltering has been considered. SN-RPA
stands for Symmetric NAT Random Port Allocation, and no packet ﬁltering has
been used. </span></div><!--tex4ht:label?: x1-200012 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-200026"></a>
                                                                  

                                                                  
<!--l. 157--><p class="noindent" > <div style="text-align:center;"> <img height=400 src="graphics/UDP_Hole_Punching_RCN.png" /> </div> 
<br /> </p><div class="caption" 
><span class="id">Figure 6: </span><span  
class="content">An example that shows why it is possible to establish a connection
with                  DBS                  when                  two                  peers
<!--l. 160--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and
<!--l. 160--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
that are behind cone NATs.</span></div><!--tex4ht:label?: x1-200026 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-200037"></a>
                                                                  

                                                                  
<!--l. 164--><p class="noindent" > <div style="text-align:center;"> <img height=400 src="graphics/UDP_Hole_Punching_SN_failure.png" /> </div> 
<br />           </p><div class="caption" 
><span class="id">Figure 7:                  </span><span  
class="content">An                  example                  that
shows why its is impossible to establish a connection with DBS when two peers
<!--l. 167--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and
<!--l. 167--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
that are behind symmetric NATs.</span></div><!--tex4ht:label?: x1-200037 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
                                                                  

                                                                  
<!--l. 171--><p class="indent" >   <a 
 id="x1-200048"></a></p><hr class="float" /><div class="float" 
>
                                                                  

                                                                  
 <div style="text-align:center;"> <img height=600 src="graphics/SNTuCPP.png" /> </div> 
<br /> <div class="caption" 
><span class="id">Figure 8:  </span><span  
class="content">Timeline  of  an  (ideal)  NTS  interaction  between  two  peers
<!--l. 174--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
></math>
and
<!--l. 174--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>P</mi></mrow><mrow 
><mn>2</mn></mrow></msub 
></math>
which are behind symmetric NATs. </span></div><!--tex4ht:label?: x1-200048 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
<!--l. 177--><p class="indent" >   Table <a 
href="#x1-200012">2<!--tex4ht:ref: tab:theoretical --></a> shows the theoretical traversal success of DBS (or an extension of it) for
diﬀerent NAT type combinations. Peer1 represents to a peer already joined to the
team, and Peer2 to an incoming peer. The entries labeled with “DBS” are those that
will be handled by DBS, out-of-the-box. An explanation of why the DBS handshake
works for such conﬁgurations is shown in Fig. <span 
class="ecbx-1000">??</span>. Notice that source end-point
ﬁltering has been used in this example, although a similar results should be obtained
for simple source address ﬁltering. On the other hand, the combinations labeled with
“-” or “NTS” will not work with DBS (see Fig.<a 
href="#x1-200037">7<!--tex4ht:ref: fig:UDP_Hole_Punching_SN_failure --></a>). In fact, only the “NTS” entries
should work, in general, with NTS, depending on the port prediction algorithm and
the number of tries. Fig. <a 
href="#x1-200048">8<!--tex4ht:ref: fig:SNTuCPP --></a> shows an example of an NTS (NAT traversal)
success.
</p><!--l. 193--><p class="indent" >   Summarizing, NTS can provide connectivity for those peers that are behind
port-preservation symmetric NATs with sequential port allocation.
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.6   </span> <a 
 id="x1-210008.6"></a>A port prediction algorithm (Max’s proposal)</h4>
<!--l. 198--><p class="noindent" >When both peers, Peer1 and Peer2, are behind symmetric NATs, both must predict
the port that the NAT of the interlocutor peer will use to send the packets towards
it. And obviously, this must be performed by each already incorporated peer that is
behind a symmetric NAT.
</p><!--l. 203--><p class="indent" >   The list of predicted ports <!--l. 203--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Z</mi></math>
that a a peer <!--l. 203--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msubsup><mrow 
><mi 
mathvariant="bold-script">𝒫</mi></mrow><mrow 
><mi 
>x</mi></mrow><mrow 
><mi 
>j</mi></mrow></msubsup 
></math>
performs is determined by: </p><table class="equation"><tr><td> <a 
 id="x1-21001r5"></a>
<!--l. 205--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
 <mtable  align="axis" style=""  
equalrows="false" columnlines="none none" equalcolumns="false" class="array"> <mtr><mtd 
class="array"  columnalign="right">  <mi 
>Z</mi> </mtd><mtd 
class="array"  columnalign="center">   <mo 
class="MathClass-rel">=</mo>   </mtd><mtd 
class="array"  columnalign="left"> <msub><mrow 
></mtext><mtext class="textsf" mathvariant="sans-serif" ><mstyle 
class="text"><mtext class="textsf" mathvariant="sans-serif" >A</mtext></mstyle></mrow><mrow 
><mn>0</mn></mrow></msub 
> <mo 
class="MathClass-bin">+</mo> <mi 
>x</mi> <mo 
class="MathClass-bin">+</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>s</mi> <mo 
class="MathClass-rel">∈</mo><mrow ><mo 
class="MathClass-open">{</mo><mrow><mn>0</mn><mo 
class="MathClass-punc">,</mo><mn>1</mn><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><mi 
>N</mi><mo 
class="MathClass-bin">∕</mo><mn>2</mn> <mo 
class="MathClass-bin">−</mo> <mn>1</mn></mrow><mo 
class="MathClass-close">}</mo></mrow></mrow><mo 
class="MathClass-close">}</mo></mrow><mo 
class="MathClass-punc">;</mo>      </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="right">  <mi 
>Z</mi> </mtd><mtd 
class="array"  columnalign="center"> <mo 
class="MathClass-bin">+</mo> <mo 
class="MathClass-rel">=</mo> </mtd><mtd 
class="array"  columnalign="left"> <msub><mrow 
></mtext><mtext class="textsf" mathvariant="sans-serif" ><mstyle 
class="text"><mtext class="textsf" mathvariant="sans-serif" >A</mtext></mstyle></mrow><mrow 
><mn>0</mn></mrow></msub 
> <mo 
class="MathClass-bin">+</mo> <mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>x</mi> <mo 
class="MathClass-bin">+</mo> <mrow ><mo 
class="MathClass-open">{</mo><mrow><mi 
>s</mi> <mo 
class="MathClass-rel">∈</mo><mrow ><mo 
class="MathClass-open">{</mo><mrow><mn>0</mn><mo 
class="MathClass-punc">,</mo><mn>1</mn><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-rel">⋯</mo><mspace width="0.3em" class="thinspace"/><mo 
class="MathClass-punc">,</mo><mi 
>N</mi> <mo 
class="MathClass-bin">−</mo> <mn>1</mn></mrow><mo 
class="MathClass-close">}</mo></mrow></mrow><mo 
class="MathClass-close">}</mo></mrow></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-bin">⋅</mo> <mi 
>Δ</mi><mo 
class="MathClass-punc">.</mo> </mtd></mtr><!--rcl--></mtable>
</math></td><td class="eq-no">(5)</td></tr></table>
<!--l. 211--><p class="indent" >   where “<!--l. 211--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin">+</mo> <mo 
class="MathClass-rel">=</mo></math>” denotes the
concatenation of lists and <!--l. 211--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math> is
the number of guessed ports, <!--l. 212--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
></mtext><mtext class="textsf" mathvariant="sans-serif" ><mstyle 
class="text"><mtext class="textsf" mathvariant="sans-serif" >A</mtext></mstyle></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is the ﬁrst external port (the port used to communicate with
<!--l. 213--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>S</mi></math>) assigned to the
incoming peer and <!--l. 214--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Δ</mi></math>
is the (maximum) port step measured for the incoming peer’s NAT.
                                                                  

                                                                  
</p><!--l. 1--><p class="noindent" >
</p>
   <h3 class="likesectionHead"><a 
 id="x1-220008.6"></a>References</h3>
<!--l. 1--><p class="noindent" >
   </p><div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
 [1]<span class="bibsp">   </span></span><a 
 id="Xbaccichet2007content"></a>Pierpaolo  Baccichet,  Jeonghun  Noh,  Eric  Setton,  and  Bernd  Girod.
   Content-aware p2p video streaming with low latency.  In <span 
class="ecti-1000">Multimedia and</span>
   <span 
class="ecti-1000">Expo, 2007 IEEE International Conference on</span>, pages 400–403. IEEE, 2007.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [2]<span class="bibsp">   </span></span><a 
 id="Xbanerjee2002scalable"></a>Suman Banerjee, Bobby Bhattacharjee, and Christopher Kommareddy.
   <span 
class="ecti-1000">Scalable application layer multicast</span>, volume 32. ACM, 2002.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [3]<span class="bibsp">   </span></span><a 
 id="Xchu2009auction"></a>Xiaowen  Chu,  Kaiyong  Zhao,  Zongpeng  Li,  and  Anirban  Mahanti.
   Auction-based  on-demand  p2p  min-cost  media  streaming  with  network
   coding.      <span 
class="ecti-1000">IEEE  Transactions  on  Parallel  and  Distributed  Systems</span>,
   20(12):1816–1829, 2009.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [4]<span class="bibsp">   </span></span><a 
 id="Xcomer2003computer"></a>Douglas E  Comer  and  Ralph E  Droms.    <span 
class="ecti-1000">Computer  networks  and</span>
   <span 
class="ecti-1000">internets</span>. Prentice-Hall, Inc., 2003.
   </p>
   <p class="bibitem" ><span class="biblabel">
 [5]<span class="bibsp">   </span></span><a 
 id="Xshabtay2011ip"></a>Lior  Shabtay  and  Benny  Rodrig.   Ip  multicast  in  vlan  environment,
   April 12 2011. US Patent 7,924,837.
</p>
   </div>
    
</body> 
</html>
                                                                  


